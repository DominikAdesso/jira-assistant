"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[182],{4486:(e,t,s)=>{s.r(t),s.d(t,{default:()=>T});var i=s(7313),o=s(4616),a=s(6019),r=s(9168),n=s(2544),l=s(1287),d=s(459),h=s(6417);class c extends i.PureComponent{constructor(e){super(e),this.saveName=()=>{this.setState({isEditMode:!1});const{value:e,icon:t}=this.state;this.props.onChange(e,t)},this.onChange=e=>this.setState({value:e}),this.onIconChange=e=>this.setState({icon:e}),this.cancelEdit=()=>this.setState({isEditMode:!1,value:this.props.value,icon:this.props.icon}),this.showIcons=e=>this.op.show(e),this.setRef=e=>this.op=e,this.state=this.getState(e)}UNSAFE_componentWillReceiveProps(e){this.setState(this.getState(e))}getState(e){let{value:t,icon:s}=e;return s||(s="fa-tachometer"),t||(t="Default"),{value:t,icon:s}}render(){const{value:e,icon:t,isEditMode:s}=this.state;return s?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"p-inputgroup dashboard-name-edit",children:[(0,h.jsx)(r.Z,{icon:`fa ${t}`,onClick:this.showIcons}),(0,h.jsx)(n.Z,{value:e,maxLength:18,onChange:this.onChange}),(0,h.jsx)(r.Z,{icon:"fa fa-check",type:"success",onClick:this.saveName,disabled:!e||e.length<=2}),(0,h.jsx)(r.Z,{icon:"fa fa-undo",onClick:this.cancelEdit})]}),(0,h.jsx)(l.T,{ref:this.setRef,children:(0,h.jsxs)("div",{className:"dashboard-icons",children:[d.M7.map(((e,t)=>(0,h.jsx)("div",{className:"d-icon",onClick:()=>this.onIconChange(e),children:(0,h.jsx)("span",{className:e})},t))),(0,h.jsx)("div",{className:"clear-fix"})]})})]}):(0,h.jsxs)("div",{className:"dashboard-name",title:"Click to edit the name or change the icon",onClick:()=>this.setState({isEditMode:!0}),children:[(0,h.jsx)("span",{className:`board-icon fa ${t}`}),(0,h.jsx)("span",{className:"lev-1",children:"Dashboards"}),(0,h.jsx)("i",{className:"fa fa-arrow-right"}),(0,h.jsx)("span",{className:"lev-2",children:e}),(0,h.jsx)("i",{className:"fa fa-edit"})]})}}const p=c;var u=s(747);class g extends i.PureComponent{constructor(e){super(e),this.nameChanged=(e,t)=>{const{index:s,config:i}=this.state;i.name=e,i.icon=t,this.$dashboard.saveDashboardInfo(s,i,!0)},this.showContext=e=>(0,u.showContextMenu)(e,this.contextMenu),(0,o.f3)(this,"DashboardService"),this.state=this.getStateDetails(e)}UNSAFE_componentWillReceiveProps(e){this.setState(this.getStateDetails(e))}getStateDetails(e){const{config:t,index:s}=e,i=[{label:"Create dashboard",icon:"fa fa-plus",command:()=>this.$dashboard.createDashboard(this.state.config)},{label:"Delete dashboard",icon:"fa fa-trash-o",command:()=>this.deleteDashboard(),disabled:0===s}];if(!this.props.isQuickView){const e={label:"Show in tabs",icon:t.isTabView?"fa fa-check-square":"fa fa-square",command:()=>this.setAsTabView(e)},s={label:"Set as quick view",icon:t.isQuickView?"fa fa-check-square":"fa fa-square",disabled:t.isQuickView,command:()=>this.setAsQuickView(s)};i.push(e),i.push(s)}return this.contextMenu=i,{config:t,index:s}}async deleteDashboard(){await this.$dashboard.deleteDashboard(this.state.index),this.props.history.push(`/${this.props.userId}/dashboard/0`)}async setAsQuickView(e){e.disabled=!0,e.icon="fa fa-check-square",this.contextMenu=[...this.contextMenu];const t=await this.$dashboard.setAsQuickView(this.state.config,this.state.index);this.setState({config:t})}async setAsTabView(e){const{config:t,index:s}=this.state,i=await this.$dashboard.setAsTabView(t,s);e.icon=i.isTabView?"fa fa-check-square":"fa fa-square",this.contextMenu=[...this.contextMenu],this.setState({config:i}),this.props.tabViewChanged(i.isTabView)}render(){const{config:{icon:e,name:t}}=this.state;return(0,h.jsxs)("div",{className:"page-header",children:[(0,h.jsx)("div",{className:"pull-left",children:(0,h.jsx)(p,{icon:e,value:t,onChange:this.nameChanged})}),(0,h.jsxs)("div",{className:"pull-right",children:[(0,h.jsx)(r.Z,{type:"success",icon:"fa fa-cubes",label:"Add gadgets",onClick:this.props.onShowGadgets}),!this.props.isQuickView&&(0,h.jsx)(r.Z,{icon:"fa fa-wrench",onClick:this.showContext})]})]})}}const f=g;var m=s(1783),y=s(6303);class w extends m.Z{constructor(e){super(e,"Manage gadgets"),(0,y.f)(this,"ReportService"),this.style={width:"700px"},this.state.widgets=e.widgetsList,this.state.gadgetList=a.Z$}UNSAFE_componentWillMount(){this.$report.getReportsList().then((e=>{if(e&&e.length){const t=e.map((e=>({id:(e.advanced?"AR:":e.isNew?"CR:":"SQ:")+e.id,icon:"fa fa-filter",name:e.queryName,isOld:!(e.isNew||e.advanced),details:e.advanced?"<no details available>":`${e.outputCount} columns displayed in table format${e.isNew?" with interactive option to sort and group based on columns.":" (deprecated, not allowed to add to dashboard)"}`}))),s=[...a.Z$,...t];this.setState({gadgetList:s})}}))}UNSAFE_componentWillReceiveProps(e){this.state.widgets!==e.widgetsList&&this.setState({widgets:e.widgetsList})}getFooter(){return(0,h.jsx)(r.Z,{icon:"fa fa-check",label:"Done",onClick:this.onHide})}render(){const{addGadget:e,removeGadget:t}=this.props,{widgets:s,gadgetList:i}=this.state;return super.renderBase((0,h.jsxs)(h.Fragment,{children:[i.map((i=>{const o=s.some((e=>e.name===i.id));return(0,h.jsxs)("div",{className:"gadget-info",children:[(0,h.jsx)("div",{className:"icon",children:(0,h.jsx)("i",{className:`fa ${i.icon}`})}),(0,h.jsxs)("div",{className:"details",children:[(0,h.jsx)("span",{className:"name",children:i.name}),(0,h.jsx)("span",{className:"desc",children:i.details}),(0,h.jsx)("div",{className:"params"})]}),(0,h.jsxs)("div",{className:"controls",children:[!o&&(0,h.jsx)(r.Z,{type:"success",icon:"fa fa-plus",label:"Add gadget",disabled:i.isOld,onClick:()=>e(i.id)}),o&&(0,h.jsx)(r.Z,{type:"danger",icon:"fa fa-times",label:"Remove gadget",onClick:()=>t(i.id)})]})]},i.id)})),(0,h.jsx)("div",{className:"clearfix"})]}))}}const k=w;var v=s(3972),b=s(4918),x=s(2371),S=s(4705),C=s(7360),D=s(8192);class j extends i.PureComponent{constructor(e){super(e),this.tabViewChanged=e=>this.setState({isTabView:e}),this.addGadget=(e,t)=>{let{currentBoard:s}=this.state;s={...s},s.widgets=s.widgets.concat({name:e,settings:t||{}}),this.setState({currentBoard:s})},this.removeGadget=e=>{let{currentBoard:t}=this.state;t={...t};const s=[...t.widgets];s.removeAll((t=>t.name===e)),t.widgets=s,this.setState({currentBoard:t})},this.saveDashboardInfo=()=>{const{dashboardIndex:e,currentBoard:t}=this.state;this.$dashboard.saveDashboardInfo(e,t)},this.widgetAction=(e,t,s)=>{switch(e.type){case a.Xk.AddWorklog:this.worklogItem=e.data,this.setState({showWorklogPopup:!0});break;case a.Xk.RemoveGadget:let{currentBoard:i}=this.state;i={...i};const o=[...i.widgets];i.widgets=o,o.splice(s,1),this.setState({currentBoard:i},this.saveDashboardInfo),this.emitToChildren(e,s);break;case a.Xk.SettingsChanged:t.settings=e.data,this.saveDashboardInfo();break;default:this.emitToChildren(e,s)}},this.gadgetReordered=e=>{let{currentBoard:t}=this.state;t={...t,widgets:e},this.setState({currentBoard:t},this.saveDashboardInfo)},this.getControls=(e,t,s)=>{let{name:i}=e;const{settings:o}=e,a=this.state.isTabView,r=i.split(":");r.length>1&&(i=r[0],r.splice(0,1));let n=this.gadgetsList[i];n||(n={title:"Gadget Unavailable",control:b.ZP});let l=null;n.getProps&&(l=n.getProps(o,r));const d={key:`${i}_${r[0]}`,tabLayout:a,index:t,model:e,settings:o,isGadget:!0,layout:this.state.currentBoard.layout,onAction:this.widgetAction,...l},c=n.control;if(a){let e=n.title;return e||(e="function"===typeof c.getTitle?c.getTitle(d):"Unknown Gadget"),(0,h.jsx)(x.TabPanel,{header:e,children:(0,h.jsx)(c,{...d})},i)}return e=>(0,h.jsx)(c,{...d,draggableHandle:e,dropProps:s})},this.onShowGadgets=()=>this.setState({showGadgetDialog:!0}),this.hideGadgetDialog=()=>{this.setState({showGadgetDialog:!1}),this.saveDashboardInfo()},this.worklogAdded=e=>{this.emitToChildren(e),this.hideWorklog()},this.hideWorklog=()=>this.setState({showWorklogPopup:!1}),(0,o.f3)(this,"DashboardService","SessionService","ReportService","CacheService"),this.rapidViews=this.$session.CurrentUser.rapidViews||[];const{match:{params:t}}=e;this.isQuickView=this.$session.isQuickView,this.state=this.loadDashboard(parseInt(t.index||0)),this.setGadgetsList()}UNSAFE_componentWillReceiveProps(e){const t=e.match.params.index;t!==this.state.dashboardIndex&&this.setState(this.loadDashboard(t))}loadDashboard(e){const t=this.$session.CurrentUser.dashboards;e>=t.length&&(e=0);const s=t[e];return{dashboardIndex:e,currentBoard:s,isTabView:this.isQuickView||s.isTabView}}emitToChildren(e,t){b.jn.emit("change",e,t)}setGadgetsList(){const e={myOpenTickets:{title:"My open tickets",control:a.Qk},bookmarksList:{title:"My Bookmarks",control:a.Em},dateWiseWorklog:{title:"Daywise worklog",control:a.kW},pendingWorklog:{title:"Worklog - [Pending upload]",control:a.dS},ticketWiseWorklog:{title:"Ticketwise worklog",control:a.bM},sWiseTSpent:{title:"Status Wise Time Spent",control:a.Uz},myFilters:{title:"My reports",control:a.WP},agendaDay:{title:"Calendar",control:a.f,getProps:()=>({viewMode:"timeGridDay"})},agendaWeek:{title:"Calendar",control:a.f,getProps:()=>({viewMode:"timeGridWeek"})},listDay:{title:"Calendar",control:a.f,getProps:()=>({viewMode:"listDay"})},listWeek:{title:"Calendar",control:a.f,getProps:()=>({viewMode:"listWeek"})},listMonth:{title:"Calendar",control:a.f,getProps:()=>({viewMode:"listMonth"})},SQ:{title:"Custom report (Old)",control:S.Z,getProps:(e,t)=>({reportId:parseInt(t[0])})},CR:{title:"Custom report",control:C.Z,getProps:(e,t)=>({reportId:parseInt(t[0])})},AR:{title:"Advanced report",control:D.Z,getProps:(e,t)=>({reportId:parseInt(t[0])})}};e.myBookmarks=e.bookmarksList,e.dtWiseWL=e.dateWiseWorklog,e.pendingWL=e.pendingWorklog,this.gadgetsList=e}getGadgets(e){return e&&e.length?this.state.isTabView?(0,h.jsx)(x.TabView,{className:"no-padding tab-gadgets",children:e.map(this.getControls)}):(0,h.jsx)(u.Sortable,{items:e,itemType:"gadget",onChange:this.gadgetReordered,children:this.getControls}):null}render(){const{currentBoard:{widgets:e},dashboardIndex:t,currentBoard:s,showGadgetDialog:i,showWorklogPopup:o}=this.state;return(0,h.jsxs)("div",{children:[(0,h.jsx)(f,{...this.props,config:s,index:t,userId:this.$session.userId,onShowGadgets:this.onShowGadgets,tabViewChanged:this.tabViewChanged,isQuickView:this.isQuickView}),this.getGadgets(e),(!e||0===e.length)&&(0,h.jsx)("div",{className:"no-widget-div",children:'You haven\'t added any gadgets to this dashboard. Click on "Add gadgets" button above to start adding a cool one and personalize your experience.'}),i&&(0,h.jsx)(k,{onHide:this.hideGadgetDialog,widgetsList:e,addGadget:this.addGadget,removeGadget:this.removeGadget}),o&&(0,h.jsx)(v.Z,{worklog:this.worklogItem,onDone:this.worklogAdded,onHide:this.hideWorklog})]})}}const T=j},7360:(e,t,s)=>{s.d(t,{Z:()=>y});s(7313);var i=s(1857),o=s(9422),a=s(4918),r=s(4616),n=s(2251),l=s(9082);async function d(e,t){if(!e)return{};const s=(0,r.DB)("JiraService"),i=e.fields.map((e=>e.field)),o=await s.searchTickets(e.jql,i),a={utils:t},l=e.fields.filter((e=>!e.hide)).map(h.bind(a));a.fieldWithExpr=l.filter((e=>!!e.ast));const d=o.map(c.bind(a));if(a.hasWorklogs){const e=a.usersObj,t=Object.keys(e).map((t=>({field:t,displayText:e[t].displayName,type:"seconds",groupText:"Log Work",allowGrouping:!1,viewComponent:n.Hv,props:{}})));t.push({field:"totalWorklog",displayText:"Total Log Work",type:"seconds",groupText:"Log Work",allowGrouping:!1,viewComponent:n.Hv,props:{}});const s=l.findIndex((e=>{let{field:t}=e;return"worklog"===t}));l.splice(s,1,...t)}return{isLoading:!1,reportData:d,columnList:l,settings:e.settings}}function h(e){const{id:t,field:s,name:i,header:o=i,type:a,isArray:r,expr:d}=e,h={id:t,field:s,displayText:o,type:a,props:{},allowSorting:!r,allowGrouping:"summary"!==s&&"description"!==s};return d?(h.ast=(0,l.Hp)(d),h.exprField=s,h.field=t,h.viewComponent=n.s$):h.viewComponent=function(e,t,s){const{props:i}=t;switch(e){case"issuekey":return n.a3;case"epicLink":return i.hideContext=!0,n.a3;case"project":return t.fieldKey=`${t.field}.name`,n.Bx;case"user":return t.fieldKey=`${t.field}.displayName`,n.H;case"comment":return t.allowSorting=!1,n.Sn;case"issuelinks":return n.m4;case"seconds":return n.Hv;case"workratio":return i.converter=function(e){return-1===e?null:e},n.Hv;case"timetracking":return n.aS;case"parent":return t.fieldKey=`${t.field}.key`,n.lc;case"progress":case"aggregateprogress":return t.fieldKey=`${t.field}.percent`,n.Y3;case"sprint":return n._t;case"attachment":return i.hrefProp="content",i.iconClass="fa-paperclip",i.tagProp="filename",n._t;case"component":return i.titleProp="description",n._t;case"version":return i.titleProp="releaseDate",n._t;case"option":return t.fieldKey=`${t.field}.value`,i.tagProp="value",n._t;case"votes":return t.fieldKey=`${t.field}.votes`,i.tagProp="votes",i.hideZero=!0,n._t;case"watches":return t.fieldKey=`${t.field}.watchCount`,i.tagProp="watchCount",i.hideZero=!0,n._t;case"date":case"datetime":return n.qm;case"issuetype":case"status":case"priority":case"resolution":return t.fieldKey=`${t.field}.name`,n.y5;case"epicStatus":return i.textField="value",i.iconField="",t.fieldKey=`${t.field}.value`,n.y5;case"string":return s?(i.tagProp="",n._t):null;case"number":return n.s$;default:return t.allowSorting=!1,t.allowGrouping=!1,n.s$}}("issuekey"===s?"issuekey":a,h,r),h.allowSorting||(h.allowGrouping=!1),h.allowGrouping&&function(e){const t=[{type:"check",label:"Issue count",prop:"showGroupCount",value:!0},{separator:!0}];switch(e.type){default:return;case"issuetype":case"status":case"priority":case"resolution":t.splice(1,1);break;case"string":t.push({type:"radio",label:"Show value",prop:"valueType",value:"value",default:!0}),t.push({type:"radio",label:"Show count",prop:"valueType",value:"count"}),t.push({type:"radio",label:"Distinct count",prop:"valueType",value:"distinct"});break;case"user":t[1]={type:"check",label:"Show Image",prop:"showImage"},t.push({separator:!0}),t.push({type:"radio",label:"Show name",prop:"valueType",value:"name",default:!0}),t.push({type:"radio",label:"Show email id",prop:"valueType",value:"email"}),t.push({type:"radio",label:"Show both",prop:"valueType",value:"both"});break;case"project":t.push({type:"radio",label:"Show name",prop:"valueType",value:"name"}),t.push({type:"radio",label:"Show key",prop:"valueType",value:"key",default:!0}),t.push({type:"radio",label:"Show both",prop:"valueType",value:"both"});break;case"parent":t[1]={type:"check",label:"Show status",prop:"showStatus",default:!0},t.push({separator:!0}),t.push({type:"radio",label:"Show key",prop:"valueType",value:"key",default:!0}),t.push({type:"radio",label:"Show summary",prop:"valueType",value:"summary"}),t.push({type:"radio",label:"Show both",prop:"valueType",value:"both"});break;case"date":case"datetime":t.push({type:"radio",label:"Friendly date",prop:"funcType",value:"friendly"}),t.push({type:"radio",label:"Group by year",prop:"funcType",value:"yyyy"}),t.push({type:"radio",label:"Group by month",prop:"funcType",value:"MMMM"}),t.push({type:"radio",label:"Group by both",prop:"funcType",value:"yyyy-MM (MMMM)",default:!0}),t.push({type:"radio",label:"Group by date",prop:"funcType",value:"yyyy-MM-dd"});break;case"number":case"seconds":t.push({type:"radio",label:"Group by field",prop:"funcType",value:"",default:!0}),t.push({type:"radio",label:"Sum of field",prop:"funcType",value:"sum"}),t.push({type:"radio",label:"Avg of field",prop:"funcType",value:"avg"}),t.push({type:"radio",label:"Count having value",prop:"funcType",value:"count"})}e.groupOptions=t}(h),h}function c(e){const t=e.fields;return t.issuekey=e.key,t.id=e.id,p.call(this,t),function(e){if(!e.comment)return;e.comment=e.comment.comments}(t),u.call(this,t),t}function p(e){if(!e.worklog)return;if(e.worklog=e.worklog.worklogs,!e.worklog.length)return void delete e.worklog;this.hasWorklogs=!0;const t=this.usersObj||{};this.usersObj=t;for(const s of e.worklog){const{author:i,timeSpentSeconds:o}=s,{accountId:a,emailAddress:r}=i,n=r||a;t[n]||(t[n]=i),e[n]=(e[n]||0)+o,e.totalWorklog=(e.totalWorklog||0)+o}}function u(e){if(this.fieldWithExpr.length)for(const s of this.fieldWithExpr)if("string"!==typeof s.ast)try{const t=(0,l.F0)(s.ast,{this:e[s.exprField],Fields:e,Utils:this.utils,parseInt:parseInt,parseFloat:parseFloat,isNaN:isNaN,Math:Math,Number:Number,Date:Date});e[s.id]=g(t)}catch(t){e[s.id]=`Error: ${(null===t||void 0===t?void 0:t.message)||t}`}else e[s.id]=s.ast}function g(e){if(e instanceof Date)return this.utils.formatDateTime(e);if("object"===typeof e){const t=Object.keys(e);return t.contains("type")&&t.contains("key")&&t.contains("props")?e:JSON.stringify(e)}return e}var f=s(6417);class m extends a.ZP{constructor(e){const{query:t}=e;super(e,(null===t||void 0===t?void 0:t.queryName)||"Custom report viewer","fa-clock-o"),this.toggleGroupOptions=()=>this.setState({hideGroups:!this.state.hideGroups}),this.refreshData=()=>this.loadData(this.props.query||this.state.query),this.loadData=async e=>{this.setState({isLoading:!0,hasError:!1});try{this.setState(await d(e,{formatDate:this.$userutils.formatDate,formatTime:this.$userutils.formatTime,formatDateTime:this.$userutils.formatDateTime,formatSecs:this.$utils.formatSecs,formatMS:this.$utils.formatTs,showAsLink:e=>(0,f.jsx)("a",{href:this.$userutils.getTicketUrl(e),target:"_blank",rel:"noopener noreferrer",children:e})}))}catch(t){this.setState({isLoading:!1,hasError:!0})}},this.tableSettingsChanged=e=>{this.settings={...this.settings,...e},this.isGadget?(this.saveSettings(),this.setState({settings:e})):this.props.settingsChanged(e)},(0,r.f3)(this,"AnalyticsService","ReportService","JiraService","UtilsService","UserUtilsService"),this.state.isLoading=!0,this.state.hideGroups=this.isGadget}componentDidMount(){this.initWithProps(this.props)}renderCustomActions(e){return e?(0,f.jsx)(o.zx,{type:"success",title:"Click to toggle group options",icon:this.state.hideGroups?"fa fa-toggle-off":"fa fa-toggle-on",onClick:this.toggleGroupOptions}):(0,f.jsx)(o.zx,{type:"success",label:"Edit",title:"Click to edit the report",icon:"fa fa-edit",onClick:this.props.onEditClicked})}UNSAFE_componentWillReceiveProps(e){super.UNSAFE_componentWillReceiveProps(e),this.initWithProps(e)}initWithProps(e){const{query:t,reportId:s}=e;s?this.reportId!==s&&(this.reportId=s,this.loadReportDefinition(s)):t&&this.query!==t&&(this.query=t,this.loadReportData(t))}async loadReportDefinition(e){const t=await this.$report.getReportDefinition(e);this.title=(null===t||void 0===t?void 0:t.queryName)||"Custom report viewer",this.setState({query:t}),this.loadReportData(t)}loadReportData(e){this.settings={...e.settings,...this.settings},this.jql===e.jql&&this.fields===e.fields||(this.jql=e.jql,this.fields=e.fields,this.loadData(e))}render(){const{query:e}=this.props,{query:t=e}=this.state,{loading:s,reportData:o,columnList:a,settings:r,hasError:n,hideGroups:l}=this.state,{displayColumns:d,groupBy:h,groupFoldable:c,sortField:p,isDesc:u}=this.settings||r||{};return n?super.renderBase((0,f.jsx)("div",{className:"error-block",children:"Unable to load this report due to an error."})):s||!o?super.renderBase():super.renderBase((0,f.jsx)(i.Z,{dataset:o,hideGroups:l,exportSheetName:t.queryName,columns:a,allowSorting:!0,onChange:this.tableSettingsChanged,displayColumns:d,groupBy:h,groupFoldable:c,sortField:p,isDesc:u,noRowsMessage:"No ticket details available"}))}}const y=m},4705:(e,t,s)=>{s.d(t,{Z:()=>p});s(7313);var i=s(4918),o=s(4616),a=s(1329),r=(s(1673),s(459)),n=s(4711),l=s(2251),d=s(3972),h=s(6417);class c extends i.ZP{constructor(e){let{definition:t}=e;t=t||{},super(e,t.queryName||"Custom report viewer (deprecated)","fa-clock-o"),this.refreshData=()=>{this.props.reportId>0?this.$report.getReportDefinition(this.props.reportId).then((e=>{this.setState({reportDefinition:e},this.fillReport)})):this.state.reportDefinition&&this.fillReport()},this.fillReport=()=>{const e=this.state.reportDefinition||{};e&&(this.title=`${e.queryName} (deprecated)`),e.jql&&e.outputFields&&e.outputFields.length&&(this.setState({isLoading:!0}),this.dataFields=e.outputFields.map((e=>e.id)),this.$jira.searchTickets(e.jql,this.dataFields).then((t=>{this.headerFields=e.outputFields.map((e=>{let t=e.name;return e.functions&&e.functions.header&&(t=e.functions.header.replace("{0}",t)),{text:t,rowspan:2}})),this.processIssues(t);const s=this.headerFields,i=[];this.headerFields.filter((e=>e.subCols&&e.subCols.length>0)).forEach((e=>{i.addRange(e.subCols),i.push({text:"Total"}),e.colspan=e.subCols.length+1,e.rowspan=1}));const o=e.outputFields.filter((e=>e.groupBy)),a=o.length>0?this.groupData(t,Array.from(o)):t;this.dataFields=e.outputFields.filter((e=>!e.groupBy)),this.reportHtml=this.genHtmlRow(a);const n=a.length>0;this.setState({subFields:i,hasReportData:n,displayFields:s,isLoading:!1}),this.$analytics.trackEvent("Custom report viewed",r.Jk.UserActions)})))},this.addWorklog=e=>{const t={ticketNo:e};this.setState({showWorklogPopup:!0,worklogItem:t})},this.hideWorklog=()=>{this.setState({showWorklogPopup:!1})},(0,o.f3)(this,"AnalyticsService","ReportService","JiraService","UtilsService","UserUtilsService"),this.state.reportDefinition=t}UNSAFE_componentWillMount(){this.refreshData()}UNSAFE_componentWillReceiveProps(e){(e.definition&&e.definition!==this.state.reportDefinition||e.reportId)&&this.setState({reportDefinition:e.definition},this.refreshData)}genHtmlRow(e,t){const s=(e,s,i,o)=>{const a=[];t&&0===e&&0===s&&a.addRange(t),0===s&&i.issues&&a.push(this.getGroupedTD(i.name,o.length));const r=o[s],n=r.fields;for(let t=0;t<this.dataFields.length;t++){const e=this.dataFields[t];if(e.functions&&e.functions.useArray)0===s&&("issuekey"===e.id?a.push(this.getAggregateTD(o.map((e=>e.key)),e.functions)):a.push(this.getAggregateTD(o.map((t=>t.fields[e.id])),e.functions)));else if("worklog"===e.id){const t=this.fieldOpts.worklogUsers,s=n.worklogs_proc;let i=0;for(let o=0;o<t.length;o++)if(s){{const r=s[t[o].id];if(r){i+=r.timespent,a.push(this.getTD(r.timespent,e.functions));continue}}a.push(this.getTD())}else a.push(this.getTD("#Error"));i?a.push(this.getTD(i,e.functions)):a.push(this.getTD())}else"issuekey"===e.id?a.push(this.getIssueKeyTD(r.key,e.functions)):a.push(this.getTD(n[e.id],e.functions))}return a},i=[];for(let o=0;o<e.length;o++){const a=e[o];if(a.subGroups){const e=this.getGroupedTD(a.name,a.issueCount);i.addRange(this.genHtmlRow(a.subGroups,0===o?[t,e]:[e]))}else{const e=a.issues||[a];for(let t=0;t<e.length;t++)i.push((0,h.jsx)("tr",{children:s(o,t,a,e)}))}}return i}getTD(e,t){return e?(0,h.jsx)("td",{children:this.execute(e,t)}):(0,h.jsx)("td",{children:"\xa0"})}getIssueKeyTD(e,t){return"string"===typeof e?(0,h.jsx)(l.a3,{value:e,onAddWorklog:this.addWorklog}):this.getTD(e,t)}getAggregateTD(e,t){return(0,h.jsx)("td",{className:"bold",rowSpan:e.length,children:this.execute(e,t)})}getGroupedTD(e,t){e||(e="<No Value>"),e+=` (${t})`;const s=t>4||e.length/t<2.5;return(0,h.jsxs)("td",{className:s?"rotateM90":"bold",rowSpan:t,children:["\xa0",(0,h.jsx)("div",{children:e})]})}groupData(e,t){if(!t||!t.length)return e;const s=t[0],i=s.id,o=s.functions;t.removeAt(0);const a=o.useArray,r=e=>{const s={name:e.key},i=e.values;return t.length>0?(s.subGroups=this.groupData(i,Array.from(t)),s.issueCount=s.subGroups.sum((e=>e.issueCount))):(s.issues=i,s.issueCount=s.issues.length),s};if(a){const t=e.map("issuekey"===i?e=>e.key:e=>e.fields[i],!0);return[r({key:this.execute(t,o),values:e})]}return e.groupBy((e=>{const t=e.fields[i];return t?this.execute(t,o):t})).map((e=>r(e)))}execute(e,t){if(!e||!t||!t.name)return e;let s="#Error";try{let i=this.$utils,o=this.$utils[t.name];if(o&&o.apply||(o=this.$userutils[t.name],i=this.$userutils),o&&o.apply||(o=u[t.name],i=e),!o||!o.apply)return"#Error: Func not found";const a=[e].addRange(t.params);s=o.apply(i,a)}catch(i){console.error(i)}return null!==s?s:""}processIssues(e){const t=this.dataFields.indexOf("worklog");if(-1===t)return;const s=[],i=[];this.fieldOpts={};for(let a=0;a<e.length;a++){const t=e[a].fields;if(t.worklog&&t.worklog.worklogs.length>0){const e=t.worklog.worklogs.groupBy((e=>({id:(0,n.vW)(e.author),text:e.author.displayName}))),o={};for(let t=0;t<e.length;t++){const a=e[t],r=a.key.id;-1===i.indexOf(r)&&(s.push(a.key),i.push(r)),o[r]={timespent:a.values.sum((e=>e.timeSpentSeconds))}}t.worklogs_proc=o}else t.worklog&&t.worklog.worklogs&&0===t.worklog.worklogs.length&&(t.worklogs_proc={})}const o=this.headerFields[t];o.subCols=s.orderBy((e=>e.text)),this.fieldOpts.worklogUsers=o.subCols}render(){const{reportHtml:e,state:{isLoading:t,hasReportData:s,displayFields:i,subFields:o,showWorklogPopup:r,worklogItem:n}}=this;return super.renderBase((0,h.jsxs)("div",{className:"cust-report-viewer",children:[s&&(0,h.jsxs)(a.TT,{children:[(0,h.jsxs)(a.Et,{children:[(0,h.jsx)("tr",{className:"data-center",children:i.map(((e,t)=>(0,h.jsx)("th",{rowSpan:e.rowspan,colSpan:e.colspan,children:e.text},t)))}),!!o&&o.length>0&&(0,h.jsx)("tr",{className:"data-center",children:o.map(((e,t)=>(0,h.jsx)("th",{children:e.text},t)))})]}),!s&&!t&&(0,h.jsx)("tbody",{children:(0,h.jsx)("tr",{children:(0,h.jsx)("td",{colSpan:i&&i.length,children:"No records exists"})})}),s&&(0,h.jsx)("tbody",{children:e})]}),r&&(0,h.jsx)(d.Z,{worklog:n,onDone:this.hideWorklog,onHide:this.hideWorklog})]}))}}const p=c,u={last:function(e){return null!==e&&void 0!==e&&e.length?e[e.length-1]:null},first:function(e){return null!==e&&void 0!==e&&e.length?e[0]:null}}},8192:(e,t,s)=>{s.d(t,{Z:()=>p});s(7313);var i=s(4918),o=s(6303),a=s(9422),r=s(747),n=s(4902),l=s(3972),d=s(459),h=s(6417);class c extends i.ZP{constructor(e){super(e,"Advanced report viewer","fa-clock-o"),this.usersSelected=e=>{this.parameterEvent.onChange(this.parameterEvent.definition,e),this.parameterEvent=null,this.setState({showGroupsPopup:!1,groups:e})},this.refreshData=()=>{this.props.reportId>0?this.$report.getReportDefinition(this.props.reportId).then((e=>{this.setReportDefinition(e),this.$analytics.trackEvent("Advanced report viewed",d.Jk.UserActions)})):this.state.definition&&(this.title=this.state.definition.queryName,this.$analytics.trackEvent("Advanced report viewed",d.Jk.UserActions))},this.getApi=e=>this.viewer=e,this.worklogAdded=e=>{this.hideWorklog()},this.hideWorklog=()=>{this.setState({showWorklogPopup:!1})},(0,o.f)(this,"ReportConfigService","AnalyticsService","ReportService"),this.viewer={},this.$reportConfig.configureViewer(),this.$reportConfig.parameters.removeAllListeners(),this.$reportConfig.parameters.on("click",this.parameterClicked.bind(this)),this.$reportConfig.eventPipe.on("addWorklog",this.addWorklog.bind(this));const{definition:t}=e;this.state.definition=t}UNSAFE_componentWillMount(){this.refreshData()}UNSAFE_componentWillReceiveProps(e){e.definition?this.setReportDefinition(e.definition):e.reportId?this.refreshData():this.setReportDefinition({})}addWorklog(e){this.isGadget?super.addWorklog(e):(this.worklogItem=e,this.setState({showWorklogPopup:!0}))}parameterClicked(e){this.parameterEvent=e,this.setState({showGroupsPopup:!0})}setReportDefinition(e){e&&e.queryName&&(this.title=e.queryName),this.setState({definition:e})}renderCustomActions(){return(0,h.jsxs)(h.Fragment,{children:[!this.isGadget&&(0,h.jsx)(a.zx,{icon:this.isFullScreen?"fa fa-compress":"fa fa-expand",onClick:this.toggleFullScreen,title:"Toggle full screen"}),this.viewer.canShowParams&&(0,h.jsx)(a.zx,{icon:"fa fa-plus-circle",onClick:this.viewer.showParameters,title:"Change report params"}),!this.isGadget&&(0,h.jsx)(a.zx,{icon:"fa fa-edit",onClick:this.props.onCancelView,title:"Edit report"})]})}render(){const{state:{definition:e,showGroupsPopup:t,groups:s,showWorklogPopup:i}}=this;return super.renderBase((0,h.jsxs)(h.Fragment,{children:[e&&(0,h.jsx)(r.ReportViewer,{api:this.getApi,definition:e}),t&&(0,h.jsx)(n.Z,{groups:s,onHide:this.usersSelected}),i&&(0,h.jsx)(l.Z,{worklog:this.worklogItem,onDone:this.worklogAdded,onHide:this.hideWorklog})]}))}}const p=c},1673:()=>{}}]);