"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[939],{2150:(t,e,s)=>{s.r(e),s.d(e,{default:()=>a});var i=s(7313),r=s(7697),o=s(4705),n=(s(1673),s(6417));class l extends i.PureComponent{constructor(t){super(t),this.viewReport=t=>{this.setState({viewReport:!0,reportDefinition:t})},this.queryChanged=t=>{};const{match:{params:{reportId:e}}}=t;this.state={reportId:e}}render(){const{reportId:t,viewReport:e,reportDefinition:s}=this.state;return(0,n.jsxs)("div",{className:"custom-report",children:[(0,n.jsx)(r.Z,{reportId:t,onViewReport:this.viewReport,onChange:this.queryChanged}),e&&s&&(0,n.jsx)(o.Z,{isGadget:!1,definition:s},s._uniqueId)]})}}const a=l},4705:(t,e,s)=>{s.d(e,{Z:()=>p});s(7313);var i=s(4918),r=s(4616),o=s(1329),n=s(6444),l=s(4711),a=s(2251),h=s(3972),u=(s(1673),s(6417));class d extends i.ZP{constructor(t){let{definition:e}=t;e=e||{},super(t,e.queryName||"Custom report viewer (deprecated)","fa-clock-o"),this.refreshData=()=>{this.props.reportId>0?this.$report.getReportDefinition(this.props.reportId).then((t=>{this.setState({reportDefinition:t},this.fillReport)})):this.state.reportDefinition&&this.fillReport()},this.fillReport=()=>{const t=this.state.reportDefinition||{};t&&(this.title=`${t.queryName} (deprecated)`),t.jql&&t.outputFields&&t.outputFields.length&&(this.setState({isLoading:!0}),this.dataFields=t.outputFields.map((t=>t.id)),this.$jira.searchTickets(t.jql,this.dataFields).then((e=>{this.headerFields=t.outputFields.map((t=>{let e=t.name;return t.functions&&t.functions.header&&(e=t.functions.header.replace("{0}",e)),{text:e,rowspan:2}})),this.processIssues(e);const s=this.headerFields,i=[];this.headerFields.filter((t=>t.subCols&&t.subCols.length>0)).forEach((t=>{i.addRange(t.subCols),i.push({text:"Total"}),t.colspan=t.subCols.length+1,t.rowspan=1}));const r=t.outputFields.filter((t=>t.groupBy)),o=r.length>0?this.groupData(e,Array.from(r)):e;this.dataFields=t.outputFields.filter((t=>!t.groupBy)),this.reportHtml=this.genHtmlRow(o);const l=o.length>0;this.setState({subFields:i,hasReportData:l,displayFields:s,isLoading:!1}),this.$analytics.trackEvent("Custom report viewed",n.Jk.UserActions)})))},this.addWorklog=t=>{const e={ticketNo:t};this.setState({showWorklogPopup:!0,worklogItem:e})},this.hideWorklog=()=>{this.setState({showWorklogPopup:!1})},(0,r.f3)(this,"AnalyticsService","ReportService","JiraService","UtilsService","UserUtilsService"),this.state.reportDefinition=e}UNSAFE_componentWillMount(){this.refreshData()}UNSAFE_componentWillReceiveProps(t){(t.definition&&t.definition!==this.state.reportDefinition||t.reportId)&&this.setState({reportDefinition:t.definition},this.refreshData)}genHtmlRow(t,e){const s=(t,s,i,r)=>{const o=[];e&&0===t&&0===s&&o.addRange(e),0===s&&i.issues&&o.push(this.getGroupedTD(i.name,r.length));const n=r[s],l=n.fields;for(let e=0;e<this.dataFields.length;e++){const t=this.dataFields[e];if(t.functions&&t.functions.useArray)0===s&&("issuekey"===t.id?o.push(this.getAggregateTD(r.map((t=>t.key)),t.functions)):o.push(this.getAggregateTD(r.map((e=>e.fields[t.id])),t.functions)));else if("worklog"===t.id){const e=this.fieldOpts.worklogUsers,s=l.worklogs_proc;let i=0;for(let r=0;r<e.length;r++)if(s){{const n=s[e[r].id];if(n){i+=n.timespent,o.push(this.getTD(n.timespent,t.functions));continue}}o.push(this.getTD())}else o.push(this.getTD("#Error"));i?o.push(this.getTD(i,t.functions)):o.push(this.getTD())}else"issuekey"===t.id?o.push(this.getIssueKeyTD(n.key,t.functions)):o.push(this.getTD(l[t.id],t.functions))}return o},i=[];for(let r=0;r<t.length;r++){const o=t[r];if(o.subGroups){const t=this.getGroupedTD(o.name,o.issueCount);i.addRange(this.genHtmlRow(o.subGroups,0===r?[e,t]:[t]))}else{const t=o.issues||[o];for(let e=0;e<t.length;e++)i.push((0,u.jsx)("tr",{children:s(r,e,o,t)}))}}return i}getTD(t,e){return t?(0,u.jsx)("td",{children:this.execute(t,e)}):(0,u.jsx)("td",{children:"\xa0"})}getIssueKeyTD(t,e){return"string"===typeof t?(0,u.jsx)(a.a3,{value:t,onAddWorklog:this.addWorklog}):this.getTD(t,e)}getAggregateTD(t,e){return(0,u.jsx)("td",{className:"bold",rowSpan:t.length,children:this.execute(t,e)})}getGroupedTD(t,e){t||(t="<No Value>"),t+=` (${e})`;const s=e>4||t.length/e<2.5;return(0,u.jsxs)("td",{className:s?"rotateM90":"bold",rowSpan:e,children:["\xa0",(0,u.jsx)("div",{children:t})]})}groupData(t,e){if(!e||!e.length)return t;const s=e[0],i=s.id,r=s.functions;e.removeAt(0);const o=r.useArray,n=t=>{const s={name:t.key},i=t.values;return e.length>0?(s.subGroups=this.groupData(i,Array.from(e)),s.issueCount=s.subGroups.sum((t=>t.issueCount))):(s.issues=i,s.issueCount=s.issues.length),s};if(o){const e=t.map("issuekey"===i?t=>t.key:t=>t.fields[i],!0);return[n({key:this.execute(e,r),values:t})]}return t.groupBy((t=>{const e=t.fields[i];return e?this.execute(e,r):e})).map((t=>n(t)))}execute(t,e){if(!t||!e||!e.name)return t;let s="#Error";try{let i=this.$utils,r=this.$utils[e.name];if(r&&r.apply||(r=this.$userutils[e.name],i=this.$userutils),r&&r.apply||(r=c[e.name],i=t),!r||!r.apply)return"#Error: Func not found";const o=[t].addRange(e.params);s=r.apply(i,o)}catch(i){console.error(i)}return null!==s?s:""}processIssues(t){const e=this.dataFields.indexOf("worklog");if(-1===e)return;const s=[],i=[];this.fieldOpts={};for(let o=0;o<t.length;o++){const e=t[o].fields;if(e.worklog&&e.worklog.worklogs.length>0){const t=e.worklog.worklogs.groupBy((t=>({id:(0,l.vW)(t.author),text:t.author.displayName}))),r={};for(let e=0;e<t.length;e++){const o=t[e],n=o.key.id;-1===i.indexOf(n)&&(s.push(o.key),i.push(n)),r[n]={timespent:o.values.sum((t=>t.timeSpentSeconds))}}e.worklogs_proc=r}else e.worklog&&e.worklog.worklogs&&0===e.worklog.worklogs.length&&(e.worklogs_proc={})}const r=this.headerFields[e];r.subCols=s.orderBy((t=>t.text)),this.fieldOpts.worklogUsers=r.subCols}render(){const{reportHtml:t,state:{isLoading:e,hasReportData:s,displayFields:i,subFields:r,showWorklogPopup:n,worklogItem:l}}=this;return super.renderBase((0,u.jsxs)("div",{className:"cust-report-viewer",children:[s&&(0,u.jsxs)(o.TT,{children:[(0,u.jsxs)(o.Et,{children:[(0,u.jsx)("tr",{className:"data-center",children:i.map(((t,e)=>(0,u.jsx)("th",{rowSpan:t.rowspan,colSpan:t.colspan,children:t.text},e)))}),!!r&&r.length>0&&(0,u.jsx)("tr",{className:"data-center",children:r.map(((t,e)=>(0,u.jsx)("th",{children:t.text},e)))})]}),!s&&!e&&(0,u.jsx)("tbody",{children:(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:i&&i.length,children:"No records exists"})})}),s&&(0,u.jsx)("tbody",{children:t})]}),n&&(0,u.jsx)(h.Z,{worklog:l,onDone:this.hideWorklog,onHide:this.hideWorklog})]}))}}const p=d,c={last:function(t){return null!==t&&void 0!==t&&t.length?t[t.length-1]:null},first:function(t){return null!==t&&void 0!==t&&t.length?t[0]:null}}},1673:()=>{}}]);