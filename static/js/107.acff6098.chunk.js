"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[107],{3972:(e,t,s)=>{s.d(t,{Z:()=>g});s(7313);var i=s(6392),o=s(1783),a=s(4616),r=s(9165),n=s(816),l=s.n(n),d=s(1003),c=s(6444),h=s(6417);class p extends o.Z{constructor(e){const{editTracker:t}=e;super(e,t?"Edit Tracker":"Add worklog",{width:"550px"}),this.searchTickets=e=>(e=(e||"").toLowerCase(),this.allTicketList.filter((t=>t.label.toLowerCase().indexOf(e)>-1))),this.saveWorklog=(e,t,s)=>{if(!this.validateData(e,t,this.state.ctlClass))return this.$message.warning("Please provide value for all the mandatory fields","Incomplete worklog details"),!1;if(this.setState({isLoading:!0}),this.props.editTracker){const{dateStarted:e,description:t}=this.state.log;this.$wltimer.editTrackerInfo(this.getTicketNo(this.state.log),e,t).then(this.props.onDone)}else this.$worklog.saveWorklog({ticketNo:this.getTicketNo(e),dateStarted:e.dateStarted,overrideTimeSpent:e.overrideTimeSpent,description:e.description,worklogId:e.worklogId,isUploaded:e.isUploaded,timeSpent:e.timeSpent,parentId:e.parentId,id:e.id},s).then((t=>{this.props.onDone(e.id>0?{type:d.Xk.WorklogModified,edited:t,previousTime:this.previousTime}:{type:d.Xk.WorklogModified,added:t}),this.onHide()}),(e=>{this.setState({isLoading:!1}),"string"===typeof e?this.$message.error(e):console.error(e)}))},this.setValue=(e,t)=>{let{log:s}=this.state;t?s[e]=t:delete s[e],s={...s},this.setState({log:s})},this.formatTs=e=>e,this.handleKeyPress=e=>{const{ctrlKey:t,charCode:s}=e;if(t&&13===s){const{isLoading:e,state:{log:t,vald:s,uploadImmediately:i}}=this;e||this.saveWorklog(t,s,i&&!(t.id>0))}},(0,a.f3)(this,"SessionService","SuggestionService","WorklogService","WorklogTimerService","MessageService","UtilsService"),this.displayDateFormat="yyyy-MM-dd HH:mm";const{commentLength:s,autoUpload:i}=this.$session.CurrentUser;this.minCommentLength=s||0;const{worklog:o,uploadImmediately:r}=e;this.state=this.getState(o),this.state.uploadImmediately="boolean"===typeof r?r:i||!1,this.allTicketList=[],this.init(t)}init(e){this.$suggestion.getTicketSuggestion().then((e=>{this.allTicketList=e})),e?this.$wltimer.getCurrentTimer().then((e=>this.setState(this.getTrackerState(e)))):this.loadWorklog(this.state.log)}loadWorklog(e){e.id&&this.fillWorklog(e,e.copy)}getTrackerState(e){const t={ticketNo:e.key,dateStarted:new Date(e.created),description:e.description};return{log:t,vald:{ticketNo:!0,dateStarted:!0,description:!!t.description}}}getState(e){const t={showDialog:!0,vald:{},ctlClass:{},isLoading:!1,log:e};if(e&&!e.id){t.log={ticketNo:e.ticketNo,dateStarted:l()(e.startTime||e.dateStarted||new Date).toDate(),allowOverride:e.allowOverride},e.parentId&&(t.log.parentId=e.parentId);let{timeSpent:s}=e;"number"===typeof s&&(s=this.$utils.formatSecs(s,!1,!0)),!e.allowOverride&&s&&(t.log.timeSpent=s),s?t.log.overrideTimeSpent=s:(t.log.overrideTimeSpent="01:00",t.log.allowOverride=!0),this.validateData(t.log,t.vald,t.ctlClass)}return t}fillWorklog(e,t){return this.$worklog.getWorklog(e).then((e=>{e.timeSpent&&(e.timeSpent=e.timeSpent.substring(0,5),"00:00"===e.timeSpent&&(e.timeSpent=null)),e.overrideTimeSpent&&(e.overrideTimeSpent=e.overrideTimeSpent.substring(0,5),e.allowOverride=!0),t?(this.$analytics.trackEvent("Worklog copy",c.Jk.UserActions,e.isUploaded?"Uploaded worklog":"Pending worklog"),delete e.id,delete e.isUploaded,delete e.worklogId,delete e.parentId,e.dateStarted=l()(`${(new Date).format("yyyy/MM/dd")} ${e.dateStarted.format("HH:mm:ss")}`).toDate()):(this.previousTime=e.dateStarted,this.$analytics.trackEvent("Worklog view",c.Jk.UserActions,e.isUploaded?"Uploaded worklog":"Pending worklog"));const s={log:e,vald:this.state.vald,ctlClass:this.state.ctlClass};return this.validateData(s.log,s.vald,s.ctlClass),this.setState(s),e}))}validateData(e,t,s){e.allowOverride&&(e.overrideTimeSpent=e.overrideTimeSpent||e.timeSpent||"00:00");let i=!0;const o=this.getTicketNo(e);if(i=(t.ticketNo=!(!o||o.length<3))&&i,this.props.editTracker){const s=l()(e.dateStarted),o=l()().startOf("day").toDate();i=(t.dateStarted=s.isValid()&&s.isBetween(o,new Date))&&i}else i=(t.dateStarted=!(!e.dateStarted||e.dateStarted.length<16))&&i,t.overrideTimeSpent=e.allowOverride&&e.overrideTimeSpent&&e.overrideTimeSpent.length>=4,t.overrideTimeSpent=t.overrideTimeSpent&&this.$worklog.getTimeSpent(e.overrideTimeSpent)>0,i=(t.overrideTimeSpent=t.overrideTimeSpent||!e.allowOverride&&e.timeSpent&&e.timeSpent.length>=4)&&i;return i=(t.description=this.minCommentLength<1||!(!e.description||e.description.length<this.minCommentLength))&&i,s.ticketNo=t.ticketNo?"is-valid":"is-invalid",s.dateStarted=t.dateStarted?"is-valid":"is-invalid",s.overrideTimeSpent=t.overrideTimeSpent?"is-valid":"is-invalid",s.description=t.description?"is-valid":"is-invalid",i}getTicketNo(e){return e&&e.ticketNo?"string"===typeof e.ticketNo?e.ticketNo:e.ticketNo.value:null}deleteWorklog(e){this.setState({isLoading:!0});const t=e.ticketNo;e.ticketNo=t.value||t,this.$worklog.deleteWorklog(e).then((t=>{this.setState({isLoading:!1}),this.props.onDone({type:d.Xk.DeletedWorklog,removed:e.id,deleted:e.id,deletedObj:e}),this.onHide()}),(()=>{e.ticketNo=t}))}getFooter(){const{isLoading:e,state:{log:t,vald:s,uploadImmediately:i}}=this;return(0,h.jsxs)(h.Fragment,{children:[!t.id&&(0,h.jsx)(r.XZ,{checked:i,className:"pull-left",label:"Upload immediately to Jira",onChange:e=>this.setState({uploadImmediately:e})}),t.id>0&&(0,h.jsx)(r.zx,{type:"danger",icon:"fa fa-trash-o",label:"Delete",className:"pull-left",disabled:e,onClick:()=>this.deleteWorklog(t)}),t.id>0&&!t.worklogId&&(0,h.jsx)(r.zx,{type:"success",isLoading:e,icon:"fa fa-upload",label:"Save & Upload",className:"pull-left",disabled:e,onClick:()=>this.saveWorklog(t,s,!0)}),(0,h.jsx)(r.zx,{type:"primary",icon:"fa fa-save",label:"Save",isLoading:e,disabled:e,onClick:()=>this.saveWorklog(t,s,i&&!(t.id>0))}),(0,h.jsx)(r.zx,{type:"secondary",icon:"fa fa-times",label:"Cancel",onClick:this.onHide})]})}render(){const{minCommentLength:e,state:{log:t,vald:s}}=this;return this.state.log?super.renderBase((0,h.jsxs)("div",{className:"pad-22",onKeyPress:this.handleKeyPress,children:[(0,h.jsxs)("div",{className:"row pad-b",children:[(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)("strong",{children:"Log time"})}),(0,h.jsx)("div",{className:"p-col-9 col-sm-9",children:(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("div",{className:"ctlClass.dateStarted",children:(0,h.jsx)(r.Mt,{value:t.dateStarted,showTime:!0,onChange:e=>this.setValue("dateStarted",e)})}),(0,h.jsx)("span",{className:"help-block "+(s.dateStarted?"":"msg-error"),children:"Provide the time you had started the work"})]})})]}),(0,h.jsxs)("div",{className:"row pad-b",children:[(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)("strong",{children:"Ticket no"})}),(0,h.jsxs)("div",{className:"col-sm-9",children:[(0,h.jsx)(r.Qc,{value:t.ticketNo,displayField:"value",className:"w-p-100",placeholder:"Enter the ticket number or start typing the summary to get suggestion",dataset:this.searchTickets,disabled:t.isUploaded,maxLength:20,onChange:e=>this.setValue("ticketNo",e),autoFocus:!0,children:e=>(0,h.jsx)("span",{style:{fontSize:12,margin:"10px 10px 0 0"},children:e.label})}),(0,h.jsx)("span",{className:"help-block "+(s.ticketNo?"":"msg-error"),children:"Provide the ticket no on which you had to log your work"})]})]}),!this.props.editTracker&&(0,h.jsxs)("div",{className:"row pad-b",children:[(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)("strong",{children:"Actual time spent"})}),(0,h.jsx)("div",{className:"col-sm-2",children:(0,h.jsx)("strong",{children:this.formatTs(t.timeSpent)||"-"})}),(0,h.jsx)("div",{className:"col-sm-4",children:(0,h.jsx)("strong",{children:"Override time spent"})}),(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)("div",{className:"form-group no-margin",children:(0,h.jsxs)("div",{className:"p-inputgroup ctlClass.overrideTimeSpent",children:[(0,h.jsx)("span",{className:"p-inputgroup-addon",children:(0,h.jsx)(r.XZ,{checked:t.allowOverride||!1,onChange:e=>this.setValue("allowOverride",e)})}),(0,h.jsx)(i.InputMask,{mask:"99:99",className:"w-80",value:t.overrideTimeSpent||"",placeholder:"00:00",maxlength:5,disabled:!t.allowOverride,onChange:e=>this.setValue("overrideTimeSpent",e.value)})]})})}),(0,h.jsx)("div",{className:"col-sm-3"}),(0,h.jsx)("div",{className:"col-sm-9 no-t-padding",children:(0,h.jsx)("span",{className:"help-block "+(s.overrideTimeSpent?"":"msg-error"),children:"Provide the time spent on this task (override to change existing)"})})]}),(0,h.jsxs)("div",{className:"row",children:[(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)("strong",{children:"Comments"})}),(0,h.jsx)("div",{className:"col-sm-9",children:(0,h.jsx)(r.zC,{multiline:!0,rows:5,value:t.description||"",className:"form-control "+(s.description?"":"ctl-error"),onChange:e=>this.setValue("description",e),placeholder:"Provide a brief info about the task you had done."+(e?` Should be atleast ${e} chars is length. You can change this settings from General settings -> Worklog tab`:"")})})]})]})):"Loading..."}}const g=p},1003:(e,t,s)=>{s.d(t,{f:()=>M,kW:()=>X,Xk:()=>i.X,Z$:()=>be,Em:()=>ke,Qk:()=>ye,WP:()=>ve,dS:()=>Te,Uz:()=>Z,bM:()=>Ne,dL:()=>he});var i=s(551),o=s(7313),a=s(4918),r=s(4616),n=s(4224),l=s(8397),d=s(5004),c=s(8405),h=s(8105),p=s(816),g=s.n(p),m=s(9168),u=s(1270),k=s(1485),f=s(3972),x=s(1287),y=s(4711),j=s(6417);class v extends o.PureComponent{constructor(){super(...arguments),this.state={},this.toggleShowAttendees=()=>this.setState({showAttendees:!this.state.showAttendees}),this.toggleShowDesc=()=>this.setState({showFullDesc:!this.state.showFullDesc})}render(){const{props:{cut:e,eventDetails:t},state:{showAttendees:s,showFullDesc:i}}=this;return t?(0,j.jsxs)("div",{className:"event-details",children:[(0,j.jsxs)("div",{className:"header",children:[(0,j.jsx)("div",{className:"controls"}),(0,j.jsx)("div",{className:"title",children:e(t.summary,75)})]}),(0,j.jsxs)("div",{className:"body",children:[(0,j.jsxs)("div",{className:"detail",children:[(0,j.jsx)("div",{className:"title",children:(0,j.jsx)("i",{className:"fa fa-clock-o"})}),(0,j.jsxs)("div",{className:"info",children:[(0,j.jsx)("span",{children:t.date}),(0,j.jsxs)("span",{className:"info",children:[t.startTime," - ",t.endTime," ",t.remaining]})]})]}),t.location&&(0,j.jsxs)("div",{className:"detail",children:[(0,j.jsx)("div",{className:"title",children:(0,j.jsx)("i",{className:"fa fa-map-marker"})}),(0,j.jsx)("div",{className:"info",children:t.location})]}),t.videoCall&&(0,j.jsxs)("div",{className:"detail",children:[(0,j.jsx)("div",{className:"title",children:(0,j.jsx)("i",{className:"fa fa-video-camera"})}),(0,j.jsx)("div",{className:"info",children:(0,j.jsxs)("a",{href:t.videoCall.url,target:"_blank",rel:"noopener noreferrer",children:["Join meeting: ",t.videoCall.name]})})]}),t.attendees&&(0,j.jsxs)("div",{className:"detail pointer",children:[(0,j.jsx)("div",{className:"title",children:(0,j.jsx)("i",{className:"fa fa-users"})}),(0,j.jsxs)("div",{className:"info",onClick:this.toggleShowAttendees,children:[(0,j.jsx)("div",{className:"icon pull-right",children:(0,j.jsx)("i",{className:"fa "+(s?"fa-angle-up":"fa-angle-down")})}),(0,j.jsxs)("div",{children:[(0,j.jsxs)("span",{children:[t.attendees.total," guests"]}),t.attendees&&(0,j.jsxs)("span",{className:"info",children:[t.attendees.yes&&(0,j.jsxs)("font",{children:[t.attendees.yes," yes,"]}),t.attendees.no&&(0,j.jsxs)("font",{children:[t.attendees.no," no,"]}),t.attendees.tentative&&(0,j.jsxs)("font",{children:[" ",t.attendees.tentative," tentative,"]}),t.attendees.awaiting&&(0,j.jsxs)("font",{children:[" ",t.attendees.awaiting," awaiting"]})]})]})]}),s&&t.attendees&&(0,j.jsx)("div",{className:"attendees",children:t.attendees.list.map(((e,t)=>(0,j.jsxs)("div",{className:"attendee",children:[e.displayName&&(0,j.jsxs)("span",{className:"name",children:[" ",e.displayName]}),e.email&&(0,j.jsxs)("span",{className:"email",children:[" (",e.email,")"]})]},t)))})]}),t.description&&(0,j.jsxs)("div",{className:"detail",children:[(0,j.jsx)("div",{className:"title",children:(0,j.jsx)("i",{className:"fa fa-align-justify"})}),(0,j.jsx)("div",{className:"info",children:(0,y.rg)(i?t.description:e(t.description,350))}),t.description.length>350&&(0,j.jsx)("div",{style:{textAlign:"center"},children:(0,j.jsx)("span",{className:"link",onClick:this.toggleShowDesc,children:i?"show less":"show all"})})]})]})]}):null}}const w=v;var S=s(1783),T=s(9165);class C extends S.Z{constructor(e){super(e,"Calendar configurations"),this.setValue=(e,t)=>{let{settings:s}=this.state;s={...s},e||!1===e?s[t]=e:delete s[t],this.setState({settings:s})},this.onDone=()=>{this.props.onDone(this.state.settings),this.onHide()},this.state={showDialog:!0,settings:{...e.settings}},this.style={width:"667px"}}getFooter(){return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(T.zx,{type:"default",icon:"fa fa-times",label:"Cancel",onClick:this.onHide}),(0,j.jsx)(T.zx,{type:"success",icon:"fa fa-floppy-o",label:"Done",onClick:this.onDone})]})}render(){const{settings:e}=this.state;return super.renderBase((0,j.jsxs)("div",{className:"pad-22",children:[(0,j.jsx)("h3",{className:"control-sidebar-heading",children:"Item Colors"}),(0,j.jsxs)("div",{className:"form-group row",children:[(0,j.jsx)("label",{className:"col-md-3 col-form-label",children:"Meeting entry color"}),(0,j.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,j.jsx)(T.zH,{value:e.eventColor,fieldName:"eventColor",onChange:this.setValue}),(0,j.jsx)("label",{className:"form-check-label",children:"Specify the color of the entry for meeting"})]})]}),(0,j.jsxs)("div",{className:"form-group row",children:[(0,j.jsx)("label",{className:"col-md-3 col-form-label",children:"Worklog entry color"}),(0,j.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,j.jsx)(T.zH,{value:e.worklogColor,fieldName:"worklogColor",onChange:this.setValue}),(0,j.jsx)("label",{className:"form-check-label",children:"Specify the color of the worklog entry"})]})]}),(0,j.jsxs)("div",{className:"form-group row",children:[(0,j.jsx)("label",{className:"col-md-3 col-form-label",children:"Info color (Valid)"}),(0,j.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,j.jsx)(T.zH,{value:e.infoColor_valid,fieldName:"infoColor_valid",onChange:this.setValue}),(0,j.jsx)("label",{className:"form-check-label",children:"Specify the color of the info entry when the total hours logged is equal to the max hours to log setting"})]})]}),(0,j.jsxs)("div",{className:"form-group row",children:[(0,j.jsx)("label",{className:"col-md-3 col-form-label",children:"Info color (Less)"}),(0,j.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,j.jsx)(T.zH,{value:e.infoColor_less,fieldName:"infoColor_less",onChange:this.setValue}),(0,j.jsx)("label",{className:"form-check-label",children:"Specify the color of the info entry when the total hours logged is lesser than the max hours to log"})]})]}),(0,j.jsxs)("div",{className:"form-group row",children:[(0,j.jsx)("label",{className:"col-md-3 col-form-label",children:"Info color (High)"}),(0,j.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,j.jsx)(T.zH,{value:e.infoColor_high,fieldName:"infoColor_high",onChange:this.setValue}),(0,j.jsx)("label",{className:"form-check-label",children:"Specify the color of the info entry when the total hours logged is higher than the max hours to log"})]})]}),(0,j.jsx)("h3",{className:"control-sidebar-heading",children:"Show / Hide Entries"}),(0,j.jsx)("div",{className:"form-group",children:(0,j.jsx)(T.XZ,{checked:e.showMeetings||!1,onChange:e=>this.setValue(e,"showMeetings"),label:"Display entry for meetings integrated from calendar"})}),(0,j.jsx)("div",{className:"form-group",children:(0,j.jsx)(T.XZ,{checked:e.showWorklogs||!1,onChange:e=>this.setValue(e,"showWorklogs"),label:"Display worklog added by you"})}),(0,j.jsx)("div",{className:"form-group",children:(0,j.jsx)(T.XZ,{checked:e.showInfo||!1,onChange:e=>this.setValue(e,"showInfo"),label:"Display information about total hours logged on daily basis"})})]}))}}const N=C;var b=s(6444),D=s(4074);class W extends o.PureComponent{componentDidMount(){this.props.enabled&&this.props.onChange()}render(){return null}}const $=W,L=[{value:"dayGridMonth",label:"Month"},{value:"timeGridWeek",label:"Week"},{value:"timeGridDay",label:"Day"},{value:"listMonth",label:"Month List"},{value:"listWeek",label:"Week List"},{value:"listDay",label:"Day List"},{value:"dayGridWeek",label:"Grid Week"},{value:"dayGridDay",label:"Grid Day"}],U=[l.ZP,d.ZP,h.ZP,c.Z];class P extends a.ZP{constructor(e){super(e,"Calendar","fa-calendar"),this.refreshData=()=>this.fillEvents(this.startDate,this.endDate),this.viewModeChanged=e=>{this.setState({viewMode:e}),this.calendar.getApi().changeView(e),this.saveSettings({...this.state.settings,viewMode:e},!0)},this.hideWorklogDialog=()=>this.setState({showAddWorklogPopup:!1}),this.toggleSettingsDialog=()=>this.setState({showSettingsPopup:!this.state.showSettingsPopup}),this.addEvent=e=>{if(0===e.type)return;let t=!1;const{events:s}=this.state;if(e.removed){const t=e.removed+(e.deletedObj.worklogId?`#${e.deletedObj.worklogId}`:"");e=s.first((e=>e.id===t&&1===e.entryType)),s.remove(e),this.latestData.remove((t=>t.id===e.id&&1===t.entryType))}else if(e.added||e.edited){const i=e.previousTime;(e=e.added||e.edited).backgroundColor=this.state.settings.worklogColor,e.borderColor=e.backgroundColor,s.removeAll((t=>t.id===e.id&&1===t.entryType)),s.push(e),this.latestData.removeAll((t=>t.id===e.id&&1===t.entryType)),this.latestData.push(e),t=!0,i&&this.updateAllDayEvent({start:i})}return this.updateAllDayEvent(e),this.setEventsData(s),t},this.hideOPEvent=()=>this.setState({showOpEvent:!1}),this.eventClick=e=>{const{event:t,jsEvent:s,view:i}=e;return s.target.hasAttribute("event-icon")||(this.currentMeetingViewItem=null,1===t.extendedProps.entryType?this.showWorklogPopup(t.extendedProps.sourceObject):2===t.extendedProps.entryType&&this.showCalendarDetails(t,s,i)),!1},this.renderEventContent=e=>{const{timeText:t,event:s,view:{type:i}}=e,o=s.extendedProps.entryType;if(3===o)return;const a=` (${this.$utils.formatTs(this.getEventDuration(s))})`,r=s.extendedProps.sourceObject;let n,l,d;if(r&&(n=`${t} ${a}\n${s.title}`),1===o){const e=r;d=t=>{this.mnuWL_Upload.disabled=e.isUploaded,this.currentWLItem=e,(0,k.pT)(t,this.contextMenuItems)},l=(0,j.jsx)("i",{className:"fa fa-ellipsis-v pull-left",title:"Show options",onClick:d,"event-icon":"true"})}else if(2===o){const e=r,t=this.latestData.some((e=>e.parentId===s.id&&1===e.entryType));d=s=>{s.stopPropagation(),s.preventDefault(),this.currentMeetingItem=e,this.mnuCal_AddWL.disabled=t,this.mnuCal_OpenUrl.disabled=!e.hangoutLink,(0,k.pT)(s,this.calMenuItems)},l=t?(0,j.jsx)("i",{className:"fa fa-ellipsis-v pull-left",title:"Show options",onClick:d,"event-icon":"true"}):(0,j.jsx)("i",{className:"fa fa-clock-o pull-left",title:"Create worklog for this meeting","event-icon":"true",onClick:t=>{t.stopPropagation(),this.createWorklog(t,e,this.defaultMeetingTicket)}})}return"timeGridWeek"===i||"timeGridDay"===i?(0,j.jsxs)("div",{ref:e=>{var t,s;return null===e||void 0===e||null===(t=e.parentElement)||void 0===t||null===(s=t.parentElement)||void 0===s?void 0:s.addEventListener("contextmenu",d)},className:"fc-content pad-8",title:n,children:[l,(0,j.jsxs)("div",{className:"fc-time",children:[(0,j.jsx)("span",{children:t}),(0,j.jsxs)("span",{className:"fc-hour",children:[" ",a]})]}),(0,j.jsx)("div",{className:"fc-title",children:s.title})]}):void 0},this.saveSettings=(e,t)=>{if(this.isGadget)return super.saveSettings(),void(!0!==t&&this.refreshData());this.$session.pageSettings.calendar=e,this.setState({settings:e},!0!==t?this.refreshData:null),this.$config.saveSettings("calendar",e)},this.setCalRef=e=>this.calendar=e,(0,r.f3)(this,"SessionService","WorklogService","MessageService","AnalyticsService","OutlookService","CalendarService","UtilsService","UserUtilsService","ConfigService","TicketService"),this.hideMenu=!e.isGadget,this.hideRefresh=!0,this.hideExport=!0,e.isGadget&&(this.className="calendar-view"),this.$session.pageSettings.calendar?this.state.settings=Object.assign({showMeetings:!0,showWorklogs:!0,showInfo:!0},this.$session.pageSettings.calendar):this.state.settings={viewMode:"timeGridWeek",showMeetings:!0,showWorklogs:!0,showInfo:!0},this.setMenuItems(),this.CurrentUser=this.$session.CurrentUser,this.maxTime=this.CurrentUser.maxHours,this.maxTime&&(this.maxTime=60*this.maxTime*60),this.fullCalendarOpts=this.getCalendarOptions()}getHint(){return(0,j.jsxs)("ul",{className:"gadget-hint",children:[(0,j.jsx)("li",{children:"Pressing left Alt and drag drop worklog will copy the worklog to target slot"}),(0,j.jsxs)("li",{children:["One click ",(0,j.jsx)("span",{className:"fa fa-clock-o"})," icon to create worklog entry for meetings"]}),(0,j.jsx)("li",{children:'You can set "Default meeting ticket" in General Settings \u21e8 Worklog tab'}),(0,j.jsx)("li",{children:"Drag and drop or resize the worklog to edit it"}),(0,j.jsx)("li",{children:"Right click worklog to see more options"})]})}async setMenuItems(){this.mnuWL_Upload={label:"Upload worklog",icon:"fa fa-upload",command:()=>this.uploadWorklog()},this.contextMenuItems=[{label:"Edit worklog",icon:"fa fa-edit",command:()=>this.showWorklogPopup(this.currentWLItem)},{label:"Open ticket",icon:"fa fa-external-link",command:()=>this.openTicket(this.currentWLItem)},{label:"Copy worklog",icon:"fa fa-copy",command:()=>this.copyWorklog()},this.mnuWL_Upload,{label:"Delete worklog",icon:"fa fa-times",command:()=>this.deleteWorklog()}];const e=(this.$session.CurrentUser.meetingTicket||"").trim().split(",").map((e=>e.trim())).filter(Boolean),t=await this.$ticket.getTicketDetails(e),s=[];e.length>0&&(e.forEach((e=>{const{fields:{summary:i=""}={}}=t[e.toUpperCase()]||{};s.push({label:i?`${e}: ${this.$utils.cut(i,65,!0)}`:e,icon:"fa fa-ticket",command:t=>this.createWorklog(t.originalEvent,this.currentMeetingItem,e)})})),1===e.length&&(this.defaultMeetingTicket=e[0])),s.length>0&&s.push({separator:!0}),s.push({label:"Choose ticket",icon:"fa fa-pencil-square-o",command:e=>this.createWorklog(e.originalEvent,this.currentMeetingItem,"")}),this.mnuCal_AddWL={label:"Add worklog to",icon:"fa fa-clock-o",items:s,command:e=>this.createWorklog(e.originalEvent,this.currentMeetingItem,"")},this.mnuCal_OpenUrl={label:"Open video call",icon:"fa fa-video-camera",command:()=>this.openVideoCall(this.currentMeetingItem)},this.calMenuItems=[this.mnuCal_AddWL,{label:"Show details",icon:"fa fa-info-circle",command:e=>this.showCalendarDetails({extendedProps:{sourceObject:this.currentMeetingItem}},e.originalEvent,null)},this.mnuCal_OpenUrl]}getCalendarOptions(){const{startOfDay:e,endOfDay:t,startOfDayDisp:s,endOfDayDisp:i,startOfWeek:o,workingDays:a,timeFormat:r}=this.CurrentUser,{viewMode:n}=this.isGadget?this.props:this.state.settings;let l=o;l&&l>0?l-=1:l=null;const d=(r||"").indexOf("tt")>-1,c=!!d&&"short";return{plugins:U,timeZone:"local",weekends:!0,displayEventTime:!0,selectable:!0,firstDay:l,height:"100%",fixedWeekCount:!1,dayMaxEventRows:!0,editable:!0,droppable:!0,slotDuration:"00:15:00",slotMinTime:s||e||b.T2,slotMaxTime:i||t||b.$K,allDayText:"total",headerToolbar:!1,nowIndicator:!0,navLinks:!0,initialView:n,businessHours:{daysOfWeek:a||b.rQ,startTime:e||b.T2,endTime:t||b.$K},slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:d,meridiem:c,hour12:d},eventTimeFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:d,meridiem:c,hour12:d},select:this.select.bind(this),datesSet:this.viewRender.bind(this),eventDrop:this.eventDrop.bind(this),eventResize:this.eventResize.bind(this),eventClick:this.eventClick}}UNSAFE_componentWillReceiveProps(e){e.viewMode&&this.setState({settings:{...this.state.settings,viewMode:e.viewMode}}),super.UNSAFE_componentWillReceiveProps(e)}createWorklog(e,t,s){if((0,k.cO)(),!t.start.dateTime)return;e.stopPropagation(),e.preventDefault();const i=p.duration(p(t.end.dateTime).diff(t.start.dateTime)),o={dateStarted:t.start.dateTime,timeSpent:`${i.hours().pad(2)}:${i.minutes().pad(2)}`,description:t.summary,parentId:t.id};return s?(o.ticketNo=s,this.$worklog.saveWorklog(o).then((t=>{var s;this.addEvent({added:t}),null===(s=e.currentTarget)||void 0===s||s.remove()}),(e=>{"string"===typeof e?this.$message.error(e):console.error(e)})),this.$analytics.trackEvent("Quick add WL",b.Jk.UserActions)):this.showWorklogPopup(o),!1}fillEvents(e,t){e=p(e).startOf("day"),t=p(t).endOf("day");const s=e=>{const t=[],s=this.state.settings;switch(s.showMeetings&&t.push(2),s.showWorklogs&&t.push(1),s.showInfo&&t.push(3),t.length){case 0:e=[];break;case 3:break;default:e=e.filter((e=>t.indexOf(e.entryType)>-1))}this.setColors(e),this.setEventsData(e)},i=[this.$worklog.getWorklogsEntry(e,t)];this.CurrentUser.googleIntegration&&this.CurrentUser.hasGoogleCredentials&&this.state.settings.showMeetings&&i.push(this.$calendar.getEvents(e,t).then(null,(e=>{let t="Unable to fetch Google meetings!";return e.error&&e.error.message&&(t+=`<br /><br />Reason:- ${e.error.message}`),this.$message.warning(t),[]}))),this.CurrentUser.outlookIntegration&&this.CurrentUser.hasOutlookCredentials&&this.state.settings.showMeetings&&i.push(this.$outlook.getEvents(e,t).then(null,(e=>{let t="Unable to fetch Outlook meetings!";return e.error&&e.error.message&&(t+=`<br /><br />Reason:- ${e.error.message}`),this.$message.warning(t),[]}))),this.setState({isLoading:!0,uploading:!1}),Promise.all(i).then((e=>{this.setState({isLoading:!1});const t=e[0],i=t.filter((e=>1===e.entryType)).groupBy((e=>p(e.start).format("YYYY-MM-DD"))).map((e=>this.getAllDayObj(e)));this.latestData=t,s(t.addRange(i).addRange(e[1]))}),(e=>(this.setState({isLoading:!1}),Promise.reject(e))))}setLoggedTime(e,t){const s=this.getTimeSpent(e);t.logged=s;let i=`Logged: ${this.$utils.formatSecs(s)}`;return t.diff=s-this.maxTime,this.maxTime&&t.diff&&(i+=` (${t.diff>0?"+":"-"}${this.$utils.formatSecs(Math.abs(t.diff))})`),this.setInfoColor(t,this.state.settings),t.title=i,t}setInfoColor(e,t){this.maxTime&&e.diff?e.backgroundColor=e.diff>0?t.infoColor_high:t.infoColor_less:e.backgroundColor=t.infoColor_valid,e.borderColor=e.backgroundColor}getTimeSpent(e){return e.sum((e=>{const t=p(e.start),s=p(e.end);return p.duration(s.diff(t)).asSeconds()}))}updateAllDayEvent(e){const t=p(e.start).format("YYYY-MM-DD"),{events:s}=this.state;s.removeAll((e=>e.id===t&&3===e.entryType));const o=s.filter((e=>1===e.entryType&&p(e.start).format("YYYY-MM-DD")===t));if(o&&o.length>0){const e=this.getAllDayObj({key:t,values:o});e.logged&&(s.push(e),this.setLoggedTime(o,e))}this.setEventsData(s),this.performAction(i.X.WorklogModified)}openTicket(e){const t=this.$userutils.getTicketUrl(e.ticketNo);window.open(t)}showWorklogPopup(e){(0,k.cO)();const t={showAddWorklogPopup:!0};if(e.copy)return t.worklogItem=e.copy,void this.setState(t);let s;if(e.id||e.parentId)s=e;else{const t=p.duration(e.end.diff(e.start));s={timeSpent:`${t.hours().pad(2)}:${t.minutes().pad(2)}`,allowOverride:!0},e.dateStarted?s.startTime=e.dateStarted:s.startTime=e.isMonthMode?p(`${e.start.format("YYYY-MM-DD")} ${this.CurrentUser.startOfDay}`,"YYYY-MM-DD HH:mm").toDate():e.start.toDate()}t.worklogItem=s,this.setState(t)}setEventsData(e){this.setState({isLoading:!1,events:[...e],pendingWorklogCount:this.getPendingWorklogs(e).length})}getAllDayObj(e){return this.setLoggedTime(e.values,{id:e.key,entryType:3,start:e.key,allDay:!0,editable:!1})}setColors(e){const t=this.state.settings,s=t.worklogColor,i=t.eventColor;e.forEach((e=>{switch(e.entryType){case 1:e.backgroundColor=s,e.borderColor=s;break;case 2:e.backgroundColor=i,e.borderColor=i;break;case 3:this.setInfoColor(e,t)}}))}select(e){let{start:t,end:s,allDay:i}=e;const o="dayGridMonth"===this.state.settings.viewMode&&!this.isGadget;return!o&&i||(this.$analytics.trackEvent("Worklog drag",b.Jk.UserActions),this.showWorklogPopup({isMonthMode:o,start:p(t),end:p(s)})),!1}showCalendarDetails(e,t,s){(0,k.cO)(),t.preventDefault(),t.stopPropagation();const i=e.extendedProps.sourceObject;if(this.$analytics.trackEvent("View event details",b.Jk.UserActions,e.extendedProps.source),"goolge"===e.extendedProps.source?this.currentMeetingItem=this.getGoogleEventView(i):"outlook"===e.extendedProps.source&&(this.currentMeetingItem=this.getOutlookEventView(i)),this.$session.isQuickView){const e=document.body.querySelector(".app-header.navbar > button[appmobilesidebartoggler]");e&&(t={currentTarget:e})}else this.currentMeetingViewItem&&(t={currentTarget:this.currentMeetingViewItem});this.opEvent.show(t),this.setState({showOpEvent:!0})}getGoogleEventView(e){const t={summary:e.summary,htmlLink:e.htmlLink,location:e.location,description:e.description,descrLimit:350,creator:e.creator,organizer:e.organizer};if(e.start){t.date=this.$userutils.formatDate(e.start.dateTime),t.startTime=this.$userutils.formatTime(e.start.dateTime);let s=p(e.start.dateTime).diff(p());s=s<0?e.end&&e.end.dateTime&&p().diff(e.end.dateTime)<0?"(now ongoing)":"":`(in ${this.$utils.formatTs(s)})`,t.remaining=s}if(e.end&&e.end.dateTime&&(t.endTime=this.$userutils.formatTime(e.end.dateTime)),e.attendees&&(t.attendees={total:e.attendees.length,yes:e.attendees.count((e=>"accepted"===e.responseStatus)),no:e.attendees.count((e=>"notAccepted"===e.responseStatus)),awaiting:e.attendees.count((e=>"needsAction"===e.responseStatus)),tentative:e.attendees.count((e=>"tentative"===e.responseStatus)),list:e.attendees}),e.hangoutLink){let s=e.hangoutLink;s.lastIndexOf("/")>0&&(s=s.substring(s.lastIndexOf("/")+1)),t.videoCall={url:e.hangoutLink,name:s}}return t}getOutlookEventView(e){const t={summary:e.subject,htmlLink:e.webLink,location:(e.location||{}).displayName,description:e.bodyPreview,descrLimit:350,creator:e.creator,organizer:((e.organizer||{}).emailAddress||{}).name};if(e.start){t.date=this.$userutils.formatDate(e.start.dateTime),t.startTime=this.$userutils.formatTime(e.start.dateTime);let s=p(e.start.dateTime).diff(p());s=s<0?e.end&&e.end.dateTime&&p().diff(e.end.dateTime)<0?"(now ongoing)":"":`(in ${this.$utils.formatTs(s)})`,t.remaining=s}if(e.end&&e.end.dateTime&&(t.endTime=this.$userutils.formatTime(e.end.dateTime)),e.attendees&&(t.attendees={total:e.attendees.length,yes:e.attendees.count((e=>"accepted"===(e.status||{}).response)),no:e.attendees.count((e=>"notAccepted"===(e.status||{}).response)),awaiting:e.attendees.count((e=>"needsAction"===(e.status||{}).response)),tentative:e.attendees.count((e=>"tentative"===(e.status||{}).response)),list:e.attendees.map((e=>{const{emailAddress:{address:t,name:s}}=e;return{email:t,displayName:s}}))}),e.onlineMeetingUrl){let s=e.onlineMeetingUrl;s.lastIndexOf("/")>0&&(s=s.substring(s.lastIndexOf("/")+1)),t.videoCall={url:e.onlineMeetingUrl,name:s}}return t}openVideoCall(e){(0,k.cO)(),e&&e.hangoutLink&&window.open(e.hangoutLink)}viewRender(e){const{view:t}=e;this.startDate=t.activeStart,this.endDate=t.activeEnd,this.title=`Calendar - [${t.title.replace(/[^a-zA-Z0-9, ]+/g,"-")}]`,this.saveSettings({...this.state.settings,viewMode:t.type})}eventDrop(e){const{event:t,revert:s,jsEvent:i}=e,o=t.extendedProps.sourceObject,a=i.ctrlKey||i.altKey;if(!a&&o.isUploaded){const t=e.el.querySelector("i.fa-ellipsis-v");t&&(t.classList.replace("fa-ellipsis-v","fa-refresh"),t.classList.add("fa-spin")),s()}if(a){s();const e=this.state.events.first((e=>1===e.entryType&&e.id===t.id));if(e){const t=e.sourceObject;e.start=p(new Date(t.dateStarted)).toDate(),e.end=p(new Date(t.dateStarted)).add(this.$worklog.getTimeSpent(t),"minutes").toDate()}this.$worklog.copyWorklog(o,t.start).then((e=>{this.addEvent({added:e}),this.$analytics.trackEvent("Worklog quick copied",b.Jk.UserActions,o.isUploaded?"Uploaded worklog":"Pending worklog")}))}else{const e=o.dateStarted;this.$worklog.changeWorklogDate(o,t.start).then((t=>{this.$analytics.trackEvent("Worklog moved",b.Jk.UserActions,o.isUploaded?"Uploaded worklog":"Pending worklog"),this.addEvent({previousTime:e,edited:t})}))}}eventResize(e){const{event:t}=e;this.$worklog.changeWorklogTS(t.extendedProps.sourceObject,this.getEventDuration(t)).then((e=>{this.addEvent({edited:e}),this.$analytics.trackEvent("Worklog resized",b.Jk.UserActions,t.extendedProps.sourceObject.isUploaded?"Uploaded worklog":"Pending worklog")}))}getEventDuration(e){if(e.end&&e.start){const t=p.duration(p(e.end).diff(e.start));return`${t.hours().pad(2)}:${t.minutes().pad(2)}`}if(e.extendedProps.sourceObject){const t=e.extendedProps.sourceObject,s=t.overrideTimeSpent||t.timespent;if(s&&~s.indexOf(":"))return s}return"00:00"}uploadWorklog(e){if(this.setState({uploading:!0}),(0,k.cO)(),e){const e=this.getPendingWorklogs().map((e=>e.sourceObject.id));this.$worklog.uploadWorklogs(e).then((()=>{this.$message.success(`${e.length} worklog(s) uploaded successfully!`),this.$analytics.trackEvent("Worklog uploaded: All",b.Jk.UserActions),this.refreshData()}),this.refreshData)}else this.$worklog.uploadWorklogs([this.currentWLItem.id],!0).then((e=>{this.setState({uploading:!1}),this.$message.success("Worklog uploaded successfully!");const{events:t}=this.state;t.removeAll((e=>1===e.entryType&&e.id.toString()===this.currentWLItem.id.toString())),this.addEvent({added:this.$worklog.getWLCalendarEntry(e[0])}),this.$analytics.trackEvent("Worklog uploaded: Individual",b.Jk.UserActions)}),(()=>this.setState({uploading:!1})))}deleteWorklog(){(0,k.cO)(),this.$worklog.deleteWorklog(this.currentWLItem).then((()=>{this.$analytics.trackEvent("Worklog deleted",b.Jk.UserActions,this.currentWLItem.isUploaded?"Uploaded worklog":"Pending worklog"),this.addEvent({removed:this.currentWLItem.id,deletedObj:this.currentWLItem})}))}copyWorklog(){(0,k.cO)();const e=Object.create(this.currentWLItem);e.copy=!0,this.showWorklogPopup({copy:e})}getPendingWorklogs(e){return e||(e=this.state.events),e.filter((e=>1===e.entryType&&!e.sourceObject.isUploaded))}executeEvent(e){e.type!==i.X.AddWorklog&&e.type!==i.X.DeletedWorklog&&e.type!==i.X.WorklogModified||this.refreshData()}renderCustomActions(){const{isGadget:e,state:{pendingWorklogCount:t,isLoading:s,uploading:i}}=this;return(0,j.jsxs)(j.Fragment,{children:[!this.isGadget&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(m.Z,{icon:"fa fa-arrow-left",onClick:()=>this.calendar.getApi().prev()}),(0,j.jsx)(m.Z,{icon:"fa fa-arrow-right",onClick:()=>this.calendar.getApi().next()}),(0,j.jsx)(u.Z,{dataset:L,value:this.state.settings.viewMode,valueField:"value",displayField:"label",placeholder:"Select a view mode",onChange:this.viewModeChanged})]}),(0,j.jsxs)("span",{className:"info-badge",title:t?`Upload ${t} pending worklog(s)`:"No worklog pending to be uploaded",children:[t>0&&(0,j.jsx)("span",{className:"info btn-warning",children:t}),(0,j.jsx)(m.Z,{type:"success",icon:i?"fa fa-spin fa-spinner":"fa fa-upload",disabled:i||t<1||s,onClick:()=>this.uploadWorklog(!0)})]}),(0,j.jsx)(m.Z,{icon:"fa fa-refresh",disabled:s||i,onClick:this.refreshData,title:"Refresh meetings and worklogs"}),!e&&(0,j.jsx)(m.Z,{icon:"fa fa-cogs",onClick:this.toggleSettingsDialog,title:"Show settings"})]})}render(){var e;const{hideWorklogDialog:t,addEvent:s,state:{showAddWorklogPopup:i,showSettingsPopup:o,worklogItem:a,events:r,showOpEvent:l,isLoading:d}}=this;return super.renderBase((0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(n.ZPm,{ref:this.setCalRef,events:r,...this.fullCalendarOpts,eventContent:this.renderEventContent}),i&&(0,j.jsx)(f.Z,{worklog:a,onDone:s,onHide:t}),o&&(0,j.jsx)(N,{settings:this.state.settings,onDone:this.saveSettings,onHide:this.toggleSettingsDialog}),(0,j.jsx)(x.T,{className:"op-event-details",ref:e=>{this.opEvent=e},showCloseIcon:!0,dismissable:!0,appendTo:document.body,onHide:this.hideOPEvent,children:l&&this.currentMeetingItem&&(0,j.jsx)(w,{eventDetails:this.currentMeetingItem,cut:this.$utils.cut})}),(0,j.jsx)($,{enabled:!d&&this.context.needReload,onChange:this.refreshData},null===(e=this.context.timerEntry)||void 0===e?void 0:e.key)]}))}}P.contextType=D.a2;const M=P;var E=s(1857),A=s(2251);class I extends o.PureComponent{constructor(e){super(e),(0,r.f3)(this,"JiraService","SessionService");const{epicNameField:t,storyPointField:s}=this.$session.CurrentUser;this.epicNameField=null===t||void 0===t?void 0:t.id,this.storyPointField=null===s||void 0===s?void 0:s.id;const i=["key","summary","project","status","parent","assignee","issuetype","reporter","created","changeLog","timeestimate","aggregatetimeestimate","timeoriginalestimate","aggregatetimeoriginalestimate"];this.epicNameField&&i.push(this.epicNameField),this.storyPointField&&i.push(this.storyPointField),this.fieldNames=i,this.state={}}componentDidMount(){this.fetchData()}UNSAFE_componentWillReceiveProps(e){const{jql:t}=e;this.jql!==(null===t||void 0===t?void 0:t.trim())&&this.fetchData()}async fetchData(){const{jql:e,setLoader:t}=this.props;if(this.jql=null===e||void 0===e?void 0:e.trim(),this.jql){t&&t(!0);try{const s=await this.$jira.searchTickets(e,this.fieldNames,0,{expand:["changelog"]}),i=(new Date).getTime(),o=s.map((e=>{const{key:t,changelog:{histories:s}={},fields:{summary:o,status:a,issuetype:r,assignee:n,reporter:l,created:d,project:c,parent:h,timeestimate:p,aggregatetimeestimate:m,timeoriginalestimate:u,aggregatetimeoriginalestimate:k,[this.epicNameField]:f,[this.storyPointField]:x}}=e,y=[];let j=s.length;for(;--j>=0;){const{created:e,items:t}=s[j];t.filter((e=>"status"===e.field)).forEach((t=>{const{fromString:s,toString:i}=t;y.push({date:g()(e).toDate().getTime(),from:s,to:i})}))}let v=g()(d).toDate().getTime();const w=y.length-1,S=y.reduce(((e,t,s)=>{const{date:o,from:a,to:r}=t;return e[a]=(e[a]||0)+(o-v),v=o,w===s&&(e[r]=(e[r]||0)+(i-v)),e}),{});return Object.keys(S).forEach((e=>{S[e]||delete S[e]})),{key:t,summary:o,status:a,issuetype:r,assignee:n,reporter:l,created:d,project:c,parent:h,timeestimate:p,aggregatetimeestimate:m,timeoriginalestimate:u,aggregatetimeoriginalestimate:k,statusData:S,changelog:y,epic:f,storyPoint:x}})),a=o.distinct((e=>e.project.key)),r=await this.getStatuses(a);this.columnList=this.getFieldList(r),this.setState({reportData:o,statusList:r})}finally{t&&t(!1)}}else this.setState({reportData:[],statusList:[]})}getFieldList(e){const{onAddWorklog:t}=this.props;return[{field:"key",displayText:"Ticket No",type:"string",viewComponent:A.a3,props:{onAddWorklog:t}},{field:"summary",displayText:"Summary",type:"string"},{field:"project",fieldKey:"project.key",displayText:"Project",type:"string",viewComponent:A.Bx},{field:"issuetype",fieldKey:"issuetype.name",displayText:"Issue Type",type:"string",viewComponent:A.y5},{field:"epic",displayText:"Epic",type:"string",viewComponent:A.a3,props:{hideWorklog:!0}},{field:"storyPoint",displayText:"Story Points",type:"number"},{field:"timeestimate",displayText:"Time Estimate",type:"number",viewComponent:A.Hv},{field:"aggregatetimeestimate",displayText:"\u03a3 Time Estimate",type:"number",viewComponent:A.Hv},{field:"timeoriginalestimate",displayText:"Original Estimate",type:"number",viewComponent:A.Hv},{field:"aggregatetimeoriginalestimate",displayText:"\u03a3 Original Estimate",type:"number",viewComponent:A.Hv},{field:"parent",fieldKey:"project.key",displayText:"Parent",type:"string",viewComponent:A.lc,props:{onAddWorklog:t}},{field:"status",fieldKey:"status.name",displayText:"Status",type:"string",viewComponent:A.y5},{field:"created",displayText:"Created",type:"datetime",viewComponent:A.qm},{field:"assignee",fieldKey:"assignee.displayName",displayText:"Assignee",type:"string",viewComponent:A.H},{field:"reporter",fieldKey:"reporter.displayName",displayText:"Reporter",type:"string",viewComponent:A.H},...e.map((e=>({field:`statusData.${e.name}`,displayText:`Spent on ${e.name}`,type:"number",viewComponent:A.Hv,props:{inputType:"ticks",days:!0}})))]}async getStatuses(e){const t=await this.$jira.getProjectStatuses(e),s=[],i=[];return t.forEach((e=>{e.forEach((e=>{e.statuses.forEach((e=>{if(~s.indexOf(e.id))return;const{id:t,name:o,iconUrl:a}=e;s.push(t),i.push({name:o,iconUrl:a})}))}))})),i}render(){const{columnList:e,state:{loading:t,reportData:s},props:{settings:i,settingsChanged:o}}=this,{displayColumns:a,groupBy:r,groupFoldable:n,sortField:l,isDesc:d}=i||{};return(0,j.jsx)("div",{className:"statuswise-ts-grid",children:!t&&s&&(0,j.jsx)(E.Z,{dataset:s,exportSheetName:"Status wise time spent",columns:e,allowSorting:!0,onChange:o,displayColumns:a,groupBy:r,groupFoldable:n,sortField:l,isDesc:d,noRowsMessage:"No ticket details available"})})}}const R=I;var O=s(218);class F extends S.Z{constructor(e){super(e,"Gadget configurations"),this.onDone=()=>{this.onHide(this.state.pageSettings)},this.onChange=(e,t)=>{let{pageSettings:s}=this.state;s={...s,jql:e,jqlSettings:t},this.setState({pageSettings:s})},this.className="no-padding";const{pageSettings:t}=e;this.state={showDialog:!0,pageSettings:{...t}}}getFooter(){return(0,j.jsx)(T.zx,{icon:"fa fa-floppy-o",label:"Done",onClick:this.onDone})}render(){const{pageSettings:{jql:e,jqlSettings:t}}=this.state;return super.renderBase((0,j.jsx)("div",{children:(0,j.jsx)(O.Z,{jql:e,settings:t,onChange:this.onChange})}))}}const B=F;class H extends a.ZP{constructor(e){super(e,"Status Wise Time Spent","fa-list-alt"),this.settingsChanged=e=>{this.pageSettingsChanged({gridSettings:e})},this.pageSettingsChanged=e=>{e&&(this.settings={...this.settings,...e},this.saveSettings()),this.setState({showSettings:!1,settings:e})},this.showSettings=()=>{this.setState({showSettings:!0})},this.setLoader=e=>{this.setState({isLoading:e})},this.refreshData=()=>{let{gridKey:e}=this.state;e++,this.setState({gridKey:e})},(0,r.f3)(this,"SessionService","AnalyticsService"),this.state.gridKey=0}renderCustomActions(){return(0,j.jsx)(T.zx,{icon:"fa fa-cogs",onClick:this.showSettings,title:"Show settings"})}render(){const{showSettings:e,gridKey:t}=this.state,{jql:s,gridSettings:i}=this.settings||{};return super.renderBase((0,j.jsxs)("div",{className:"status-wise-ts-gadget",children:[!s&&(0,j.jsxs)("div",{className:"no-jql",children:["No JQL was set to fetch the data. Click on ",(0,j.jsx)("span",{className:"fa fa-cogs"})," icon from top right corner of the gadget and modify the JQL to fetch data from Jira."]}),s&&(0,j.jsx)(R,{setLoader:this.setLoader,jql:s,settings:i,settingsChanged:this.settingsChanged,onAddWorklog:this.addWorklogOn},t),e&&(0,j.jsx)(B,{pageSettings:this.settings,onHide:this.pageSettingsChanged})]}))}}const Z=H;var V=s(5991),z=s(1329),q=s(9341);class _ extends a.ZP{constructor(e){super(e,"Daywise worklog","fa-list-alt"),this.refreshData=()=>{const e=this.settings.dateRange;if(!e)return;const[t,s]=(0,q.dq)(e.quickDate)||[];t&&(e.fromDate=t,e.toDate=s),e.fromDate&&(this._isMounted?this.setState({isLoading:!0}):this.state.isLoading=!0,e.dateWise=!0,this.$worklog.getWorklogs(e).then((e=>{e.forEach((e=>e.rowClass=this.$utils.getRowStatus(e))),this.setState({worklogs:e,isLoading:!1})})))},(0,V.f3)(this,"WorklogService","UtilsService","UserUtilsService"),this.contextMenu=[{label:"Upload worklog",icon:"fa fa-clock-o",command:()=>this.uploadWorklog()},{label:"Add worklog",icon:"fa fa-bookmark",command:()=>this.addWorklog()}]}componentDidMount(){super.componentDidMount(),this.refreshData()}getWorklogUrl(e,t){return this.$userutils.getWorklogUrl(e,t)}showContext(e,t){this.selectedDay=t,(0,k.pT)(e,this.contextMenu)}dateSelected(e){this.settings.dateRange=e,e.toDate&&(this.refreshData(),e.auto||this.saveSettings())}uploadWorklog(){const e=this.selectedDay.ticketList.filter((e=>!e.worklogId)).map((e=>e.id));0!==e.length&&(this.setState({isLoading:!0}),this.$worklog.uploadWorklogs(e).then((()=>{this.refreshData(),super.performAction(a.Xk.WorklogModified)}),(e=>{this.setState({isLoading:!1})})))}addWorklog(){let e=g()(this.selectedDay.dateLogged).toDate();g()(e).isSame(g()(),"day")&&(e=new Date);let t=null;this.selectedDay.pendingUpload>0&&(t=this.$utils.formatTs(this.selectedDay.pendingUpload,!0)),super.addWorklog({startTime:e,timeSpent:t,allowOverride:!!t})}executeEvent(e){e.type!==a.Xk.AddWorklog&&e.type!==a.Xk.DeletedWorklog&&e.type!==a.Xk.WorklogModified||this.refreshData()}renderCustomActions(){return(0,j.jsx)(T.Mt,{range:!0,value:this.settings.dateRange,onChange:e=>this.dateSelected(e),style:{marginRight:"35px"}})}render(){var e;const{state:{worklogs:t,isLoading:s}}=this;return super.renderBase((0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(z.TT,{dataset:t,exportSheetName:"Datewise worklog",children:[(0,j.jsx)(z.Et,{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)(z.sg,{sortBy:"dateLogged",style:{width:"100px"},children:"Logged Date"}),(0,j.jsx)(z.sg,{sortBy:"totalHours",children:"Total Hours"}),(0,j.jsx)(z.sg,{sortBy:"uploaded",children:"Uploaded"}),(0,j.jsx)(z.sg,{sortBy:"pendingUpload",children:"Pending Upload"}),(0,j.jsx)(z.sg,{children:"Ticket List"})]})}),(0,j.jsx)(z.XP,{children:e=>(0,j.jsxs)("tr",{onContextMenu:t=>this.showContext(t,e),className:e.rowClass,children:[(0,j.jsx)("td",{children:this.$userutils.formatDate(e.dateLogged)}),(0,j.jsx)("td",{children:this.$utils.formatTs(e.totalHours)}),(0,j.jsx)("td",{children:this.$utils.formatTs(e.uploaded)}),(0,j.jsx)("td",{children:this.$utils.formatTs(e.pendingUpload)}),(0,j.jsx)("td",{children:(0,j.jsx)("ul",{className:"tags",children:e.ticketList.map(((e,t)=>(0,j.jsxs)("li",{children:[e.worklogId&&(0,j.jsxs)("a",{className:"link badge badge-pill skin-bg-font",href:this.getWorklogUrl(e.ticketNo,e.worklogId),target:"_blank",rel:"noopener noreferrer",title:e.comment,children:[(0,j.jsx)("span",{className:"fa fa-clock-o"})," ",e.ticketNo,": ",e.uploaded]}),!e.worklogId&&(0,j.jsxs)("span",{className:"link badge badge-pill skin-bg-font",onClick:()=>this.editWorklog(e.id),title:e.comment,children:[(0,j.jsx)("span",{className:"fa fa-clock-o"})," ",e.ticketNo,": ",e.uploaded]})]},t)))})})]},e.dateLogged)}),(0,j.jsx)(z.ch,{span:5,children:"No worklog exists for selected date range!"})]}),(0,j.jsx)($,{enabled:!s&&this.context.needReload,onChange:this.refreshData},null===(e=this.context.timerEntry)||void 0===e?void 0:e.key)]}))}}_.contextType=D.a2;const X=_;var G=s(4902),Y=s(2371);class K extends S.Z{constructor(e){super(e,"Report configurations"),this.onDone=()=>{this.$config.saveSettings("reports_UserDayWise",this.state.pageSettings),this.onHide(this.state.pageSettings)},this.setValue=(e,t)=>{let{pageSettings:s}=this.state;s[e]=t,s={...s},this.setState({pageSettings:s})},(0,V.f3)(this,"ConfigService"),this.className="no-padding";const{pageSettings:t}=e;this.state={showDialog:!0,pageSettings:{...t}},this.hideEstimate=t.hideEstimate}getFooter(){return(0,j.jsx)(T.zx,{icon:"fa fa-floppy-o",label:"Done",onClick:this.onDone})}render(){const{setValue:e,state:{pageSettings:{logFormat:t,breakupMode:s,timeZone:i,jql:o,hideEstimate:a,showCostReport:r,showProject:n,showParentSummary:l,showIssueType:d,showEpic:c,showAssignee:h,showReporter:p}}}=this;return super.renderBase((0,j.jsxs)(Y.TabView,{styleclass:"query-tab",children:[(0,j.jsxs)(Y.TabPanel,{header:"General",leftIcon:"fa fa-cog",contentClassName:"pad-22",children:[(0,j.jsxs)("div",{className:"form-group row",children:[(0,j.jsx)("label",{className:"col-md-3 col-form-label",children:"Log hour format"}),(0,j.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,j.jsx)("div",{className:"form-check",children:(0,j.jsxs)("label",{className:"form-check-label",children:[(0,j.jsx)("input",{className:"form-check-input",value:t,onChange:()=>e("logFormat","1"),type:"radio",checked:"1"===t,name:"hourformat"}),"Format hours (2h 30m)"]})}),(0,j.jsx)("div",{className:"form-check",children:(0,j.jsxs)("label",{className:"form-check-label",children:[(0,j.jsx)("input",{className:"form-check-input",value:t,onChange:()=>e("logFormat","2"),type:"radio",checked:"2"===t,name:"hourformat"}),"Show in hours (2.5)"]})})]})]}),(0,j.jsxs)("div",{className:"form-group row",children:[(0,j.jsx)("label",{className:"col-md-3 col-form-label",children:"Log breakup"}),(0,j.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,j.jsx)("div",{className:"form-check",children:(0,j.jsxs)("label",{className:"form-check-label",children:[(0,j.jsx)("input",{className:"form-check-input",value:s,onChange:()=>e("breakupMode","1"),type:"radio",checked:"1"===s,name:"logbreakup"}),"Single entry (Sum worklog added for same ticket on same day)"]})}),(0,j.jsx)("div",{className:"form-check",children:(0,j.jsxs)("label",{className:"form-check-label",children:[(0,j.jsx)("input",{className:"form-check-input",value:s,onChange:()=>e("breakupMode","2"),type:"radio",checked:"2"===s,name:"logbreakup"}),"Individual entry (Display individual entry for each of the worklog)"]})})]})]}),(0,j.jsxs)("div",{className:"form-group row",children:[(0,j.jsx)("label",{className:"col-md-3 col-form-label",children:"Report timezone (experimental)"}),(0,j.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,j.jsx)("div",{className:"form-check",children:(0,j.jsxs)("label",{className:"form-check-label",children:[(0,j.jsx)("input",{className:"form-check-input",value:i,onChange:()=>e("timeZone","1"),type:"radio",checked:"1"===i,name:"timezone"}),"Use my local time zone for all users"]})}),(0,j.jsx)("div",{className:"form-check",children:(0,j.jsxs)("label",{className:"form-check-label",children:[(0,j.jsx)("input",{className:"form-check-input",value:i,onChange:()=>e("timeZone","2"),type:"radio",checked:"2"===i,name:"timezone"}),"Use containing groups timezone for all users"]})}),(0,j.jsx)("div",{className:"form-check",children:(0,j.jsxs)("label",{className:"form-check-label",children:[(0,j.jsx)("input",{className:"form-check-input",value:i,onChange:()=>e("timeZone","3"),type:"radio",checked:"3"===i,name:"timezone"}),"Use individual users timezone"]})})]})]}),(0,j.jsxs)("div",{className:"row",children:[(0,j.jsxs)("div",{className:"col-4",children:[(0,j.jsx)(T.XZ,{checked:r,onChange:t=>e("showCostReport",t),label:"Show cost report"}),!!this.showCostReport!==!!r&&(0,j.jsxs)("span",{className:"pad-l-15",children:[" ( ",(0,j.jsx)("i",{className:"fa fa-exclamation-triangle",title:"Change will take effect only after report is refreshed"})," )"]})]}),(0,j.jsx)("div",{className:"col-4",children:(0,j.jsx)(T.XZ,{checked:n,onChange:t=>e("showProject",t),label:"Show Project details"})}),(0,j.jsx)("div",{className:"col-4",children:(0,j.jsx)(T.XZ,{checked:l,onChange:t=>e("showParentSummary",t),label:"Show Parent ticket"})}),(0,j.jsx)("div",{className:"col-4",children:(0,j.jsx)(T.XZ,{checked:d,onChange:t=>e("showIssueType",t),label:"Show Issue Type"})}),(0,j.jsx)("div",{className:"col-4",children:(0,j.jsx)(T.XZ,{checked:c,onChange:t=>e("showEpic",t),label:"Show Epic"})}),(0,j.jsx)("div",{className:"col-4",children:(0,j.jsx)(T.XZ,{checked:h,onChange:t=>e("showAssignee",t),label:"Show Assignee"})}),(0,j.jsx)("div",{className:"col-4",children:(0,j.jsx)(T.XZ,{checked:p,onChange:t=>e("showReporter",t),label:"Show Reporter"})}),(0,j.jsxs)("div",{className:"col-12",children:[(0,j.jsx)(T.XZ,{checked:a,onChange:t=>e("hideEstimate",t),label:"Hide estimate related fields"}),!!this.hideEstimate!==!!a&&(0,j.jsxs)("span",{className:"pad-l-15",children:[" ( ",(0,j.jsx)("i",{className:"fa fa-exclamation-triangle",title:"Change will take effect only after report is refreshed"})," )"]})]})]})]}),(0,j.jsxs)(Y.TabPanel,{header:"JQL Filter",leftIcon:"fa fa-filter",children:[(0,j.jsx)(T.zC,{multiline:!0,value:o,onChange:t=>e("jql",t),style:{width:"100%",height:411},placeholder:"Provide the additional JQL filters to be applied while fetching data.",defaultValue:""}),(0,j.jsxs)("span",{children:[(0,j.jsx)("strong",{children:"Note:"})," Date range and user list filter will be added automatically."]})]})]}))}}const J=K,Q=["-originalestimate","-totalLogged","-remainingestimate","-estVariance"];class ee extends o.PureComponent{constructor(e){super(e),this.settingsChanged=(e,t)=>{this.props.onChange(e,t)},this.setPropsInClass(e),this.state=this.getNewState(e),this.state.groupBy=[]}UNSAFE_componentWillReceiveProps(e){this.updateData(e)}updateData(e){this.data===e.flatData&&this.pageSettings===e.pageSettings||(this.setPropsInClass(e),this.setState(this.getNewState(e)))}getNewState(e){return{columns:this.getColumnSettings(e)}}setPropsInClass(e){this.data=e.flatData,this.pageSettings=this.props.pageSettings}getColumnSettings(e){var t;const{formatDateTime:s,convertSecs:i}=e,o="1"===(null===(t=e.pageSettings)||void 0===t?void 0:t.logFormat)?"string":"number";return[{field:"groupName",displayText:"Group Name",type:"string"},{field:"projectName",displayText:"Project Name",type:"string"},{field:"issueType",displayText:"Issue Type",type:"string"},{field:"epicDisplay",displayText:"Epic",type:"string",format:(e,t)=>this.formatTicket(e,t.epicUrl)},{field:"parent",displayText:"Parent",type:"string",format:(e,t)=>this.formatTicket(e,t.parentUrl)},{field:"ticketNo",displayText:"Ticket No",type:"string",format:(e,t)=>this.formatTicket(e,t.ticketUrl)},{field:"statusName",displayText:"Status",type:"string"},{field:"summary",displayText:"Summary",type:"string"},{field:"logTime",displayText:"Log Date & Time",type:"datetime",format:s},{field:"userDisplay",displayText:"Log user",type:"string"},{field:"assignee",displayText:"Assignee",type:"string"},{field:"reporter",displayText:"Reporter",type:"string"},{field:"timeSpent",displayText:"Hr. Spent",type:o,format:i},{field:"originalestimate",displayText:"Ori. Estm.",type:o,format:i},{field:"totalLogged",displayText:"Total Worklogs",type:o,format:i},{field:"remainingestimate",displayText:"Rem. Estm.",type:o,format:i},{field:"estVariance",displayText:"Estm. Variance",type:"string",format:e=>(e>0?"+":"")+i(e)},{field:"comment",displayText:"Comment"}]}formatTicket(e,t){return e&&(0,j.jsx)("a",{href:t,className:"link",target:"_blank",rel:"noopener noreferrer",children:e})}render(){const{props:{flatData:e,pageSettings:{hideEstimate:t,flatTableSettings:{groupBy:s,groupFoldable:i,displayColumns:o,sortField:a,isDesc:r}={displayColumns:t?Q:null}}={}},state:{columns:n}}=this;return(0,j.jsx)(E.Z,{className:"flat-data-grid",dataset:e,exportSheetName:"Flat Worklogs",columns:n,allowSorting:!0,onChange:this.settingsChanged,displayColumns:o,groupBy:s,groupFoldable:i,sortField:a,isDesc:r,noRowsMessage:"No worklog details available"})}}const te=ee;class se extends o.PureComponent{constructor(e){super(e),this.state={groupedData:this.generateGroupData(e)}}UNSAFE_componentWillReceiveProps(e){this.setState({groupedData:this.generateGroupData(e)})}getCssClass(e,t){if(t=t>0?t:0,e.isHoliday)return t?"log-high":"col-holiday";{const e=this.props.maxSecsPerDay;if(t===e)return"log-good";if(t<e)return"log-less";if(t>e)return"log-high"}}generateGroupData(e){const{rawData:t,dates:s,pageSettings:i,groups:o,getTicketUrl:a}=e,r=parseInt(i.timeZone),n=o.map((e=>{const i={name:e.name,total:{},totalCost:{},grandTotal:0,grandTotalCost:0,users:null};i.users=e.users.map((i=>{let o=null;2===r?o=e.timeZone:3===r&&(o=i.timeZone||e.timeZone),"GRP_TZ"===o&&(o=e.timeZone);const n={name:(0,y.vW)(i),displayName:i.displayName,emailAddress:i.emailAddress,timeZone:o,imageUrl:i.avatarUrls["48x48"]||i.avatarUrls["32x32"],profileUrl:i.self,costPerHour:i.costPerHour,tickets:null,total:{},totalCost:{},logClass:{},grandTotal:0,grandTotalCost:0},l=t.first((e=>e.userName===(0,y.vW)(i,!0)))||{};l.isCurrentUser&&(n.isCurrentUser=!0);const d=l.logData||[];n.tickets=d.groupBy((e=>e.ticketNo)).map((e=>{const t=e.values,s=t.first(),r={},n={ticketNo:e.key,parent:s.parent,parentUrl:s.parent?a(s.parent):null,parentSummary:s.parentSummary,projectKey:s.projectKey,projectName:s.projectName,assignee:s.assignee,reporter:s.reporter,epicDisplay:s.epicDisplay,epicUrl:s.epicUrl,issueType:s.issueType,statusName:s.statusName,summary:s.summary,originalestimate:s.originalestimate,remainingestimate:s.remainingestimate,totalLogged:s.totalLogged,estVariance:s.estVariance,url:s.url,logs:r,totalHours:0,totalCost:0};let l=0;return t.forEach((e=>{let t=e.logTime;o&&(t=g()(g()(t).tz(o).format("YYYY-MM-DD HH:mm:ss")).toDate());const s=t.format("yyyyMMdd");let a=r[s];a||(a=[],r[s]=a),a.push({logTime:t,totalHours:e.totalHours,totalCost:(0,y.qN)(e.totalHours,i.costPerHour),comment:e.comment}),l+=e.totalHours})),n.totalHours=l,n.totalCost=(0,y.qN)(l,i.costPerHour),n}));const c=n.logClass,h=n.total,p=n.totalCost;let m=0;return s.forEach((e=>{const t=n.tickets.sum((t=>{const s=t.logs[e.prop];return s?s.sum((e=>e.totalHours)):0}));t>0&&(h[e.prop]=t,p[e.prop]=(0,y.qN)(t,i.costPerHour),m+=t),c[e.prop]=this.getCssClass(e,t)})),n.grandTotal=m,n.grandTotalCost=(0,y.qN)(m,i.costPerHour),n}));const o=i.total,n=i.totalCost;let l=0,d=0;return s.forEach((e=>{const t=i.users.sum((t=>t.total[e.prop]||0));t>0&&(o[e.prop]=t,l+=t);const s=i.users.sum((t=>t.totalCost[e.prop]||0));s>0&&(n[e.prop]=s,d+=s)})),i.grandTotal=l,i.grandTotalCost=d,i}));let l=0,d=0;const c={},h={};return s.forEach((e=>{const t=n.sum((t=>t.total[e.prop]||0));t>0&&(c[e.prop]=t,l+=t);const s=n.sum((t=>t.totalCost[e.prop]||0));s>0&&(h[e.prop]=s,d+=s)})),n.grandTotal=l,n.grandTotalCost=d,n.total=c,n.totalCost=h,n}render(){const{state:{groupedData:e},props:{exportSheetName:t,months:s,dates:i,convertSecs:o,formatTime:a,breakupMode:r,pageSettings:n,addWorklog:l,costView:d}}=this,c="2"===(null===n||void 0===n?void 0:n.logFormat)?"float":void 0,{showProject:h,showParentSummary:p,showIssueType:g,showEpic:m,showAssignee:u,showReporter:k}=n||{},f=1+(h?1:0)+(p?1:0)+(g?1:0)+(m?1:0)+(u?1:0)+(k?1:0);return(0,j.jsxs)(z.TT,{exportSheetName:t,children:[(0,j.jsxs)(z.Et,{children:[(0,j.jsxs)("tr",{className:"data-center pad-min auto-wrap",children:[(0,j.jsx)("th",{style:{minWidth:260+120*f},rowSpan:f>1?1:2,colSpan:f,children:"User Details"}),s.map(((e,t)=>(0,j.jsx)("th",{style:{minWidth:35},colSpan:e.days,children:e.monthName},t))),!d&&(0,j.jsx)("th",{style:{minWidth:50},rowSpan:2,children:"Total Hours"}),d&&(0,j.jsx)("th",{style:{minWidth:50},rowSpan:2,children:"Total Cost"})]}),(0,j.jsxs)("tr",{className:"pad-min auto-wrap",children:[f>1&&(0,j.jsx)("th",{style:{minWidth:380},children:"Issue details"}),!!h&&(0,j.jsx)("th",{children:"Project"}),!!p&&(0,j.jsx)("th",{children:"Parent Summary"}),!!g&&(0,j.jsx)("th",{children:"Issuetype"}),!!m&&(0,j.jsx)("th",{children:"Epic"}),!!u&&(0,j.jsx)("th",{children:"Assignee"}),!!k&&(0,j.jsx)("th",{children:"Reporter"}),i.map(((e,t)=>(0,j.jsx)("th",{style:{minWidth:35},children:e.display},t)))]})]}),(0,j.jsxs)(z.XP,{children:[e.map(((e,t)=>(0,j.jsx)(oe,{colSpan:f,group:e,dates:i,addWorklog:l,costView:d,convertSecs:o,timeExportFormat:c,formatTime:a,breakupMode:r,pageSettings:n},t))),!d&&(0,j.jsxs)("tr",{className:"grouped-row right auto-wrap",children:[(0,j.jsxs)("td",{colSpan:f,children:["Grand Total ",(0,j.jsx)("i",{className:"fa fa-arrow-right"})]}),i.map(((t,s)=>(0,j.jsx)("td",{exportType:c,children:o(e.total[t.prop])},s))),(0,j.jsx)("td",{exportType:c,children:o(e.grandTotal)})]}),d&&(0,j.jsxs)("tr",{className:"grouped-row right auto-wrap",children:[(0,j.jsxs)("td",{colSpan:f,children:["Grand Total ",(0,j.jsx)("i",{className:"fa fa-arrow-right"})]}),i.map(((t,s)=>(0,j.jsx)("td",{children:e.totalCost[t.prop]},s))),(0,j.jsx)("td",{children:e.grandTotalCost})]})]})]})}}const ie=se;class oe extends o.PureComponent{constructor(){super(...arguments),this.state={},this.toggleDisplay=()=>this.setState({hidden:!this.state.hidden})}render(){const{props:{group:e,dates:t,convertSecs:s,formatTime:i,breakupMode:o,pageSettings:a,addWorklog:r,timeExportFormat:n,costView:l,colSpan:d},state:{hidden:c}}=this;return(0,j.jsxs)(j.Fragment,{children:[!c&&(0,j.jsx)("tr",{className:"grouped-row left",title:"Click to hide user details",children:(0,j.jsxs)("td",{colSpan:t.length+2,onClick:this.toggleDisplay,children:[(0,j.jsx)("i",{className:"pull-left drill-down fa fa-chevron-circle-down"}),e.name]})}),!c&&e.users.map(((e,c)=>(0,j.jsx)(ae,{colSpan:d,user:e,dates:t,breakupMode:o,costView:l,addWorklog:r,timeExportFormat:n,convertSecs:s,formatTime:i,pageSettings:a},c))),(0,j.jsxs)("tr",{className:"grouped-row right auto-wrap",onClick:c?this.toggleDisplay:null,children:[(0,j.jsxs)("td",{colSpan:d,children:[c&&(0,j.jsxs)("div",{children:[(0,j.jsx)("i",{className:"pull-left drill-down fa fa-chevron-circle-right",title:"Click to show user details"}),(0,j.jsx)("span",{className:"pull-left",children:e.name}),(0,j.jsxs)("span",{className:"pull-right",children:["Total ",(0,j.jsx)("i",{className:"fa fa-arrow-right"})]})]}),!c&&(0,j.jsxs)("div",{children:[e.name," ",(0,j.jsx)("i",{className:"fa fa-arrow-right"})," Total ",(0,j.jsx)("i",{className:"fa fa-arrow-right"})]})]}),!l&&t.map(((t,i)=>(0,j.jsx)("td",{exportType:n,children:s(e.total[t.prop])},i))),!l&&(0,j.jsx)("td",{exportType:n,children:s(e.grandTotal)}),l&&t.map(((t,s)=>(0,j.jsx)("td",{children:e.totalCost[t.prop]},s))),l&&(0,j.jsx)("td",{children:e.grandTotalCost})]})]})}}class ae extends o.PureComponent{constructor(){super(...arguments),this.state={},this.getComments=(e,t)=>e&&0!==e.length?e.map((e=>`${this.props.formatTime(e.logTime)}(${this.props.convertSecs(e.totalHours)})${t?`, Cost: ${e.totalCost}`:""} - ${e.comment}`)).join(";\n"):"",this.toggleDisplay=()=>this.setState({expanded:!this.state.expanded}),this.addWorklog=(e,t)=>{const{user:s,addWorklog:i}=this.props,{date:o,prop:a}=t;i(s,e,o,s.total[a])}}getTotalTime(e){return e&&0!==e.length?e.sum((e=>e.totalHours)):""}getTotalCost(e){return e&&0!==e.length?e.sum((e=>e.totalCost)):""}getLogEntries(e){if(Array.isArray(e)&&e.length>0){const t=e.length>1?";":"";return e.map(((e,s)=>(0,j.jsx)("span",{title:`${this.props.formatTime(e.logTime)} - ${e.comment}`,children:this.props.convertSecs(e.totalHours)+t},s)))}}render(){const{props:{user:e,dates:t,convertSecs:s,breakupMode:i,pageSettings:{hideEstimate:o,showProject:a,showParentSummary:r,showIssueType:n,showEpic:l,showAssignee:d,showReporter:c},timeExportFormat:h,costView:p,colSpan:g},state:{expanded:m}}=this;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("tr",{className:"pointer auto-wrap",onClick:this.toggleDisplay,children:[(0,j.jsx)("td",{className:"data-left",colSpan:g,children:(0,j.jsxs)("div",{className:"user-info",style:{paddingLeft:0},children:[(0,j.jsx)("i",{className:"pull-left drill-down fa "+(m?"fa-chevron-circle-down":"fa-chevron-circle-right"),title:"Click to toggle ticket details"}),(0,j.jsx)("img",{src:e.imageUrl,height:40,width:40,className:"pull-left",alt:e.displayName}),(0,j.jsx)("span",{className:"name",children:e.displayName}),(0,j.jsxs)("span",{className:"email",children:["(",e.emailAddress||e.name,e.timeZone&&(0,j.jsxs)("span",{children:[", time zone: ",e.timeZone]}),")"]})]})}),!p&&t.map(((t,i)=>(0,j.jsxs)("td",{className:`${e.logClass[t.prop]} day-wl-block`,exportType:h,children:[e.isCurrentUser&&(0,j.jsx)("span",{className:"fa fa-clock-o add-wl",title:"Click to add worklog",onClick:()=>this.addWorklog(null,t)}),s(e.total[t.prop])]},i))),!p&&(0,j.jsx)("td",{exportType:h,children:s(e.grandTotal)}),p&&t.map(((t,s)=>(0,j.jsx)("td",{className:`${e.logClass[t.prop]} day-wl-block`,children:e.totalCost[t.prop]},s))),p&&(0,j.jsx)("td",{children:e.grandTotalCost})]}),m&&e.tickets.map(((g,m)=>{const u=s(g.originalestimate),k=s(g.remainingestimate),f=s(g.totalLogged)||0,x=(g.estVariance>0?"+":"")+(s(g.estVariance)||(g.originalestimate>0?0:"NA")),y=`Original Estimate: ${u||0}\nRemaining: ${k||0}\nTotal Logged: ${f}\nEstimate Variance: ${x}`;return(0,j.jsxs)("tr",{className:"auto-wrap",children:[(0,j.jsxs)("td",{className:"data-left",children:[!r&&g.parent&&(0,j.jsxs)("a",{href:g.parentUrl,className:"link",target:"_blank",rel:"noopener noreferrer",children:[g.parent," - "]}),(0,j.jsx)("a",{href:g.url,className:"link",target:"_blank",rel:"noopener noreferrer",children:g.ticketNo})," -",(0,j.jsx)("span",{children:g.summary}),(0,j.jsxs)("strong",{children:[" (",g.statusName,")"]}),!o&&!(!u&&!k)&&(0,j.jsxs)("span",{className:"estimate",title:y,children:["(est: ",u||0," / rem: ",k||0," / log: ",f," / var: ",x,")"]})]}),!!a&&(0,j.jsxs)("td",{children:[g.projectKey," - ",g.projectName]}),!!r&&(0,j.jsxs)("td",{children:[g.parent&&(0,j.jsx)("a",{href:g.parentUrl,className:"link",target:"_blank",rel:"noopener noreferrer",children:g.parent})," - ",g.parentSummary]}),!!n&&(0,j.jsx)("td",{children:g.issueType}),!!l&&(0,j.jsx)("td",{children:g.epicDisplay&&(0,j.jsx)("a",{href:g.epicUrl,className:"link",target:"_blank",rel:"noopener noreferrer",children:g.epicDisplay})}),!!d&&(0,j.jsx)("td",{children:g.assignee}),!!c&&(0,j.jsx)("td",{children:g.reporter}),!p&&t.map(((t,o)=>(0,j.jsxs)("td",{className:"day-wl-block",exportType:h,children:[e.isCurrentUser&&(0,j.jsx)("span",{className:"fa fa-clock-o add-wl",title:"Click to add worklog",onClick:()=>this.addWorklog(g.ticketNo,t)}),"2"!==i&&(0,j.jsx)("span",{title:this.getComments(g.logs[t.prop]),children:s(this.getTotalTime(g.logs[t.prop]))}),"2"===i&&(0,j.jsxs)("div",{children:[" ",this.getLogEntries(g.logs[t.prop])]})]},o))),!p&&(0,j.jsx)("td",{exportType:h,children:s(g.totalHours)}),p&&t.map(((e,t)=>(0,j.jsx)("td",{className:"day-wl-block",children:(0,j.jsx)("span",{title:this.getComments(g.logs[e.prop],p),children:this.getTotalCost(g.logs[e.prop])})},t))),p&&(0,j.jsx)("td",{children:g.totalCost})]},m)}))]})}}class re extends o.PureComponent{render(){return(0,j.jsxs)("div",{className:"pad-15",children:[(0,j.jsx)("strong",{children:"How to use:"}),(0,j.jsxs)("ul",{children:[(0,j.jsxs)("li",{children:["Choose a date for which you would like to view the report or click the refresh ( ",(0,j.jsx)("i",{className:"fa fa-refresh"})," ) icon to load the report if date is already selected."]}),(0,j.jsxs)("li",{children:["You can choose the list of users by clicking the ( ",(0,j.jsx)("i",{className:"fa fa-users"})," ) icon."]}),(0,j.jsxs)("li",{children:["Click on Settings ",(0,j.jsx)("i",{className:"fa fa-arrow-right"})," User groups from left hand menu to add users permenantly to a group and use it in future."]}),(0,j.jsxs)("li",{children:["Click on ( ",(0,j.jsx)("i",{className:"fa fa-cogs"})," ) icon to change the settings of the report."]}),(0,j.jsx)("li",{children:"Time zone settings - Configure the time zone of each user & group properly while adding in group and select appropriate option in settings as well."}),(0,j.jsxs)("li",{children:["You have additional settings affecting this report in Settings ",(0,j.jsx)("i",{className:"fa fa-arrow-right"}),"General menu in left hand side."]})]}),(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Note:"})," Any changes you make to the group or the users under the group in this page will not get saved and is only for this session."]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("strong",{children:"Planned enhancements:"})," Some of the enhancements in roadmap for this reports are as follows",(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"Viewing report based on sprint as an additional option alternate for date selection"}),(0,j.jsx)("li",{children:"Add custom columns to the report"})]})]})]})}}const ne=re;class le extends o.PureComponent{constructor(e){super(e);const{groups:t,flatData:s}=e;this.state=this.getGroupedData(t,s)}getGroupedData(e,t){const s=[],i={},o=t.groupBy((e=>e.username)).reduce(((e,t)=>(e[t.key]=t.values,e)),{});t.groupBy((e=>({key:e.projectKey,name:e.projectName}))).sortBy((e=>e.key.key)).forEach((e=>{let{key:t,values:o}=e;s.push(t),i[t.key]=o,t.issueTypes=o.distinct((e=>e.issueType))}));const a=e.map((e=>{const{name:t,users:a}=e,r={grandTotal:0,grandTotalCost:0,projects:{}},n={name:t,overallTotal:r};return n.users=a.map((e=>{const t=(0,y.vW)(e),{emailAddress:a,displayName:n}=e,l={name:t,emailAddress:a,displayName:n};l.projects=s.reduce(((s,o)=>{const a=r.projects[o.key]||{total:0,totalCost:0};r.projects[o.key]=a;const n=i[o.key];if(n){const i=n.filter((e=>e.username===t));if(i.length){const t=i.groupBy((e=>e.issueType)).reduce(((t,s)=>{const i=s.values.sum((e=>e.timeSpent))||0,o=(0,y.qN)(i,e.costPerHour);return t[s.key]={total:i,totalCost:o,logs:s.values},a[s.key]=(a[s.key]||0)+i,a[`${s.key}_Cost`]=(a[`${s.key}_Cost`]||0)+o,t}),{}),r=i.sum((e=>e.timeSpent));t.grandTotal={total:r,totalCost:(0,y.qN)(r,e.costPerHour),logs:i},a.total+=t.grandTotal.total||0,a.totalCost+=t.grandTotal.totalCost||0,s[o.key]=t}}return s}),{});const d=o[t]||[],c=d.sum((e=>e.timeSpent));return l.grandTotal={total:c,totalCost:(0,y.qN)(c,e.costPerHour),logs:d},r.grandTotal+=l.grandTotal.total,r.grandTotalCost+=l.grandTotal.totalCost,l})),n})),r=a.reduce(((e,t)=>{const{overallTotal:{grandTotal:i,grandTotalCost:o,projects:a}}=t;return e.grandTotal=(e.grandTotal||0)+i,e.grandTotalCost=(e.grandTotalCost||0)+o,s.forEach((t=>{const s=a[t.key]||{},i=e[t.key]||{total:0,totalCost:0};e[t.key]=i,i.total+=s.total||0,i.totalCost+=s.totalCost||0,t.issueTypes.forEach((e=>{i[e]=(i[e]||0)+(s[e]||0),i[`${e}_Cost`]=(i[`${e}_Cost`]||0)+(s[`${e}_Cost`]||0)}))})),e}),{grandTotal:0,grandTotalCost:0});return{projects:s,groupedData:a,grandTotal:r}}render(){const{props:{exportSheetName:e,convertSecs:t,costView:s},state:{projects:i,groupedData:a,grandTotal:r}}=this;return(0,j.jsxs)(z.TT,{dataset:a,exportSheetName:e,children:[(0,j.jsxs)(z.Et,{children:[(0,j.jsxs)(z.lE,{children:[(0,j.jsx)(z.sg,{rowSpan:2,children:"Group Name"}),(0,j.jsx)(z.sg,{rowSpan:2,children:"User Name"}),i.map((e=>(0,j.jsx)(z.sg,{colSpan:e.issueTypes.length+1,children:e.name},e.key))),(0,j.jsx)(z.sg,{rowSpan:2,children:"Grand Total"})]}),(0,j.jsx)(z.lE,{children:i.map(((e,t)=>(0,j.jsxs)(o.Fragment,{children:[e.issueTypes.map(((e,t)=>(0,j.jsx)(z.sg,{children:e},t))),(0,j.jsx)(z.sg,{children:"Total"})]},t)))})]}),(0,j.jsx)(z.XP,{children:(e,a)=>(0,j.jsxs)(o.Fragment,{children:[e.users.map(((a,r)=>(0,j.jsxs)("tr",{children:[0===r&&(0,j.jsx)("td",{rowSpan:e.users.length+1,children:e.name}),(0,j.jsx)("td",{children:a.displayName}),i.map(((e,i)=>{var r,n,l;const d=a.projects[e.key]||{};return(0,j.jsxs)(o.Fragment,{children:[!s&&e.issueTypes.map(((e,s)=>{const i=d[e];return(0,j.jsx)("td",{className:"data-center",exportType:"float",children:t(null===i||void 0===i?void 0:i.total)},s)})),!s&&(0,j.jsx)("td",{className:"strong data-center",exportType:"float",children:t(null===(r=d.grandTotal)||void 0===r?void 0:r.total)}),s&&e.issueTypes.map(((e,s)=>{const i=d[e];return(0,j.jsx)("td",{className:"data-center",exportType:"float",title:t(null===i||void 0===i?void 0:i.total),children:null===i||void 0===i?void 0:i.totalCost},s)})),s&&(0,j.jsx)("td",{className:"strong data-center",exportType:"float",title:t(null===(n=d.grandTotal)||void 0===n?void 0:n.total),children:null===(l=d.grandTotal)||void 0===l?void 0:l.totalCost})]},i)})),!s&&(0,j.jsx)("td",{className:"strong data-center",exportType:"float",children:t(a.grandTotal.total)}),s&&(0,j.jsx)("td",{className:"strong data-center",exportType:"float",title:t(a.grandTotal.total),children:a.grandTotal.totalCost})]},r))),(0,j.jsxs)("tr",{className:"strong data-center",children:[(0,j.jsxs)("td",{className:"data-right",children:["Group Total ",(0,j.jsx)("span",{className:"fa fa-arrow-right"})]}),i.map(((i,a)=>{const r=e.overallTotal.projects[i.key]||{};return s?(0,j.jsxs)(o.Fragment,{children:[i.issueTypes.map(((e,s)=>(0,j.jsx)("td",{exportType:"float",title:t(r[e]),children:r[`${e}_Cost`]},s))),(0,j.jsx)("td",{exportType:"float",title:t(r.total),children:r.totalCost})]},a):(0,j.jsxs)(o.Fragment,{children:[i.issueTypes.map(((e,s)=>(0,j.jsx)("td",{exportType:"float",children:t(r[e])},s))),(0,j.jsx)("td",{exportType:"float",children:t(r.total)})]},a)})),!s&&(0,j.jsx)("td",{exportType:"float",children:t(e.overallTotal.grandTotal)}),s&&(0,j.jsx)("td",{exportType:"float",title:t(e.overallTotal.grandTotal),children:e.overallTotal.grandTotalCost})]})]},a)}),(0,j.jsx)("tfoot",{children:(0,j.jsxs)("tr",{className:"strong data-center",children:[(0,j.jsxs)("td",{colSpan:2,className:"data-right",children:["Grand total ",(0,j.jsx)("span",{className:"fa fa-arrow-right"})]}),!s&&i.map(((e,s)=>(0,j.jsxs)(o.Fragment,{children:[e.issueTypes.map(((s,i)=>(0,j.jsx)("td",{exportType:"float",children:t(r[e.key][s])},i))),(0,j.jsx)("td",{exportType:"float",children:t(r[e.key].total)})]},s))),!s&&(0,j.jsx)("td",{exportType:"float",children:t(r.grandTotal)}),s&&i.map(((e,s)=>(0,j.jsxs)(o.Fragment,{children:[e.issueTypes.map(((s,i)=>(0,j.jsx)("td",{exportType:"float",title:t(r[e.key][s]),children:r[e.key][`${s}_Cost`]},i))),(0,j.jsx)("td",{exportType:"float",title:t(r[e.key].total),children:r[e.key].totalCost})]},s))),s&&(0,j.jsx)("td",{exportType:"float",title:t(r.grandTotal),children:r.grandTotalCost})]})}),(0,j.jsx)(z.ch,{span:11,children:"No worklog details available"})]})}}const de=le;class ce extends a.ZP{constructor(e){super(e,"Worklog Report","fa-list-alt"),this.dateSelected=e=>{if(!e)return;const{quickDate:t,fromDate:s,toDate:i}=e;if(s&&i){let{pageSettings:s}=this.state;s=t?{...s,dateRange:{quickDate:t}}:{...s,dateRange:e},this.setState({dateRange:e,pageSettings:s},this.refreshData),this.saveSettings(s)}},this.refreshData=()=>{const{groups:e}=this.state;if(!e||0===e.length)return void this.$message.warning("User list need to be added before generating report","Missing input");this.userList=e.union((e=>(e.users.forEach((t=>t.groupName=e.name)),e.users)));const t={userList:this.userList.map((e=>(0,y.vW)(e,!0))),fromDate:this.state.dateRange.fromDate,toDate:this.state.dateRange.toDate};this.setState({isLoading:!0}),this.getDayWiseReportData(t).then((e=>{this.$analytics.trackEvent("Worklog report viewed",b.Jk.UserActions),this.rawData=e,this.generateFlatData(e),this.setState({isLoading:!1})}),(e=>(this.setState({isLoading:!1}),Promise.reject(e))))},this.showGroupsPopup=()=>this.setState({showGroupsPopup:!0}),this.showSettings=()=>this.setState({showSettings:!0}),this.groupsChanged=e=>{const t={showGroupsPopup:!1};e&&Array.isArray(e)&&(t.groups=e),this.setState(t)},this.settingsChanged=e=>{e||(e=this.state.pageSettings),this.setState({showSettings:!1,pageSettings:e})},this.groupSettingsChanged=e=>{const{groupBy:t,groupFoldable:s,displayColumns:i,sortField:o,isDesc:a}=e;let{pageSettings:r}=this.state;r={...r,flatTableSettings:{groupBy:t,groupFoldable:s,displayColumns:i,sortField:o,isDesc:a}},this.saveSettings(r)},this.addWorklog=(e,t,s,i)=>{let o=(this.maxSecsPerDay||0)-(i||0);o<60&&(o="01:00"),g()(s).isSame(g()(),"day")&&(s=new Date),this.worklogItem={ticketNo:t,dateStarted:s,timeSpent:o},this.setState({showWorklogPopup:!0})},this.worklogAdded=e=>{let{added:{sourceObject:t}}=e;console.log("Worklog added: ",t)},this.hideWorklog=()=>{this.worklogItem=null,this.setState({showWorklogPopup:!1})},this.convertSecs=e=>e||0===e?this.$utils.convertSecs(e,{format:"1"===this.state.pageSettings.logFormat}):e,this.formatTime=e=>this.$userutils.formatTime(e),this.formatDateTime=e=>this.$userutils.formatDateTime(e),(0,V.f3)(this,"SessionService","CacheService","UtilsService","UserUtilsService","JiraService","MessageService","ConfigService","UserGroupService","AnalyticsService");const t=this.$session.pageSettings.reports_UserDayWise;t.timeZone||(t.timeZone="1");let{dateRange:s}=t;if(s={...s||{}},s.quickDate){const[e,t]=(0,q.dq)(s.quickDate);s.fromDate=e,s.toDate=t}this.state.dateRange=s,this.state.pageSettings=t;const{maxHours:i,epicNameField:o,name:a}=this.$session.CurrentUser;this.currentUserName=a.toLowerCase(),this.maxSecsPerDay=60*(i||8)*60,this.epicNameField=(o||{}).id}componentDidMount(){super.componentDidMount(),this.$usergroup.getUserGroups().then((e=>this.setState({groups:e})))}getDayWiseReportData(e){const t=e.userList.distinct(),s=g()(e.fromDate).startOf("day"),i=g()(e.toDate).endOf("day"),o=s.toDate(),a=i.toDate(),r=this.getDateArray(o,a);this.dates=r.map((e=>({prop:e.format("yyyyMMdd"),display:e.format("DDD, dd"),date:e,isHoliday:this.$userutils.isHoliday(e)}))),this.months=r.groupBy((e=>e.format("MMM, yyyy"))).map((e=>({monthName:e.key,days:e.values.length})));const n=this.state.pageSettings.hideEstimate;let l=(this.state.pageSettings.jql||"").trim();l&&(l=` AND (${l})`);const d=`worklogAuthor in ("${t.join('","')}") and worklogDate >= '${s.clone().add(-1,"days").format("YYYY-MM-DD")}' and worklogDate < '${i.clone().add(1,"days").format("YYYY-MM-DD")}'${l}`,c=["summary","worklog","issuetype","parent","project","status","assignee","reporter"];n||(c.push("timeoriginalestimate"),c.push("timeestimate"));const h=this.epicNameField;return h&&c.push(h),this.$jira.searchTickets(d,c).then((e=>{const s=t.map((e=>{const t={logData:[],userName:e.toLowerCase()};return t.userName===this.currentUserName&&(t.isCurrentUser=!0),t})),i={};for(let t=0;t<s.length;t++){const e=s[t];i[e.userName]=e}for(let t=0;t<e.length;t++){const s=e[t],u=s.fields||{},k=(u.worklog||{}).worklogs||[],f=k.sum((e=>e.timeSpentSeconds)),x=u.timeoriginalestimate||0,j=u.timeestimate||0,v=x>0?j+f-x:0;for(let e=0;e<k.length;e++){const t=k[e],w=g()(t.started).toDate(),S=g()(t.started).startOf("day").toDate();if(S.getTime()>=o.getTime()&&S.getTime()<=a.getTime()){const e=i[(0,y.vW)(t.author,!0)];if(e){var r,n,l,d,c,p,m;const i={ticketNo:s.key,epicDisplay:null,epicUrl:null,url:this.$userutils.getTicketUrl(s.key),issueType:null===(r=u.issuetype)||void 0===r?void 0:r.name,parent:null===(n=u.parent)||void 0===n?void 0:n.key,parentSummary:null===(l=u.parent)||void 0===l||null===(d=l.fields)||void 0===d?void 0:d.summary,assignee:null===(c=u.assignee)||void 0===c?void 0:c.displayName,reporter:null===(p=u.reporter)||void 0===p?void 0:p.displayName,summary:u.summary,originalestimate:x,remainingestimate:j,totalLogged:f,estVariance:v,logTime:w,comment:t.comment,projectName:u.project.name,statusName:null===(m=u.status)||void 0===m?void 0:m.name,projectKey:u.project.key,totalHours:t.timeSpentSeconds};if(h){i.epicDisplay=u[h];const e=i.ticketNo.split("-")[0];i.epicDisplay&&0===i.epicDisplay.indexOf(`${e}-`)&&(i.epicUrl=this.$userutils.getTicketUrl(i.epicDisplay))}e.logData.push(i)}}}}for(let t=0;t<s.length;t++){const e=s[t];e.totalHours=e.logData.sum((e=>e.totalHours))}return s}))}generateFlatData(e){this.flatData=this.state.groups.union((t=>{const s=t.name;return t.users.union((t=>{const i=t.displayName;return e.first((e=>e.userName===(0,y.vW)(t,!0))).logData.map((e=>({groupName:s,username:(0,y.vW)(t),userDisplay:i,assignee:e.assignee,reporter:e.reporter,parent:e.parent,parentSummary:e.parentSummary,parentUrl:e.parent?this.$userutils.getTicketUrl(e.parent):null,epicDisplay:e.epicDisplay,epicUrl:e.epicUrl,ticketNo:e.ticketNo,ticketUrl:e.url,issueType:e.issueType,summary:e.summary,projectKey:e.projectKey,projectName:e.projectName,statusName:e.statusName,logTime:e.logTime,timeSpent:e.totalHours,originalestimate:e.originalestimate,remainingestimate:e.remainingestimate,totalLogged:e.totalLogged,estVariance:e.estVariance,comment:e.comment})))}))}))}getDateArray(e,t){const s=[];let i=new Date(e);for(;i<=t;)s.push(new Date(i)),i=i.addDays(1);return s}renderCustomActions(){const{state:{dateRange:e}}=this;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(T.Mt,{value:e,range:!0,onChange:this.dateSelected,style:{marginRight:"35px"}}),(0,j.jsx)(T.zx,{icon:"fa fa-users",onClick:this.showGroupsPopup,title:"Add users / groups to report"}),(0,j.jsx)(T.zx,{icon:"fa fa-cogs",onClick:this.showSettings,title:"Show settings"})]})}saveSettings(e){this.$config.saveSettings("reports_UserDayWise",e),this.settingsChanged(e)}render(){const{months:e,dates:t,convertSecs:s,formatTime:i,formatDateTime:o,rawData:a,flatData:r=[],state:{isLoading:n,showGroupsPopup:l,showWorklogPopup:d,showSettings:c,groups:h,pageSettings:p={}}}=this,{breakupMode:g,showCostReport:m}=p,u=`${p._uniqueId}_${r._uniqueId}`,k=(0,j.jsx)(Y.TabPanel,{header:"Grouped - [User daywise]",contentClassName:"no-padding",children:a&&(0,j.jsx)(ie,{exportSheetName:"Grouped - [User daywise]",rawData:a,groups:h,dates:t,months:e,pageSettings:p,convertSecs:s,formatTime:i,breakupMode:g,getTicketUrl:this.$userutils.getTicketUrl,maxSecsPerDay:this.maxSecsPerDay,addWorklog:this.addWorklog})}),x=(0,j.jsx)(Y.TabPanel,{header:"Summary - [User project wise]",children:r&&(0,j.jsx)(de,{exportSheetName:"Summary - [User project wise]",groups:h,flatData:r,formatDateTime:o,convertSecs:s},u)}),y=(0,j.jsx)(Y.TabPanel,{header:"Flat (Groupable)",children:r&&(0,j.jsx)(te,{flatData:r,formatDateTime:o,convertSecs:s,pageSettings:p,onChange:this.groupSettingsChanged},u)});return super.renderBase((0,j.jsxs)("div",{className:"worklog-gadget-container",children:[!a&&!n&&(0,j.jsx)(ne,{}),n&&(0,j.jsx)("div",{className:"pad-15",children:"Loading... please wait while the report is being loaded. It may take few seconds / minute based on the range you had selected."}),a&&!m&&(0,j.jsxs)(Y.TabView,{className:"no-padding",renderActiveOnly:!1,children:[k,x,y]}),a&&m&&(0,j.jsxs)(Y.TabView,{className:"no-padding",renderActiveOnly:!1,children:[k,(0,j.jsx)(Y.TabPanel,{header:"Cost Report",contentClassName:"no-padding",children:a&&(0,j.jsx)(ie,{exportSheetName:"Cost Report",rawData:a,groups:h,dates:t,months:e,pageSettings:p,costView:!0,convertSecs:s,formatTime:i,breakupMode:g,getTicketUrl:this.$userutils.getTicketUrl,maxSecsPerDay:this.maxSecsPerDay})}),x,(0,j.jsx)(Y.TabPanel,{header:"Cost Summary",children:r&&(0,j.jsx)(de,{exportSheetName:"Cost Summary",groups:h,flatData:r,formatDateTime:o,convertSecs:s,costView:!0},u)}),y]}),l&&(0,j.jsx)(G.Z,{groups:h,onHide:this.groupsChanged}),c&&(0,j.jsx)(J,{pageSettings:p,onHide:this.settingsChanged}),d&&(0,j.jsx)(f.Z,{worklog:this.worklogItem,onDone:this.worklogAdded,onHide:this.hideWorklog,uploadImmediately:!0})]}))}}const he=ce;class pe extends S.Z{constructor(e){super(e,"Add Bookmark"),this.addBookmark=()=>{const{ticketsList:e}=this.state;e.length>0?(this.setState({isLoading:!0}),this.$bookmark.addBookmark(e).then((t=>{0===t.length?this.onHide(!0):(this.setState({isLoading:!1,ticketsList:t}),e.length===t.length?this.$message.warning("None of the ticket numbers provided are valid."):e.length>t.length&&this.$message.warning("Some of the ticket numbers provided are not valid."))}))):this.onHide()},this.listChanged=e=>this.setState({ticketsList:e}),(0,V.f3)(this,"BookmarkService","MessageService"),this.style.width="380px",this.state.ticketsList=[]}getFooter(){return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(T.zx,{type:"primary",onClick:this.addBookmark,label:"Save"}),(0,j.jsx)(T.zx,{type:"default",onClick:this.onHide,label:"Cancel"})]})}render(){const{state:{ticketsList:e}}=this;return super.renderBase((0,j.jsxs)("div",{className:"pad-22",children:[(0,j.jsx)(T.yh,{value:e,onChange:this.listChanged,placeholder:"Enter one or more ticket numbers"}),(0,j.jsx)("strong",{children:"Note:"})," Press enter key to add multiple items"]}))}}const ge=pe;var me=s(6552);class ue extends a.ZP{constructor(e){super(e,"My Bookmarks","fa-bookmark"),this.refreshData=()=>{this.setState({isLoading:!0,showAddPopup:!1}),this.$bookmark.getBookmarks().then((e=>{const{selAllChk:t}=this.state;e.forEach((e=>{e.ticketUrl=this.$userutils.getTicketUrl(e.ticketNo),e.selected=t,e.rowClass=this.$utils.getRowStatus(e)})),this.setState({isLoading:!1,bookmarksList:e})}))},this.startTimer=()=>this.context.startTimer(this.selectedTicket.ticketNo),this.selectAll=e=>{let{bookmarksList:t}=this.state;t=[...t],t.forEach((t=>t.selected=e)),this.setState({selAllChk:e,bookmarksList:t})},this.showAddPopup=()=>this.setState({showAddPopup:!0}),this.hideAddPopup=e=>{e?this.refreshData():this.setState({showAddPopup:!1})},(0,r.f3)(this,"JiraService","BookmarkService","UtilsService","UserUtilsService","MessageService"),this.contextMenu=[{label:"Select Bookmark",icon:"fa fa-check-square-o",command:()=>this.selectTicket(this.selectedTicket)},{label:"Add worklog",icon:"fa fa-clock-o",command:()=>this.addWorklogOn(this.selectedTicket.ticketNo)},{label:"Delete Bookmark",icon:"fa fa-trash-o",command:()=>this.deleteBookmark(this.selectedTicket.ticketNo)}],this.state.selAllBks=!1,this.state.bookmarksList=[]}selectTicket(e){e.selected=!e.selected;let{bookmarksList:t}=this.state;t=[...t],this.setState({bookmarksList:t})}componentDidMount(){super.componentDidMount(),this.refreshData()}showContext(e,t){this.selectedTicket=t;const s=[...this.contextMenu];try{const e=this.context.getElapsedTimeInSecs(),i=(null===e||void 0===e?void 0:e.key)===t.ticketNo,o=null===e||void 0===e?void 0:e.isRunning;i?(o?s.push({label:"Pause timer",icon:"fa fa-pause",command:this.context.pauseTimer}):s.push({label:"Resume timer",icon:"fa fa-play",command:this.context.resumeTimer}),s.push({label:"Stop timer",icon:"fa fa-stop",command:this.context.stopTimer})):s.push({label:"Start timer",icon:"fa fa-play",command:this.startTimer})}catch{}(0,k.pT)(e,s)}deleteBookmark(e){let t;t=e?[e]:this.state.bookmarksList.filter((e=>e.selected)).map((e=>e.ticketNo)),0!==t.length?me.Z.confirmDelete("Are you sure to delete the selected bookmark(s)?","Confirm delete bookmark(s)").then((()=>{this.setState({isLoading:!0}),this.$bookmark.removeBookmark(t).then((e=>{this.setState({bookmarksList:e,isLoading:!1})}))})):this.$message.info("Select the bookmarks to be deleted!")}executeEvent(e){e.type===i.X.TicketBookmarked&&this.refreshData()}renderCustomActions(){return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(T.zx,{icon:"fa fa-plus",onClick:this.showAddPopup,title:"Add ticket to bookmarks"}),(0,j.jsx)(T.zx,{type:"danger",icon:"fa fa-trash-o",onClick:()=>this.deleteBookmark(),title:"Remove selected ticket(s) from bookmarks"})]})}render(){const{bookmarksList:e,selAllChk:t,showAddPopup:s}=this.state;return super.renderBase((0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(z.TT,{dataset:e,exportSheetName:"My bookmarks",children:[(0,j.jsx)(z.Et,{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)(z.sg,{className:"w40",noExport:!0,children:(0,j.jsx)(T.XZ,{checked:t,onChange:this.selectAll})}),(0,j.jsx)(z.sg,{sortBy:"ticketNo",children:"Ticket No"}),(0,j.jsx)(z.sg,{sortBy:"issuetype",children:"Type"}),(0,j.jsx)(z.sg,{sortBy:"summary",children:"Summary"}),(0,j.jsx)(z.sg,{sortBy:"assigneeName",children:"Assignee"}),(0,j.jsx)(z.sg,{sortBy:"reporter",children:"Reporter"}),(0,j.jsx)(z.sg,{sortBy:"priority",children:"Priority"}),(0,j.jsx)(z.sg,{sortBy:"status",children:"Status"}),(0,j.jsx)(z.sg,{sortBy:"resolution",children:"Resolution"}),(0,j.jsx)(z.sg,{sortBy:"createdSortable",children:"Created"}),(0,j.jsx)(z.sg,{sortBy:"updatedSortable",children:"Updated"})]})}),(0,j.jsx)(z.XP,{children:(e,t)=>(0,j.jsxs)("tr",{onContextMenu:t=>this.showContext(t,e),className:e.rowClass,children:[(0,j.jsxs)("td",{className:"text-center",children:[e.selected&&(0,j.jsx)(T.XZ,{checked:!0,onChange:()=>this.selectTicket(e)}),!e.selected&&(0,j.jsx)("i",{className:"fa fa-ellipsis-v",onClick:t=>this.showContext(t,e)})]}),(0,j.jsx)("td",{children:(0,j.jsx)("a",{href:e.ticketUrl,rel:"noopener noreferrer",className:"link strike",target:"_blank",children:e.ticketNo})}),(0,j.jsxs)("td",{children:[e.issuetypeIcon&&(0,j.jsx)(T.Ee,{src:e.issuetypeIcon}),e.issuetype]}),(0,j.jsx)("td",{children:e.summary}),(0,j.jsx)("td",{children:e.assigneeName}),(0,j.jsx)("td",{children:e.reporterName}),(0,j.jsxs)("td",{children:[e.priorityIcon&&(0,j.jsx)(T.Ee,{src:e.priorityIcon}),e.priority]}),(0,j.jsxs)("td",{children:[e.statusIcon&&(0,j.jsx)(T.Ee,{src:e.statusIcon}),e.status]}),(0,j.jsxs)("td",{children:[e.resolutionIcon&&(0,j.jsx)(T.Ee,{src:e.resolutionIcon}),e.resolution]}),(0,j.jsx)("td",{children:e.created}),(0,j.jsx)("td",{children:e.updated})]},e.ticketNo)}),(0,j.jsx)(z.ch,{span:11,children:"You have not yet bookmarked any tickets. Bookmark your frequently used tickets"})]}),s&&(0,j.jsx)(ge,{onHide:this.hideAddPopup})]}))}}ue.contextType=D.a2;const ke=ue;class fe extends a.ZP{constructor(e){super(e,"My open tickets","fa-eye"),this.refreshData=async e=>{this.setState({isLoading:!0});try{const t=(await this.$jira.getOpenTickets(e)).map((e=>{const t=e.fields;return{ticketNo:e.key,ticketUrl:this.$userutils.getTicketUrl(e.key),issuetypeIcon:(t.issuetype||{}).iconUrl,issuetype:(t.issuetype||{}).name,summary:t.summary,reporter:(t.reporter||{}).displayName,priorityIcon:(t.priority||{}).iconUrl,priority:(t.priority||{}).name,statusIcon:(t.status||{}).iconUrl,status:(t.status||{}).name,resolutionIcon:(t.resolution||{}).iconUrl,resolution:(t.resolution||{}).name,createdSortable:t.created,updatedSortable:t.updated,created:this.$userutils.formatDateTime(t.created),updated:this.$userutils.formatDateTime(t.updated)}}));this.setState({ticketList:t,isLoading:!1})}finally{this.setState({isLoading:!1})}},this.bookmarkAdded=()=>this.performAction(a.Xk.TicketBookmarked),(0,r.f3)(this,"JiraService","BookmarkService","UserUtilsService"),this.state.isLoading=!0,this.state.ticketList=[]}componentDidMount(){super.componentDidMount(),this.refreshData()}getHint(){return(0,j.jsxs)("ul",{className:"gadget-hint",children:[(0,j.jsx)("li",{children:"By default, unresolved ticket list assigned to you are shown in this gadget"}),(0,j.jsx)("li",{children:'You can control the list of tickets to be shown, by editing "Open tickets JQL" in Advanced Settings'}),(0,j.jsx)("li",{children:"Right click on any ticket to start time tracking or see more options"})]})}render(){const{ticketList:e}=this.state;return super.renderBase((0,j.jsxs)(z.TT,{dataset:e,exportSheetName:"My open tickets",children:[(0,j.jsx)(z.Et,{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)(z.sg,{sortBy:"ticketNo",children:"Ticket No"}),(0,j.jsx)(z.sg,{sortBy:"issuetype",children:"Type"}),(0,j.jsx)(z.sg,{sortBy:"summary",children:"Summary"}),(0,j.jsx)(z.sg,{sortBy:"reporter",children:"Reporter"}),(0,j.jsx)(z.sg,{sortBy:"priority",children:"Priority"}),(0,j.jsx)(z.sg,{sortBy:"status",children:"Status"}),(0,j.jsx)(z.sg,{sortBy:"resolution",children:"Resolution"}),(0,j.jsx)(z.sg,{sortBy:"createdSortable",children:"Created"}),(0,j.jsx)(z.sg,{sortBy:"updatedSortable",children:"Updated"})]})}),(0,j.jsx)(z.XP,{children:(e,t)=>(0,j.jsx)(xe,{ticket:e,onAddWorklog:this.addWorklogOn,onBookmark:this.bookmarkAdded},t)}),(0,j.jsx)(z.ch,{span:9,children:"No open tickets were assigned to you. Enjoy your day!"})]}))}showContext(e,t){this.selectedTicket=t,(0,k.pT)(e,this.contextMenu)}}class xe extends o.PureComponent{constructor(){super(...arguments),this.setRef=e=>this.keyCtr=e,this.showContext=e=>this.keyCtr.showContext(e)}render(){const{ticket:e,onAddWorklog:t,onBookmark:s}=this.props;return(0,j.jsxs)("tr",{onContextMenu:this.showContext,children:[(0,j.jsx)(A.a3,{ref:this.setRef,value:e.ticketNo,onAddWorklog:t,onBookmark:s}),(0,j.jsxs)("td",{children:[(0,j.jsx)(T.Ee,{src:e.issuetypeIcon}),e.issuetype]}),(0,j.jsx)("td",{children:e.summary}),(0,j.jsx)("td",{children:e.reporter}),(0,j.jsxs)("td",{children:[(0,j.jsx)(T.Ee,{src:e.priorityIcon}),e.priority]}),(0,j.jsxs)("td",{children:[(0,j.jsx)(T.Ee,{src:e.statusIcon}),e.status]}),(0,j.jsxs)("td",{children:[e.resolutionIcon&&(0,j.jsx)(T.Ee,{src:e.resolutionIcon}),e.resolution]}),(0,j.jsx)("td",{children:e.created}),(0,j.jsx)("td",{children:e.updated})]})}}const ye=fe;class je extends a.ZP{constructor(e){super(e,"My Reports","fa-filter"),this.refreshData=()=>{this.setState({isLoading:!0}),this.$report.getReportsList().then((e=>{const{selAllChk:t}=this.state;e.forEach((e=>{e.selected=t,e.displayDate=this.$userutils.formatDateTime(e.dateCreated),e.sortDate=e.dateCreated.getTime()})),this.setState({reportsList:e,isLoading:!1})}))},this.deleteSelectedReports=()=>{const e=this.state.reportsList.filter((e=>e.selected)).map((e=>e.id));0!==e.length?me.Z.confirmDelete("Are you sure to delete the selected report(s)?","Confirm delete report(s)").then((()=>{this.setState({isLoading:!0}),this.$report.deleteSavedQuery(e).then((()=>this.refreshData()))})):this.$message.info("Select the reports to be deleted!")},this.selectAll=()=>{let{reportsList:e,selAllChk:t}=this.state;t=!t,e.forEach((e=>e.selected=t)),e=[...e],this.setState({reportsList:e,selAllChk:t,selReportsCount:t?e.length:null})},this.downloadReports=()=>{const e=this.state.reportsList.filter((e=>e.selected)).map((e=>e.id));0!==e.length?this.$report.exportQueries(e):this.$message.info("Select the reports to be exported!")},this.fileSelected=()=>{const e=this.fileSelector,t=e.files[0];if(t){if(!t.name.endsWith(".jrd"))return this.$message.warning("Unknown file selected to import. Select a valid Jira Assist Report definition (*.jrd) file"),void(e.value="");const s=new FileReader;s.readAsText(t,"UTF-8"),s.onload=e=>{const t=e.target.result;try{const e=JSON.parse(t).reports;if(!e||!Array.isArray(e))return void this.$message.error("Selected file is invalid or is corrupted");e.forEach((e=>{e.oldName=e.queryName,e.selected=!0,e.status="Will import"})),this.setState({reportsToImport:e})}catch(s){this.$message.error("Selected file is invalid or is corrupted")}},s.onerror=e=>{this.$message.error("Selected file is invalid or is corrupted. Unable to load the file!")}}e.value=""},this.editReport=e=>{this.context.navigate(`/reports/${e.advanced?"advanced":e.isNew?"custom":"customgrouped"}/${e.id}`,!0)},this.hideImportPopup=e=>{e&&this.refreshData(),this.setState({reportsToImport:null})},this.setFileSelector=e=>this.fileSelector=e,this.chooseFileForImport=()=>this.fileSelector.click(),(0,r.f3)(this,"ReportService","MessageService","UserUtils"),this.state.isLoading=!0}componentDidMount(){super.componentDidMount(),this.refreshData()}selectRowItem(e){e.selected=!e.selected;let{reportsList:t}=this.state;t=[...t];const s=t.count((e=>e.selected));this.setState({reportsList:t,selReportsCount:s})}renderCustomActions(){return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("input",{ref:this.setFileSelector,type:"file",className:"hide",accept:".jrd",onChange:this.fileSelected}),(0,j.jsx)(T.zx,{icon:"fa fa-upload",onClick:this.chooseFileForImport,title:"Import reports shared by others"}),(0,j.jsx)(T.zx,{icon:"fa fa-download",disabled:!this.state.selReportsCount,onClick:this.downloadReports,title:"Export reports to share with others"}),(0,j.jsx)(T.zx,{type:"danger",icon:"fa fa-trash-o",onClick:this.deleteSelectedReports,title:"Delete selected report(s)"})]})}render(){const{reportsList:e,selAllChk:t,reportsToImport:s}=this.state;return super.renderBase((0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(z.TT,{dataset:e,exportSheetName:"My reports",children:[(0,j.jsx)(z.Et,{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)(z.sg,{className:"w40",children:(0,j.jsx)(T.XZ,{checked:t,onChange:this.selectAll})}),(0,j.jsx)(z.sg,{sortBy:"queryName",children:"Report name"}),(0,j.jsx)(z.sg,{sortBy:"sortDate",children:"Created On"}),(0,j.jsx)(z.sg,{sortBy:"advanced",children:"Report type"}),(0,j.jsx)(z.sg,{sortBy:"outputCount",children:"Output fields"}),(0,j.jsx)(z.sg,{children:"Options"})]})}),(0,j.jsx)(z.XP,{children:e=>(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{className:"text-center",children:(0,j.jsx)(T.XZ,{checked:e.selected,onChange:()=>this.selectRowItem(e)})}),(0,j.jsx)("td",{children:e.queryName}),(0,j.jsx)("td",{children:e.displayDate}),(0,j.jsx)("td",{children:e.advanced?"Advanced report":"Custom Report"+(e.isNew?"":" (old)")}),(0,j.jsx)("td",{children:e.outputCount}),(0,j.jsx)("td",{className:"text-center",children:(0,j.jsx)(T.zx,{icon:"fa fa-edit",onClick:()=>this.editReport(e),title:"Click to edit this report"})})]},e.id)}),(0,j.jsx)(z.ch,{span:7,children:"You have not yet created or imported any reports."})]}),s&&(0,j.jsx)(we,{reportsToImport:s,onHide:this.hideImportPopup})]}))}}je.contextType=D.Il;const ve=je;class we extends S.Z{constructor(e){super(e,"Select reports to import"),this.selectAllReports=()=>{let{selectAll:e,reportsToImport:t}=this.state;e=!e,t=[...t],t.forEach((t=>{t.selected=!t.disabled&&e,this.updateReportStatus(t)})),this.setState({selectAll:e,reportsToImport:t,selReportsCount:this.getReportsCount(t)})},this.getReportsCount=e=>(e||this.state.reportsToImport).filter((e=>e.selected)).length,this.importReports=()=>{const e=this.state.reportsToImport.filter((e=>e.selected)),t=e.map((e=>{const t={...e};return delete t.selected,delete t.id,delete t.oldName,delete t.status,this.$report.saveQuery(t).then((t=>(e.selected=!1,e.disabled=!0,e.status="Imported",!0)),(()=>(e.status="Duplicate name",!1)))}));Promise.all(t).then((t=>{if(t.some((e=>!e))){this.$message.error("Some of the reports were not import!","Import failed");let{reportsToImport:e}=this.state;e=[...e],this.setState({selReportsCount:this.getReportsCount(e),reportsToImport:e})}else this.$message.success(`${e.length} selected reports were imported`,"Reports imported"),this.onHide(!0)}))},(0,r.f3)(this,"UserUtilsService","MessageService","ReportService"),this.style={width:"850px"},this.state.selectAll=!0,this.state.reportsToImport=this.props.reportsToImport,this.state.selReportsCount=this.getReportsCount()}reportSelected(e){e.selected=!e.selected,this.updateReportStatus(e),this.setState({selReportsCount:this.getReportsCount()})}updateReportStatus(e){e.selected?(e.queryName||(e.queryName=e.oldName),e.status="Will import"):e.status="Excluded"}reportNameChanged(e,t){e.queryName=t,e.queryName?e.status="Will import":e.status="Name required",this.forceUpdate()}getFooter(){const{selReportsCount:e}=this.state;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(T.zx,{icon:"fa fa-times",onClick:this.onHide,label:"Cancel",type:"default"}),(0,j.jsx)(T.zx,{icon:"fa fa-check",disabled:!e,onClick:this.importReports,label:"Import",type:"primary"})]})}render(){const{reportsToImport:e,selectAll:t}=this.state;return super.renderBase((0,j.jsx)("div",{children:(0,j.jsxs)(z.TT,{dataset:e,children:[(0,j.jsx)("caption",{children:"Select all the reports which you would like to import and provide a name for the report to import."}),(0,j.jsx)(z.Et,{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{className:"no-min-width no-pad",children:(0,j.jsx)(T.XZ,{checked:t,onChange:this.selectAllReports})}),(0,j.jsx)("th",{children:"Report name"}),(0,j.jsx)("th",{children:"Report name (new)"}),(0,j.jsx)("th",{children:"Created date"}),(0,j.jsx)("th",{children:"Last modified date"}),(0,j.jsx)("th",{children:"Status"})]})}),(0,j.jsx)(z.XP,{children:(e,t)=>(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{className:"data-center",children:(0,j.jsx)(T.XZ,{checked:e.selected,disabled:e.disabled,onChange:t=>this.reportSelected(e,t)})}),(0,j.jsx)("td",{children:e.oldName}),(0,j.jsx)("td",{children:(0,j.jsx)(T.zC,{value:e.queryName,disabled:e.disabled||!e.selected,onChange:t=>this.reportNameChanged(e,t)})}),(0,j.jsx)("td",{children:this.$userutils.formatDateTime(e.dateCreated)}),(0,j.jsx)("td",{children:this.$userutils.formatDateTime(e.dateUpdated)}),(0,j.jsx)("td",{children:e.status})]},`${t}_${e.status}`)})]})}))}}class Se extends a.ZP{constructor(e){super(e,"Worklog - [Pending upload]","fa-clock-o"),this.refreshData=()=>(this.state.isLoading||this.setState({isLoading:!0}),this.$worklog.getPendingWorklogs().then((e=>{const{selAllChk:t}=this.state;e.forEach((e=>{e.ticketUrl=this.$userutils.getTicketUrl(e.ticketNo),e.rowClass=this.$utils.getRowStatus(e),e.displayDate=this.$userutils.formatDateTime(e.dateStarted),e.selected=t,e.timeSpent=this.$utils.formatTs(e.timeSpent),e.overrideTimeSpent=this.$utils.formatTs(e.overrideTimeSpent)})),this.setState({isLoading:!1,worklogs:e})}))),this.selectAll=e=>{const{worklogs:t}=this.state;t.forEach((t=>t.selected=e)),this.setState({worklogs:[...t],selAllChk:e})},(0,r.f3)(this,"WorklogService","UtilsService","UserUtilsService","MessageService"),this.contextMenu=[{label:"Select worklog",icon:"fa fa-check-square-o",command:()=>this.selectRowItem(this.selectedItem)},{label:"Edit worklog",icon:"fa fa-edit",command:()=>this.editWorklogObj()},{label:"Copy worklog",icon:"fa fa-copy",command:()=>this.editWorklogObj(!0)},{label:"Upload worklog",icon:"fa fa-upload",command:()=>this.uploadWorklog([this.selectedItem])},{label:"Delete worklog",icon:"fa fa-trash-o",command:()=>this.deleteWorklog([this.selectedItem])}],this.state.selAllChk=!0,this.state.isLoading=!0}componentDidMount(){super.componentDidMount(),this.refreshData()}getHint(){return(0,j.jsxs)("ul",{className:"gadget-hint",children:[(0,j.jsx)("li",{children:"List of worklog entries created and yet to be uploaded to Jira are shown here"}),(0,j.jsx)("li",{children:"You can upload, edit or delete the entries from here or from worklog calendar"})]})}editWorklogObj(e){const t=Object.create(this.selectedItem);t.copy=e,this.addWorklog(t)}showContext(e,t){this.selectedItem=t,(0,k.pT)(e,this.contextMenu)}uploadWorklog(e){e||(e=this.state.worklogs.filter((e=>e.selected)));const t=e.map((e=>e.id));0!==t.length?(this.setState({isLoading:!0}),this.$worklog.uploadWorklogs(t).then((e=>{this.setState({isLoading:!1,worklogs:e}),super.performAction(a.Xk.WorklogModified)}),(e=>{e&&e.$message&&this.$message.warning(e.message),this.refreshData()}))):this.$message.info("Select the worklogs to be uploaded!")}deleteWorklog(e){e||(e=this.state.worklogs.filter((e=>e.selected)));const t=e.map((e=>e.id));0!==t.length?me.Z.confirmDelete("Are you sure to delete the selected worklog(s)?","Confirm delete worklog(s)").then((()=>{this.setState({isLoading:!0}),this.$worklog.deleteWorklogs(t).then((e=>{this.refreshData(),this.performAction(a.Xk.DeletedWorklog)}))})):this.$message.info("Select the worklogs to be deleted!")}executeEvent(e){e.type!==a.Xk.AddWorklog&&e.type!==a.Xk.DeletedWorklog&&e.type!==a.Xk.WorklogModified||this.refreshData()}selectRowItem(e){e.selected=!e.selected;const{worklogs:t}=this.state;this.setState({worklogs:[...t]})}renderCustomActions(){return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(T.zx,{icon:"fa fa-upload",onClick:()=>this.uploadWorklog(),title:"Upload selected worklogs"}),(0,j.jsx)(T.zx,{type:"danger",icon:"fa fa-trash-o",onClick:()=>this.deleteWorklog(),title:"Delete selected worklogs"})]})}render(){var e;const{worklogs:t,selAllChk:s,isLoading:i}=this.state;return super.renderBase((0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(z.TT,{dataset:t,exportSheetName:"Pending worklogs",children:[(0,j.jsx)(z.Et,{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)(z.sg,{className:"w40",noExport:!0,children:(0,j.jsx)(T.XZ,{checked:s,onChange:this.selectAll})}),(0,j.jsx)(z.sg,{sortBy:"ticketNo",children:"Ticket No"}),(0,j.jsx)(z.sg,{sortBy:"summary",children:"Summary"}),(0,j.jsx)(z.sg,{sortBy:"dateStarted",children:"Log Time"}),(0,j.jsx)(z.sg,{sortBy:"timeSpent",children:"Time Spent"}),(0,j.jsx)(z.sg,{sortBy:"overrideTimeSpent",children:"Override Time"}),(0,j.jsx)(z.sg,{children:"Description"})]})}),(0,j.jsx)(z.XP,{children:e=>(0,j.jsxs)("tr",{onContextMenu:t=>this.showContext(t,e),className:e.rowClass,children:[(0,j.jsxs)("td",{className:"text-center",children:[e.selected&&(0,j.jsx)(T.XZ,{checked:!0,onChange:()=>this.selectRowItem(e)}),!e.selected&&(0,j.jsx)("i",{className:"fa fa-ellipsis-v",onClick:t=>this.showContext(t,e)})]}),(0,j.jsx)("td",{children:(0,j.jsx)("a",{href:e.ticketUrl,rel:"noopener noreferrer",className:"link strike",target:"_blank",children:e.ticketNo})}),(0,j.jsx)("td",{children:e.summary}),(0,j.jsx)("td",{children:e.displayDate}),(0,j.jsx)("td",{children:e.timeSpent}),(0,j.jsx)("td",{children:e.overrideTimeSpent}),(0,j.jsx)("td",{children:e.description})]},e.id)}),(0,j.jsx)(z.ch,{span:7,children:"No worklog pending to be uploaded!"})]}),(0,j.jsx)($,{enabled:!i&&this.context.needReload,onChange:this.refreshData},null===(e=this.context.timerEntry)||void 0===e?void 0:e.key)]}))}}Se.contextType=D.a2;const Te=Se;class Ce extends a.ZP{constructor(e){super(e,"Ticketwise worklog","fa-list-alt"),this.refreshData=()=>{const e=this.settings.dateRange;e&&e.fromDate&&(this.setState({isLoading:!0}),e.dateWise=!1,this.$worklog.getWorklogs(e).then((e=>{e.forEach((e=>{e.rowClass=this.$utils.getRowStatus(e),e.ticketUrl=this.$userutils.getTicketUrl(e.ticketNo),e.totalHours=this.$utils.formatTs(e.totalHours),e.uploaded=this.$utils.formatTs(e.uploaded),e.pendingUpload=this.$utils.formatTs(e.pendingUpload)})),this.setState({isLoading:!1,worklogs:e})})))},this.dateSelected=e=>{this.settings.dateRange=e,e.toDate&&(this.refreshData(),e.auto||this.saveSettings())},(0,V.f3)(this,"WorklogService","UserUtilsService","UtilsService"),this.contextMenu=[{label:"Upload worklog",icon:"fa fa-clock-o",command:()=>this.uploadWorklog()},{label:"Add worklog",icon:"fa fa-bookmark",command:()=>this.addWorklog()}]}componentDidMount(){super.componentDidMount(),this.refreshData()}showContext(e,t){this.selectedTicket=t,(0,k.pT)(e,this.contextMenu)}renderCustomActions(){return(0,j.jsx)(T.Mt,{range:!0,value:this.settings.dateRange,onChange:this.dateSelected,style:{marginRight:"35px"}})}getWorklogUrl(e,t){return this.$userutils.getWorklogUrl(e,t)}getTicketUrl(e){return this.$userutils.getTicketUrl(e)}uploadWorklog(){const e=this.selectedTicket.logData.filter((e=>!e.worklogId)).map((e=>e.id));e.length&&(this.setState({isLoading:!0}),this.$worklog.uploadWorklogs(e).then((()=>{this.refreshData(),super.performAction(i.X.WorklogModified)}),(e=>{this.setState({isLoading:!1})})))}addWorklog(){const{ticketNo:e}=this.selectedTicket,t=p().subtract(1,"hours").toDate();super.addWorklog({ticketNo:e,startTime:t,timeSpent:"01:00",allowOverride:!0})}render(){const{worklogs:e}=this.state;return super.renderBase((0,j.jsxs)(z.TT,{dataset:e,exportSheetName:"Ticketwise worklog",children:[(0,j.jsx)(z.Et,{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)(z.sg,{sortBy:"ticketNo",style:{width:"100px"},children:"Ticket No"}),(0,j.jsx)(z.sg,{sortBy:"summary",children:"Summary"}),(0,j.jsx)(z.sg,{sortBy:"totalHours",children:"Total Hours"}),(0,j.jsx)(z.sg,{sortBy:"uploaded",children:"Uploaded"}),(0,j.jsx)(z.sg,{sortBy:"pendingUpload",children:"Pending Upload"}),(0,j.jsx)(z.sg,{sortBy:"parentKey",children:"Parent Ticket"}),(0,j.jsx)(z.sg,{children:"Dates Logged"}),(0,j.jsx)(z.sg,{style:{width:"400px"},children:"Description"})]})}),(0,j.jsx)(z.XP,{children:e=>(0,j.jsxs)("tr",{onContextMenu:t=>this.showContext(t,e),className:e.rowClass,children:[(0,j.jsx)("td",{children:(0,j.jsx)("a",{href:e.ticketUrl,rel:"noopener noreferrer",className:"link strike",target:"_blank",children:e.ticketNo})}),(0,j.jsx)("td",{children:e.summary}),(0,j.jsx)("td",{children:e.totalHours}),(0,j.jsx)("td",{children:e.uploaded}),(0,j.jsx)("td",{children:e.pendingUpload}),(0,j.jsx)("td",{children:e.parentKey?`${e.parentKey} - ${e.parentSumm}`:""}),(0,j.jsx)("td",{children:(0,j.jsx)("ul",{className:"tags",children:e.logData.map(((t,s)=>(0,j.jsxs)("li",{children:[t.worklogId&&(0,j.jsxs)("a",{className:"link badge badge-pill skin-bg-font",href:this.getWorklogUrl(e.ticketNo,t.worklogId),target:"_blank",rel:"noopener noreferrer",title:t.comments,children:[(0,j.jsx)("span",{className:"fa fa-clock-o"}),"  ",(0,j.jsx)(A.qm,{tag:"span",value:t.dateLogged}),": ",t.uploaded]}),!t.worklogId&&(0,j.jsxs)("span",{className:"link badge badge-pill skin-bg-font",onClick:()=>this.editWorklog(t.id),title:t.comments,children:[(0,j.jsx)("span",{className:"fa fa-clock-o"})," ",(0,j.jsx)(A.qm,{tag:"span",value:t.dateLogged}),": ",t.uploaded]})]},s)))})}),(0,j.jsx)("td",{children:e.description})]},e.ticketNo)}),(0,j.jsx)(z.ch,{span:8,children:"No records exists"})]}))}}const Ne=Ce,be=[{id:"myOpenTickets",icon:"fa-eye",name:"My Open Tickets",details:"Contains the list of open tickets assigned to you"},{id:"myBookmarks",icon:"fa-bookmark",name:"Bookmarks",details:"List of bookmarked tickets"},{id:"dateWiseWorklog",icon:"fa-list-alt",name:"Logged Work - [Daywise]",details:"List of worklog's grouped by date"},{id:"pendingWorklog",icon:"fa-clock-o",name:"Worklog - [Pending Upload]",details:"Worklog's still pending for upload"},{id:"ticketWiseWorklog",icon:"fa-list-alt",name:"Logged Work - [Ticketwise]",details:"List of worklog's grouped by ticket"},{id:"myFilters",icon:"fa-filter",name:"My Reports",details:"List of custom & advanced report built / imported by you"},{id:"agendaDay",icon:"fa-calendar",name:"Current day calendar",details:"Display calendar for current date with worklog and meetings"},{id:"agendaWeek",icon:"fa-calendar",name:"Current week calendar",details:"Display calendar for current week with worklog and meetings"},{id:"listDay",icon:"fa-calendar",name:"Current day worklog List",details:"Display calendar as listview for current date with worklog and meetings"},{id:"listWeek",icon:"fa-calendar",name:"Current week worklog list",details:"Display calendar as listview for current week with worklog and meetings"},{id:"listMonth",icon:"fa-calendar",name:"Current month worklog list",details:"Display calendar as listview for current month with worklog and meetings"},{id:"sWiseTSpent",icon:"fa-list-alt",name:"Status Wise Time Spent",details:"Provides summary of time spent on each ticket on individual status"}]}}]);