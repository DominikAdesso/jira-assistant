"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[482],{1936:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var i=s(7313),r=s(1499),a=s(1329),o=s(9422),l=s(4616),n=s(6441),c=(s(9464),s(5233)),d=s(8971),h=s(6417);class p extends r.Z{constructor(e){super(e,"Issue","fa fa-ticket"),this.toggleAllRows=()=>{let{importData:e,selectAll:t}=this.state;t=!t,e=e.map((e=>((e={...e}).selected=!e.disabled&&t,e))),this.setState({importData:e,selectAll:t,selectedCount:this.getSelectedCount(e)})},this.toggleSelection=(e,t)=>{(e={...e}).selected=!e.disabled&&!e.selected;let{importData:s}=this.state;s=[...s],s[t]=e,this.setState({selectAll:!0,importData:s,selectedCount:this.getSelectedCount(s)})},this.getSelectedCount=e=>e.filter((e=>e.selected)).length,this.importIssues=()=>{let{importData:e}=this.state;const t=e.findAllIndex((e=>e.selected)),s=t.map((t=>e[t]));this.setState({isLoading:!0,uploading:!0}),this.$ticket.importIssues(s).then((s=>{e=[...e],t.forEach(((t,i)=>{e[t]=s[i]})),this.setState({isLoading:!1,uploading:!1,importData:e})}),(e=>{this.$message.error(e,"Import failed"),this.setState({isLoading:!1,uploading:!1})}))},this.clearImportData=()=>{this.setState({importFields:[],ticketDetails:{},importData:null,selectedCount:null})},(0,l.f3)(this,"JiraService","TicketService","MessageService"),this.metadata={},this.state={importData:[],importFields:[],ticketDetails:{}}}UNSAFE_componentWillMount(){this.$jira.getCustomFields().then((e=>{this.customFields=e,this.transformHeader=(0,d.x)(e)}))}processData(e){this.$ticket.processIssuesForImport(e).then((e=>{const{importData:t}=e;t&&t.forEach((e=>{e.disabled=e.hasError,e.selected=!e.disabled})),this.setState({...e,selectedCount:this.getSelectedCount(t)})}))}renderFooter(){const{isLoading:e,selectedCount:t}=this.state;return(0,h.jsx)(c.Z,{isLoading:e,selectedCount:t,clearImportData:this.clearImportData,importIssues:this.importIssues})}render(){const{importData:e,importFields:t,ticketDetails:s,selectAll:i}=this.state;return super.renderBase((0,h.jsx)("div",{className:"import-issue",children:(0,h.jsxs)(a.TT,{dataset:e,className:"issue-table",children:[(0,h.jsx)(a.Et,{children:(0,h.jsxs)(a.lE,{children:[(0,h.jsx)(a.sg,{children:"#"}),(0,h.jsx)(a.sg,{children:(0,h.jsx)(o.XZ,{checked:i,onChange:this.toggleAllRows})}),(0,h.jsx)(a.sg,{children:"Ticket No"}),t.map(((e,t)=>(0,h.jsx)(a.sg,{children:e.name},t))),(0,h.jsx)(a.sg,{sortBy:"status",children:"Status"})]})}),(0,h.jsx)(a.XP,{children:(e,i)=>(0,h.jsx)(g,{index:i,row:e,ticketDetails:s,importFields:t,toggleSelection:this.toggleSelection,getTicketLink:this.getTicketLink},i)}),(0,h.jsx)(a.ch,{span:12,children:n.pU})]})}))}}const u=p;class g extends i.PureComponent{constructor(){super(...arguments),this.toggleSelection=()=>{const{row:e,index:t}=this.props;this.props.toggleSelection(e,t)}}render(){const{row:e,ticketDetails:t,importFields:s,index:i}=this.props,{raw:r,options:a,fields:l,hasError:n,disabled:c,selected:d,statusErrors:p}=e,u=t[r.issuekey]||null;return(0,h.jsxs)("tr",{className:e.error?"row-error":"",children:[(0,h.jsx)("td",{className:n?"error-row":"valid-row",children:i+1}),(0,h.jsx)("td",{children:(0,h.jsx)(o.XZ,{checked:d,disabled:c,onChange:this.toggleSelection})}),(0,h.jsx)(x,{rawTicket:u,issuekey:r.issuekey,option:a.issuekey,getTicketLink:this.props.getTicketLink}),s.map(((t,s)=>{const i=t.key,o=r[i],n=a[i],c=l[i];return(0,h.jsx)(k,{index:s,row:e,field:t,value:o,option:n,metadata:c,rawTicket:u},s)})),(0,h.jsxs)("td",{title:"One or more errors exists",children:[n&&(0,h.jsx)("span",{title:p,className:"fa fa-exclamation-triangle msg-error"})," ",e.status]})]})}}function m(e,t){const s=e&&e.length>0,i=t&&t.length>0;if(s||i){const i="fa fa-exclamation-triangle "+(s?"msg-error":"msg-warning");return(0,h.jsx)("span",{title:s?e:t,className:i})}}class x extends i.PureComponent{constructor(e){super(e),(0,l.f3)(this,"JiraService")}render(){const{issuekey:e,option:t,rawTicket:s}=this.props,{errors:i,warnings:r}=t||{},a=m(i,r);return s?(0,h.jsxs)("td",{children:[this.props.getTicketLink(e)," ",a]}):(0,h.jsxs)("td",{children:[e," ",a]})}}class k extends i.PureComponent{constructor(e){super(e),(0,l.f3)(this,"JiraService")}render(){const{option:e,rawTicket:t,field:{key:s}={}}=this.props,{fields:i}=t||{},{errors:r,warnings:a}=e||{};let{displayValue:o}=e||{};if(!o&&i&&s){const e=i[s];e&&"object"===typeof e?o=e.name||e.key||e.id:e&&(o=e)}return(0,h.jsxs)("td",{children:[o," ",m(r,a)]})}}}}]);