"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[697],{9110:(e,t,s)=>{s.d(t,{Z:()=>o});s(7313);var r=s(1783),a=s(9422),i=s(6417);class n extends r.Z{constructor(e){super(e,"Save Report As"),this.nameChanged=e=>this.setState({newQueryName:e}),this.copyChanged=e=>this.setState({copyQuery:e}),this.done=()=>{const{newQueryName:e,copyQuery:t}=this.state;this.props.onChange(e,t)},this.style={width:"350px"},this.state={showDialog:!0,newQueryName:e.queryName||"",copyQuery:!1}}getFooter(){const{state:{newQueryName:e}}=this;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.zx,{type:"secondary",label:"Cancel",onClick:this.onHide}),(0,i.jsx)(a.zx,{type:"primary",icon:"fa fa-floppy-o",label:"Save",disabled:!e||e.length<3,onClick:this.done})]})}render(){const{props:{allowCopy:e},state:{newQueryName:t,copyQuery:s}}=this;return super.renderBase((0,i.jsxs)("div",{className:"pad-15",children:[(0,i.jsx)("label",{children:"Report Name"}),(0,i.jsx)("div",{children:(0,i.jsx)(a.zC,{value:t,onChange:this.nameChanged,style:{width:"100%"}})}),e&&(0,i.jsx)("div",{children:(0,i.jsx)(a.XZ,{checked:s,onChange:this.copyChanged,label:"Save as new report"})})]}))}}const o=n},7697:(e,t,s)=>{s.d(t,{Z:()=>v});var r=s(7313),a=s(4616),i=s(714),n=s(4918),o=s(9422),l=s(2371),u=s(1329);const d=[{name:"formatDate",returns:"string",text:"Format Date",description:"",types:["date","datetime"]},{name:"formatDateTime",returns:"string",text:"Format Date & time",description:"",types:["datetime","date"]},{name:"formatTime",returns:"string",text:"Format Time",description:"",types:["datetime"]},{name:"formatDateTime?1",returns:"string",text:"Custom Format",description:"",types:["datetime","date"]},{name:"",text:"No formatting",description:"",types:["string","number","datetime","date","seconds"]},{name:"sum?0",returns:"number",text:"Sum values",description:"",types:["number"],forArray:!0},{name:"min?0",returns:"number",text:"Min of values",description:"",types:["number"],forArray:!0},{name:"max?0",returns:"number",text:"Max of values",description:"",types:["number"],forArray:!0},{name:"avg?0",returns:"number",text:"Average of values",description:"",types:["number"],forArray:!0},{name:"count?0",returns:"number",text:"Count of values",description:"",types:["*"],forArray:!0},{name:"count?1",returns:"number",text:"Count of distinct values",description:"",types:["number","datetime","date"],forArray:!0},{name:"sum?1",returns:"number",text:"Sum of group",description:"",types:["number"],aggregate:!0,header:"Sum of {0}"},{name:"min?1",returns:"number",text:"Min of group",description:"",types:["number"],aggregate:!0,header:"Min of {0}"},{name:"max?1",returns:"number",text:"Max of group",description:"",types:["number"],aggregate:!0,header:"Max of {0}"},{name:"avg?1",returns:"number",text:"Average of group",description:"",types:["number"],aggregate:!0,header:"Average of {0}"},{name:"count?2",returns:"number",text:"Count of group",description:"",types:["*","!worklog"],aggregate:!0,header:"Count of {0}"},{name:"count?3",returns:"number",text:"Count of distinct values",description:"",types:["number","datetime","date"],aggregate:!0,header:"Count of distinct {0}"},{name:"first",returns:"number",text:"First",description:"",types:["*"],forArray:!0},{name:"last",returns:"number",text:"Last",description:"",types:["*"],forArray:!0},{name:"propOfNthItem?0",returns:"string",text:"Name of First Item",description:"",types:["object"],forArray:!0,params:[{value:0},{value:"name"}]},{name:"propOfNthItem?1",returns:"string",text:"Name of Last Item",description:"",types:["object"],forArray:!0,params:[{value:"last"},{value:"name"}]},{name:"propOfNthItem?2",returns:"string",text:"Name of First Item (from csv)",description:"",types:["string"],forArray:!0,params:[{value:0},{value:"name"},{value:!0}]},{name:"propOfNthItem?3",returns:"string",text:"Name of Last Item (from csv)",description:"",types:["string"],forArray:!0,params:[{value:"last"},{value:"name"},{value:!0}]},{name:"format?1",returns:"number",text:"Two Decimals",description:"",types:["number"]},{name:"format?2",returns:"number",text:"No Decimals",description:"",types:["number"]},{name:"format?3",returns:"number",text:"Currency",description:"",types:["number"]},{name:"formatSecs?1",returns:"string",text:"Sum & Format Seconds (hours)",description:"Format seconds and show in hours, mins and secs",aggregate:!0,types:["seconds","number"]},{name:"formatSecs?0",returns:"string",text:"Format Seconds (hours)",description:"Format seconds and show in hours, mins and secs",types:["seconds","number"]},{name:"formatDays?0",returns:"string",text:"Format Seconds (days)",description:"Format seconds and show in days, hours, mins and secs",types:["seconds","number"]},{name:"convertSecs?0",returns:"number",text:"Convert Seconds (hours)",description:"Convert seconds into hours",types:["seconds","number"]},{name:"convertSecs?0",returns:"number",text:"Time spent (hours)",description:"Display worklog in hours",types:["worklog"]},{name:"formatSecs?0",returns:"number",text:"Format Time spent (hours)",description:"Display worklog in hours",types:["worklog"]},{name:"formatUser?1",returns:"string",text:"User Display Name",description:"",types:["user"],params:[{value:"DN"}]},{name:"formatUser?2",returns:"string",text:"User Email",description:"",types:["user"],params:[{value:"EM"}]},{name:"formatUser?3",returns:"string",text:"User Login",description:"",types:["user"],params:[{value:"LG"}]},{name:"formatUser?4",returns:"string",text:"User Display Name & Email",description:"",types:["user"],params:[{value:"NE"}]},{name:"formatUser?5",returns:"string",text:"User Display Name & Login",description:"",types:["user"],params:[{value:"NL"}]},{name:"getProperty?0",returns:"string",text:"Get name value",description:"",types:["object"],params:[{type:"string",display:"Property Name:",value:"name"}]},{name:"getProperty?1",returns:"string",text:"Get property value (string)",description:"",types:["object"],params:[{type:"string",display:"Property Name:",default:"name",prompt:!0}]},{name:"getProperty?2",returns:"number",text:"Get property value (number)",description:"",types:["object"]},{name:"getProperty?3",returns:"datetime",text:"Get property value (datetime)",description:"",types:["object"]},{name:"convertToNumber",returns:"number",text:"Try convert to number",description:"",types:["string"]},{name:"objFromCSV?1",returns:"object",text:"Object from CSV",description:"",types:["string"]},{name:"objFromCSV?2",returns:"object",text:"Name from CSV",description:"",types:["string"]}],p={date:"formatDate",datetime:"formatDateTime",number:"",user:"formatUser?1",string:"",object:"getProperty?0",seconds:"formatSecs?0",worklog:"convertSecs?0"};var c=s(6417);const m="~~";class h extends r.PureComponent{constructor(e){super(e),this.selectionChanged=e=>{this.setState(this.setFunction(e))};const{row:t}=e,s=d.filter((e=>(e.types.indexOf(t.type)>-1||e.types.indexOf("*")>-1||t.knownObj&&e.types.indexOf("object")>-1)&&!t.isArray===!e.forArray&&-1===e.types.indexOf(`!${t.type}`))).map((e=>({value:e.name||m,label:e.text})));if(this.state={applFuncs:s},!t.functions){const e=p[t.type];e||""===e?this.setFunction(e):this.setFunction((s.first()||{}).value)}}setFunction(e){if(!e&&""!==e)return;""!==e||this.state.applFuncs.some((t=>t.value===e))||(e=this.state.applFuncs.first().value),e===m&&(e="");let t=d.first((t=>t.name===e));if(!t&&e&&(t=d.first((t=>t.name.startsWith(`${e}?`)))),!t)return void console.error("Unknown function expression:",e);const s=e,r=t.name.split("?")[0],a=t.params?t.params.map((e=>void 0!==e.value?e.value:e.default)):null;return this.props.onChange({id:t.name,name:r,params:a,useArray:t.aggregate,header:t.header}),{selFunction:s}}render(){const{applFuncs:e}=this.state,{row:{functions:{id:t}={}}}=this.props;return(0,c.jsx)(o.jL,{dataset:e,value:t||m,valueField:"value",style:{width:"100%"},onChange:this.selectionChanged})}}const y=h;var g=s(9110),f=s(8407);class x extends n.ZP{constructor(e){super(e,"Query Editor","fa-filter"),this.initModel=e=>{this.setState(this.getClearState(!!e,this.props))},this.saveQuery=(e,t)=>{let{reportQuery:s}=this.state;s={...s};const r=s.queryName;let a=!1;s.queryName=e,t?(delete s.id,a=!0):r!==e&&(a=!0),this.$report.saveQuery(s).then((e=>{s.id=e,this.setState({showSaveDialog:!1,selReportId:s.id,reportQuery:s}),a&&this.fillQueriesList(),this.$message.success("Report saved successfully!"),this.$analytics.trackEvent("Custom Report Saved")}),(e=>{e&&e.message&&this.$message.error(e.message)}))},this.displayFieldAdded=e=>{if(!e||e.items)return;let{reportQuery:t}=this.state;t={...t};const s=this.jiraFields.first((t=>t.id===e));t.outputFields=t.outputFields.concat(this.getField(s,!1)),this.queryChanged(t)},this.processJson=e=>{this.jiraFields=e;let t=[],s=[];e.forEach((e=>{e.label=e.name+(e.name.toLowerCase()!==e.id.toLowerCase()?` (${e.id})`:""),e.value=e.id,e.custom?s.push(e):t.push(e)})),t=t.orderBy((e=>e.name)),s=s.orderBy((e=>e.name)),this.setState({filterFields:[{label:"Basic Fields",items:t.filter((e=>e.clauseNames&&e.clauseNames.length>0))},{label:"Custom Fields",items:s.filter((e=>e.clauseNames&&e.clauseNames.length>0))}]}),this.setState({displayFields:[{label:"Basic Fields",items:t},{label:"Custom Fields",items:s}]})},this.querySelected=e=>{this.$report.getReportDefinition(e).then((t=>this.setState({selReportId:e,reportQuery:t})))},this.deleteQuery=()=>{f.Z.confirmDelete(`Are you sure to delete the report named "${this.state.reportQuery.queryName}" permenantly?`).then((()=>{this.$report.deleteSavedQuery(this.state.selReportId).then((e=>{this.$message.success("Report deleted successfully!"),this.setState({selReportId:null}),this.initModel(),this.fillQueriesList()}))}))},this.queryChanged=e=>{this.setState({reportQuery:e}),this.props.onChange(e)},this.jqlChanged=e=>{let{reportQuery:t}=this.state;t={...t},t.jql=e,this.queryChanged(t)},this.setFunction=(e,t)=>{let{reportQuery:s}=this.state;s={...s};const r=[...s.outputFields];s.outputFields=r;const a={...r[e]};r[e]=a,a.functions=t,this.queryChanged(s)},this.viewReport=()=>this.props.onViewReport(this.state.reportQuery),this.showSaveDialog=()=>this.setState({showSaveDialog:!0}),this.saveAs=()=>this.saveQuery(this.state.reportQuery.queryName),this.hideSaveDialog=()=>this.setState({showSaveDialog:!1}),this.className="query-editor-gadget",this.isGadget=!1,this.hideMenu=!0,this.hideRefresh=!0,(0,a.f3)(this,"ReportService","JiraService","MessageService","AnalyticsService"),this.state=this.getClearState(!1,e),this.state.displayFields=[]}getClearState(e,t){let{reportQuery:s}=this.state;return!s||e?s=t&&t.reportQuery?{...t.reportQuery}:{fields:{},filterFields:[],outputFields:[]}:(s.fields=s.fields||{},s.filterFields=s.filterFields||[],s.outputFields=s.outputFields||[]),t.reportId>0&&this.querySelected(parseInt(t.reportId)),{reportQuery:s,selReportId:null}}UNSAFE_componentWillMount(){this.$jira.getCustomFields().then(this.processJson),this.props.builderOnly||this.fillQueriesList()}fillQueriesList(){this.$report.getReportsList().then((e=>{const t=e.filter((e=>!e.advanced&&!e.isNew)).map((e=>({value:e.id,label:e.queryName})));this.setState({reportsList:t})}))}generateJql(){const e=[],t=this.state.reportQuery.filterFields;for(let s=0;s<t.length;s++){const r=t[s];let a=r.value,n=r.custom?r.name:r.clauseName,o=r.value2;if(o&&(o=`"${o.trim()}"`),n.indexOf(" ")>-1&&(n=`"${n}"`),Array.isArray(r.valueArr)&&r.valueArr.length>0)a=r.valueArr.filter((e=>!!e)).map((e=>`"${e.trim()}"`)).join(",");else if(r.quickDate){const e=(0,i.Y_)(r.quickDate);a=e[0].format("yyyy-MM-dd"),o=e[1].format("yyyy-MM-dd")}else"string"===typeof a&&(a=`"${a.trim()}"`);a&&e.push(r.operator.format([n,a,o]))}return e.join(" AND ")}isSaveEnabled(){const{reportQuery:e}=this.state;return e.jql&&e.jql.trim().length>10&&e.outputFields&&e.outputFields.length>=1}groupField(e,t){const s=!e.groupBy;let{reportQuery:r}=this.state;r={...r};const a=[...r.outputFields];if(r.outputFields=a,s)for(let i=0;i<t;i++)a[i].groupBy=s;else for(let i=t+1;i<a.length;i++)a[i].groupBy=s;this.queryChanged(r)}getField(e,t){const s={id:e.id,name:e.name,custom:e.custom};t&&(s.clauseName=e.clauseNames[0]);const r=e.schema||{},a=r.type||"(Unsupported)",i=r.system,n=r.items;if("issuekey"===e.id)return s.type="string",s;switch(a){case"user":s.knownObj=!0;case"string":case"date":case"datetime":case"(Unsupported)":s.type=a;break;case"number":switch(i){case"timeoriginalestimate":case"aggregatetimespent":case"aggregatetimeoriginalestimate":case"workratio":case"timespent":case"timeestimate":case"aggregatetimeestimate":s.type="seconds";break;default:s.type=a}break;case"issuetype":case"priority":case"project":case"progress":case"comments-page":case"resolution":case"securitylevel":case"status":case"timetracking":case"votes":case"watches":s.knownObj=!0,s.type=i;break;case"array":if(s.isArray=!0,e.custom)switch(n){case"user":s.knownObj=!0;case"string":case"date":case"datetime":case"numeric":case"option":s.type=n;break;default:s.type=JSON.stringify(e)}else switch(i){case"versions":case"fixVersions":case"attachment":case"components":case"issuelinks":case"subtasks":s.knownObj=!0,s.type=n||i;break;case"worklog":s.type=n||i,s.isArray=!1;break;case"labels":s.type=n||i;break;default:s.type=JSON.stringify(e)}break;default:s.type=JSON.stringify(e)}return s}filterAdded(e){if(!e||e.items)return;const t=this.jiraFields.first((t=>t.id===e));let{reportQuery:s}=this.state;s={...s},s.filterFields=s.filterFields.concat(this.getField(t,!0)),this.queryChanged(s),this.selectedFilterField=""}removeOutputField(e){let{reportQuery:t}=this.state;t={...t},t.outputFields.splice(e,1),this.queryChanged(t)}columnReordered(e){const t=e.value,s=e.dropIndex,r=this.state.reportQuery.outputFields[s+1]||this.state.reportQuery.outputFields[s-1];r&&(t.groupBy=r.groupBy)}updateJql(){this.state.reportQuery.filterFields&&this.state.reportQuery.filterFields.length>0&&(this.state.reportQuery.jql=this.generateJql())}tabChanged(e){1===e.index&&this.updateJql()}renderCustomActions(){const{state:{reportsList:e,selReportId:t}}=this;return e&&0!==e.length?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(o.jL,{dataset:e,value:t,valueField:"value",onChange:this.querySelected,placeholder:"Select a report to edit"}),(0,c.jsx)(o.zx,{icon:"fa fa-plus",onClick:this.initModel,label:"New query"})]}):null}renderFooter(){const{reportQuery:e}=this.state,t=this.isSaveEnabled(),s=e.id>0;return(0,c.jsxs)("div",{className:"pnl-footer",children:[e.id&&(0,c.jsxs)("div",{className:"pull-left",children:[(0,c.jsx)(o.zx,{icon:"fa fa-trash",label:"Delete Query",type:"danger",onClick:this.deleteQuery}),(0,c.jsx)(o.zx,{icon:"fa fa-floppy-o",label:"Save Query As",type:"success",onClick:this.showSaveDialog,disabled:!t})]}),(0,c.jsxs)("div",{className:"pull-right",children:[(0,c.jsx)(o.zx,{icon:"fa fa-floppy-o",label:"Save Query",type:"success",onClick:s?this.saveAs:this.showSaveDialog,disabled:!t||e.isSystemQuery}),(0,c.jsx)(o.zx,{icon:"fa fa-list",label:"View Report",type:"info",onClick:this.viewReport,disabled:!t})]})]})}render(){const{props:{builderOnly:e},state:{reportQuery:t,displayFields:s,showSaveDialog:r}}=this,a=t.id>0,i=(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(l.TabView,{children:[(0,c.jsx)(l.TabPanel,{header:"Advanced Filter (JQL)",children:(0,c.jsx)(o.zC,{multiline:!0,value:t.jql,onChange:this.jqlChanged,style:{minWidth:"100%",minHeight:100,height:"100%"}})}),(0,c.jsx)(l.TabPanel,{header:"Display Settings",leftIcon:"fa fa-columns",children:(0,c.jsxs)(u.TT,{className:"query-editor",children:[(0,c.jsx)(u.Et,{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"#"}),(0,c.jsx)("th",{children:"Display Column"}),(0,c.jsx)("th",{className:"col-type",children:"Type"}),!e&&(0,c.jsx)("th",{className:"col-group-by",children:"Group By"}),!e&&(0,c.jsx)("th",{className:"col-format-func",children:"Format function"}),(0,c.jsx)("th",{children:"Remove"})]})}),(0,c.jsx)("tbody",{model:t.outputFields,onDrop:this.columnReordered,children:t.outputFields.map(((t,s)=>(0,c.jsxs)("tr",{style:{cursor:"move"},model:t,children:[(0,c.jsx)("td",{className:"data-center",children:s+1}),(0,c.jsx)("td",{children:t.name}),(0,c.jsxs)("td",{children:[t.type," ",t.isArray?"(multiple)":""]}),!e&&(0,c.jsx)("td",{className:"data-center",children:(0,c.jsx)(o.XZ,{checked:t.groupBy,onChange:e=>{t.groupBy=e,this.groupField(t,s)}})}),!e&&(0,c.jsx)("td",{children:(0,c.jsx)(y,{row:t,onChange:e=>this.setFunction(s,e)})}),(0,c.jsx)("td",{className:"data-center",children:(0,c.jsx)("i",{className:"fa fa-times pointer",onClick:()=>this.removeOutputField(s)})})]},t._uniqueId)))}),(0,c.jsx)("tbody",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{className:"data-center",children:t.outputFields.length+1}),(0,c.jsx)("td",{children:(0,c.jsxs)(o.jL,{dataset:s,value:"",style:{width:"100%"},placeholder:"Choose a column to add to the list",group:!0,displayField:"name",valueField:"id",dataKey:"id",filterPlaceholder:"Type the field name to filter",onChange:this.displayFieldAdded,children:[(e,t)=>(0,c.jsx)("span",{children:e.name}),(e,t)=>(0,c.jsx)("strong",{children:e.label})]})}),(0,c.jsx)("td",{colSpan:5,children:"Note: Select the column from the list to add it as output"})]})})]})})]}),r&&(0,c.jsx)(g.Z,{queryName:t.queryName,allowCopy:a,onHide:this.hideSaveDialog,onChange:this.saveQuery})]});return e?i:super.renderBase(i)}}const v=x}}]);