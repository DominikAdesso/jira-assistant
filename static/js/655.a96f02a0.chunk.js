"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[655],{5212:(e,t,i)=>{i.r(t),i.d(t,{default:()=>y});i(7313);var s=i(6303),r=i(747),o=i(4918),a=i(8192),n=i(9422),h=i(9110),l=i(1783),d=i(7697),p=i(4616),c=i(6417);class u extends l.Z{constructor(e){super(e,"Select dataset fields"),this.onDone=()=>{const e=this.state.filterQuery;this.$jira.searchTickets(this.$reportConfig.prepareJQL(e.jql),e.outputFields.map((e=>e.id))).then((t=>this.props.onResolve(e,t)))},this.queryChanged=e=>this.setState({filterQuery:e}),this.getRef=e=>this.editorInstance=e,(0,p.f3)(this,"JiraService","ReportConfigService"),this.style={width:"900px"};const{filterQuery:t}=e;this.state={showDialog:!0,filterQuery:t}}getFooter(){let e=!1;return this.editorInstance&&(e=this.editorInstance.isSaveEnabled()),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.zx,{type:"default",icon:"fa fa-times",onClick:this.onHide,label:"Cancel"}),(0,c.jsx)(n.zx,{type:"primary",icon:"fa fa-check",onClick:this.onDone,label:"Add",disabled:!e})]})}render(){const{state:{filterQuery:e}}=this;return super.renderBase((0,c.jsx)(d.Z,{ref:this.getRef,builderOnly:!0,reportQuery:e,onChange:this.queryChanged}))}}const f=u;var g=i(8407);class v extends o.ZP{constructor(e){super(e,"Report Builder"),this.setReportDefinition=(e,t)=>{this.setState({reportDefinition:e,selQueryId:e.id})},this.getApi=e=>this.builderAPI=e,this.saveDataset_JQL=(e,t)=>{if(!e)return this.setState({selectedDatasetType:null}),this.resolveJQLEvent.schema.reject(!1),void this.resolveJQLEvent.data.reject(!1);const i=this.$reportConfig.processSearchData(t);this.resolveJQLEvent.schema.resolve(e),this.resolveJQLEvent.data.resolve(i),this.resolveJQLEvent=null,this.setState({selectedDatasetType:null})},this.initModel=()=>{this.filterQuery={},this.setReportDefinition(this.getEmptyDefinition())},this.queryChanged=e=>this.$report.getReportDefinition(e).then(this.setReportDefinition),this.deleteQuery=()=>{g.Z.confirmDelete(`Are you sure to delete the report named "${this.state.reportDefinition.queryName}" permenantly?`).then((()=>{this.$report.deleteSavedQuery(this.state.selQueryId).then((e=>{this.$message.success("Report deleted successfully!"),this.setState({selQueryId:null}),this.initModel(),this.fillQueriesList()}))}))},this.saveQuery=(e,t)=>{const i={...this.state.reportDefinition,...this.builderAPI.getReportDefinition(),advanced:!0},s=i.queryName;let r=!1;i.queryName=e,t?(delete i.id,r=!0):s!==e&&(r=!0),this.$report.saveQuery(i).then((e=>{i.id=e,this.setState({showSaveDialog:!1,selQueryId:i.id}),this.setReportDefinition(i),r&&this.fillQueriesList(),this.$message.success("Query saved successfully!")}),(e=>{e&&e.message&&this.$message.error(e.message)}))},this.viewReport=()=>{this.setReportDefinition(this.builderAPI.getReportDefinition()),this.setState({reportMode:!0})},this.viewBuilder=()=>this.setState({reportMode:!1}),this.showSaveDialog=()=>this.setState({showSaveDialog:!0}),this.saveAs=()=>this.saveQuery(this.state.reportDefinition.queryName),this.hideSaveDialog=()=>this.setState({showSaveDialog:!1}),this.hideDatasetPopup=()=>this.setState({selectedDatasetType:null}),(0,s.f)(this,"JiraService","MessageService","ReportService","ReportConfigService"),this.isGadget=!1,this.hideRefresh=!0,this.hideMenu=!0,this.$reportConfig.configureBuilder(),this.$reportConfig.parameters.removeAllListeners(),this.$reportConfig.eventPipe.on("resolveSchema_JQL",this.resolveSchema_JQL.bind(this)),this.state={reportDefinition:this.getEmptyDefinition()}}UNSAFE_componentWillMount(){const{match:{params:e}}=this.props,t=parseInt(e.reportId||0)||null;t&&this.queryChanged(t),this.fillQueriesList()}resolveSchema_JQL(e){this.resolveJQLEvent=e,this.filterQuery=e.props,this.setState({selectedDatasetType:"JQL"})}fillQueriesList(){return this.$report.getReportsList().then((e=>{const t=e.filter((e=>e.advanced)).map((e=>({value:e.id,label:e.queryName})));this.setState({queryList:t})}))}getEmptyDefinition(){return{datasets:{},reportItems:[]}}renderCustomActions(){const{queryList:e,selQueryId:t}=this.state;return e&&e.length?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.jL,{dataset:e,value:t,valueField:"value",placeholder:"Select a query to edit",onChange:this.queryChanged}),(0,c.jsx)(n.zx,{icon:"fa fa-plus",onClick:this.initModel,label:"New query"})]}):null}renderFooter(){const{state:{reportDefinition:e}}=this,t=e.id>0;return(0,c.jsxs)("div",{className:"pnl-footer",children:[t&&(0,c.jsxs)("div",{className:"pull-left",children:[(0,c.jsx)(n.zx,{icon:"fa fa-trash",label:"Delete Query",type:"danger",onClick:this.deleteQuery}),(0,c.jsx)(n.zx,{icon:"fa fa-floppy-o",label:"Save Query As",type:"success",onClick:this.showSaveDialog})]}),(0,c.jsxs)("div",{className:"pull-right",children:[(0,c.jsx)(n.zx,{type:"success",icon:"fa fa-floppy-o",label:"Save Query",onClick:t?this.saveAs:this.showSaveDialog}),(0,c.jsx)(n.zx,{type:"info",icon:"fa fa-list",label:"View Report",onClick:this.viewReport,disabled:!((e||{}).reportItems||[]).length})]})]})}render(){const{state:{reportDefinition:e,reportMode:t,showSaveDialog:i,selectedDatasetType:s}}=this,o=e.id>0;return t?(0,c.jsx)(a.Z,{isGadget:!1,definition:e,onCancelView:this.viewBuilder}):super.renderBase((0,c.jsxs)(c.Fragment,{children:[e&&(0,c.jsx)(r.ReportBuilder,{api:this.getApi,definition:e}),i&&(0,c.jsx)(h.Z,{queryName:e.queryName,allowCopy:o,onHide:this.hideSaveDialog,onChange:this.saveQuery}),"JQL"===s&&(0,c.jsx)(f,{filterQuery:this.filterQuery,onHide:this.hideDatasetPopup,onResolve:this.saveDataset_JQL})]}))}}const y=v},8192:(e,t,i)=>{i.d(t,{Z:()=>c});i(7313);var s=i(4918),r=i(6303),o=i(9422),a=i(747),n=i(4902),h=i(3972),l=i(459),d=i(6417);class p extends s.ZP{constructor(e){super(e,"Advanced report viewer","fa-clock-o"),this.usersSelected=e=>{this.parameterEvent.onChange(this.parameterEvent.definition,e),this.parameterEvent=null,this.setState({showGroupsPopup:!1,groups:e})},this.refreshData=()=>{this.props.reportId>0?this.$report.getReportDefinition(this.props.reportId).then((e=>{this.setReportDefinition(e),this.$analytics.trackEvent("Advanced report viewed",l.Jk.UserActions)})):this.state.definition&&(this.title=this.state.definition.queryName,this.$analytics.trackEvent("Advanced report viewed",l.Jk.UserActions))},this.getApi=e=>this.viewer=e,this.worklogAdded=e=>{this.hideWorklog()},this.hideWorklog=()=>{this.setState({showWorklogPopup:!1})},(0,r.f)(this,"ReportConfigService","AnalyticsService","ReportService"),this.viewer={},this.$reportConfig.configureViewer(),this.$reportConfig.parameters.removeAllListeners(),this.$reportConfig.parameters.on("click",this.parameterClicked.bind(this)),this.$reportConfig.eventPipe.on("addWorklog",this.addWorklog.bind(this));const{definition:t}=e;this.state.definition=t}UNSAFE_componentWillMount(){this.refreshData()}UNSAFE_componentWillReceiveProps(e){e.definition?this.setReportDefinition(e.definition):e.reportId?this.refreshData():this.setReportDefinition({})}addWorklog(e){this.isGadget?super.addWorklog(e):(this.worklogItem=e,this.setState({showWorklogPopup:!0}))}parameterClicked(e){this.parameterEvent=e,this.setState({showGroupsPopup:!0})}setReportDefinition(e){e&&e.queryName&&(this.title=e.queryName),this.setState({definition:e})}renderCustomActions(){return(0,d.jsxs)(d.Fragment,{children:[!this.isGadget&&(0,d.jsx)(o.zx,{icon:this.isFullScreen?"fa fa-compress":"fa fa-expand",onClick:this.toggleFullScreen,title:"Toggle full screen"}),this.viewer.canShowParams&&(0,d.jsx)(o.zx,{icon:"fa fa-plus-circle",onClick:this.viewer.showParameters,title:"Change report params"}),!this.isGadget&&(0,d.jsx)(o.zx,{icon:"fa fa-edit",onClick:this.props.onCancelView,title:"Edit report"})]})}render(){const{state:{definition:e,showGroupsPopup:t,groups:i,showWorklogPopup:s}}=this;return super.renderBase((0,d.jsxs)(d.Fragment,{children:[e&&(0,d.jsx)(a.ReportViewer,{api:this.getApi,definition:e}),t&&(0,d.jsx)(n.Z,{groups:i,onHide:this.usersSelected}),s&&(0,d.jsx)(h.Z,{worklog:this.worklogItem,onDone:this.worklogAdded,onHide:this.hideWorklog})]}))}}const c=p}}]);