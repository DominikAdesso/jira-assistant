"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[394],{5863:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(7313),r=s(9970),a=s(4616),n=s(6417);const o="Selected file is invalid or is corrupted. Unable to load the file!";class l extends i.PureComponent{constructor(e){super(e),this.setFileSelector=e=>this.fileSelector=e,this.chooseFileForImport=e=>this.fileSelector.click(),this.fileSelected=()=>{const e=this.fileSelector,t=e.files[0];if(t){if(!t.name.endsWith(".jab"))return this.$message.warning("Unknown file selected to import. Select a valid Jira Assist Backup (*.jab) file"),void(e.value="");const s=new FileReader;s.readAsText(t,"UTF-8"),s.onload=async e=>{const t=e.target.result;let s;try{const e=(0,r.Pe)(t);s=!0;const i=await this.$backup.importBackup(null===e||void 0===e?void 0:e.value,void 0,this.props.cleanImport);console.log("Import logs:",i),this.props.onImport&&this.props.onImport(),this.$message.success("Settings imported successfully. Check console logs for more details.")}catch(i){console.error("Backup import failed",i),s?this.$message.error(i.message):this.$message.error(o)}},s.onerror=e=>{this.$message.error(o)}}else this.$message.warning("Import operation cancelled");e.value=""},(0,a.f3)(this,"BackupService","MessageService"),this.state={}}render(){return(0,n.jsxs)(n.Fragment,{children:[this.props.children(this.chooseFileForImport),(0,n.jsx)("input",{ref:this.setFileSelector,type:"file",className:"hide",accept:".jab",onChange:this.fileSelected})]})}}const c=l},6367:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(7313),r=s(232),a=s(3682),n=s(6417);class o extends i.PureComponent{constructor(){super(...arguments),this.year=(new Date).getFullYear()}render(){return(0,n.jsxs)("div",{className:"card-footer p-4",children:[(0,n.jsx)("div",{className:"pull-left",children:(0,n.jsxs)("span",{children:["\xa9 2016-",this.year," ",(0,n.jsx)("a",{href:a.ov,target:"_blank",rel:"noreferrer",children:"Jira Assistant"})," v",r.Hm]})}),(0,n.jsxs)("div",{className:"pull-right",style:{textAlign:"right"},children:[(0,n.jsxs)("span",{children:[(0,n.jsx)("i",{className:"fa fa-youtube"}),(0,n.jsx)("a",{href:"https://www.youtube.com/embed/HsWq7cT3Qq0?rel=0&autoplay=1&showinfo=0&cc_load_policy=1",target:"_blank",rel:"noopener noreferrer",title:"Click to open YouTube video guiding you to setup Jira Assistant",children:" Help setup"})]})," |",(0,n.jsxs)("span",{children:[(0,n.jsx)("i",{className:"fa fa-phone margin-l-5"}),(0,n.jsx)("a",{href:`${a.ky}?entry.1426640786=${r.Hm}&entry.972533768=${navigator.userAgent}`,target:"_blank",rel:"noopener noreferrer",title:"Click to report about any issues or ask a question",children:" Contact us"})]})]})]})}}const l=o},7690:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var i=s(7313),r=s(747),a=s(5991),n=s(9422),o=s(108),l=s(5863),c=s(2284),h=s(4711),d=s(8407),p=s(7092),u=s(6367),m=s(6417);const g={fontSize:"18px",position:"absolute",right:"20px",top:"35px",color:"#0000ff"},f=document.location.href.indexOf("?quick=true")>-1?{minHeight:"380px",maxHeight:"380px"}:{};class x extends i.PureComponent{constructor(e){super(e),this.showMenu=e=>(0,r.showContextMenu)(e,this.settingsMenu),this.setUploader=e=>{this.importSettings=e},this.integrate=()=>{const e=this.state.jiraUrl.trim().clearEnd("/").clearEnd("\\");this.tryIntegrate(e)},this.handleDBError=e=>(this.$message.error("Unable to save the changes. Verify if you have sufficient free space in your drive","Allocation failed"),-1),this.openDashboard=async e=>{if(!(e<=0)){try{await(0,p.$A)("SELF","RELOAD",[],this.$message)}catch(t){console.error("Unable to reload BG Listeners",t)}await this.$settings.set("CurrentJiraUrl",this.state.jiraUrl),await this.$settings.set("CurrentUserId",e),this.props.setAuthType?this.props.setAuthType("1"):(this.$jaBrowserExtn.openTab("/index.html"),window.close())}},this.onSettingsImport=()=>{this.props.isWebBuild?this.props.setAuthType("1"):document.location.href="/index.html"},(0,a.f3)(this,"AjaxService","StorageService","MessageService","SettingsService","AppBrowserService","SessionService","SettingsService","UserService"),this.state={},this.init()}async init(){this.settingsMenu=[{label:"Import Settings",icon:"fa fa-upload fs-16 margin-r-5",command:this.importBackup.bind(this)},{label:"Options",icon:"fa fa-cogs fs-16 margin-r-5",command:this.launchOptionsPage.bind(this)},{separator:!0},{label:"Use Jira OAuth",icon:"fa fa-external-link fs-16 margin-r-5",command:this.useOAuth.bind(this)},{label:"Use Basic Auth",icon:"fa fa-user fs-16 margin-r-5",command:()=>this.props.history.push("/integrate/basic/1")}],this.$jaBrowserExtn.getCurrentUrl().then((e=>{const t=this.getJiraRootUrl(e);t&&t.length>20&&t.startsWith("http")&&this.setState({jiraUrl:t})}))}launchOptionsPage(){window.open("/index.html#/options")}importBackup(){this.importSettings&&this.importSettings()}useOAuth(){const e=(0,c.VM)({forWeb:!1,authType:"2"});window.open(e,"JAOAuth2Win"),window.close()}getJiraRootUrl(e){return e.replace(/^(.*\/\/[^/?#]*).*$/,"$1")}async tryIntegrate(e){this.setState({jiraUrl:e}),this.$session.rootUrl=e,this.setState({isLoading:!0});const t=await this.$jaBrowserExtn.requestPermission(null,e);delete this.$session.userId,this.$ajax.get(o.F.mySelf).then((t=>this.$user.createUser(t,e).then(this.openDashboard,this.handleDBError)),(s=>{if(401===(s=s||{}).status)this.$message.warning("You are not authenticated with Jira to integrate.","Unauthorized");else{var i;const s=null===(i=(0,h.ir)(e))||void 0===i?void 0:i.clearEnd("/");if(s&&s!==e)d.Z.yesNo(`"${e}" is not a valid Jira Api base path. Would you like to try with "${s}" instead?`,"Change URL").then((()=>{this.tryIntegrate(s)}));else if(t)this.$message.error("This is not a valid Jira server url or the server does not respond.","Unknown server");else{let e="Permission denied to access this Url. ";this.props.isWebBuild?e+="Try integrating directly from extension using JA icon or manually grant permission and retry.":e+="Manually grant permission and then retry. For more details, visit #214 in GitHub issue tracker.",this.$message.error(e,"Permission Denied")}}})).then((()=>this.setState({isLoading:!1})))}render(){const{integrate:e,state:{jiraUrl:t,isLoading:s}}=this;return(0,m.jsxs)("div",{className:"app flex-row align-items-center",style:f,children:[(0,m.jsx)("div",{className:"container",children:(0,m.jsx)("div",{className:"row justify-content-center",children:(0,m.jsx)("div",{className:"col-md-6 no-padding no-margin",style:{maxWidth:480,minWidth:460},children:(0,m.jsxs)("div",{className:"card mx-4 no-padding no-margin",children:[(0,m.jsxs)("div",{className:"card-body p-4",children:[(0,m.jsx)(l.Z,{onImport:this.onSettingsImport,cleanImport:!0,children:this.setUploader}),(0,m.jsx)(r.ContextMenu,{}),(0,m.jsx)("span",{className:"fa fa-cogs pull-right pointer",style:g,onClick:this.showMenu,onContextMenu:this.showMenu}),(0,m.jsx)("h1",{children:"Jira Assistant"}),(0,m.jsxs)("p",{className:"text-muted",children:[(0,m.jsx)("strong",{children:"Integrate"})," with your Jira account"]}),(0,m.jsxs)("div",{className:"input-group mb-3",children:[(0,m.jsx)("div",{className:"input-group-prepend",children:(0,m.jsx)("span",{className:"input-group-text",children:(0,m.jsx)("i",{className:"fa fa-external-link"})})}),(0,m.jsx)(n.zC,{className:"form-control",value:t,onChange:e=>this.setState({jiraUrl:e}),placeholder:"Jira root url (eg: https://jira.example.com)"})]}),(0,m.jsx)("p",{className:"text-muted",children:"Login to your Jira in current tab or provide the Url of your Jira server to integrate. Ensure you have already been authenticated in Jira before you click on Integrate button."}),(0,m.jsx)(n.zx,{type:"success",className:"btn-block",icon:s?"fa fa-spinner fa-spin":"fa fa-unlock-alt",disabled:!t||s,onClick:e,label:"Integrate"})]}),(0,m.jsx)(u.Z,{})]})})})}),(0,m.jsx)(d.Q,{})]})}}const v=x}}]);